import{j as e,S as ps,L as Xe,T as Ze,C as Qe,R as fs,U as Be,A as me,F as js,a as be,b as ze,c as Ns,X as bs,B as ie,d as es,I as vs,e as ys,P as ks,f as ss,V as Ss,g as as,h as ts,i as ws,k as Cs,l as Ps,m as ns,n as As,o as Ms,p as Fe,q as ve,r as rs,s as is,t as ls,u as cs,v as os,w as ds,x as ms,y as Ke,z as Ts,D as Is,E as De}from"./ui-BoUY7XF5.js";import{b as $s,r as h,R as Es}from"./vendor-DB9HQzDI.js";import{t as Ds,c as gs,P as Rs}from"./utils-GaJ1HoMq.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))o(m);new MutationObserver(m=>{for(const g of m)if(g.type==="childList")for(const b of g.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&o(b)}).observe(document,{childList:!0,subtree:!0});function t(m){const g={};return m.integrity&&(g.integrity=m.integrity),m.referrerPolicy&&(g.referrerPolicy=m.referrerPolicy),m.crossOrigin==="use-credentials"?g.credentials="include":m.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function o(m){if(m.ep)return;m.ep=!0;const g=t(m);fetch(m.href,g)}})();var _e={},Ye=$s;_e.createRoot=Ye.createRoot,_e.hydrateRoot=Ye.hydrateRoot;function T(...i){return Ds(gs(i))}const L=h.forwardRef(({className:i,...s},t)=>e.jsx("div",{ref:t,className:T("rounded-lg border bg-card text-card-foreground shadow-sm",i),...s}));L.displayName="Card";const O=h.forwardRef(({className:i,...s},t)=>e.jsx("div",{ref:t,className:T("flex flex-col space-y-1.5 p-6",i),...s}));O.displayName="CardHeader";const U=h.forwardRef(({className:i,...s},t)=>e.jsx("h3",{ref:t,className:T("text-2xl font-semibold leading-none tracking-tight",i),...s}));U.displayName="CardTitle";const Vs=h.forwardRef(({className:i,...s},t)=>e.jsx("p",{ref:t,className:T("text-sm text-muted-foreground",i),...s}));Vs.displayName="CardDescription";const B=h.forwardRef(({className:i,...s},t)=>e.jsx("div",{ref:t,className:T("p-6 pt-0",i),...s}));B.displayName="CardContent";const Fs=h.forwardRef(({className:i,...s},t)=>e.jsx("div",{ref:t,className:T("flex items-center p-6 pt-0",i),...s}));Fs.displayName="CardFooter";const He=i=>typeof i=="boolean"?`${i}`:i===0?"0":i,We=gs,hs=(i,s)=>t=>{var o;if((s==null?void 0:s.variants)==null)return We(i,t==null?void 0:t.class,t==null?void 0:t.className);const{variants:m,defaultVariants:g}=s,b=Object.keys(m).map(y=>{const k=t==null?void 0:t[y],N=g==null?void 0:g[y];if(k===null)return null;const z=He(k)||He(N);return m[y][z]}),C=t&&Object.entries(t).reduce((y,k)=>{let[N,z]=k;return z===void 0||(y[N]=z),y},{}),A=s==null||(o=s.compoundVariants)===null||o===void 0?void 0:o.reduce((y,k)=>{let{class:N,className:z,...R}=k;return Object.entries(R).every(Y=>{let[P,K]=Y;return Array.isArray(K)?K.includes({...g,...C}[P]):{...g,...C}[P]===K})?[...y,N,z]:y},[]);return We(i,b,A,t==null?void 0:t.class,t==null?void 0:t.className)},_s=hs("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"underline-offset-4 hover:underline text-primary",facebook:"bg-facebook-500 text-white hover:bg-facebook-600"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),F=h.forwardRef(({className:i,variant:s,size:t,asChild:o=!1,...m},g)=>{const b=o?ps:"button";return e.jsx(b,{className:T(_s({variant:s,size:t,className:i})),ref:g,...m})});F.displayName="Button";const Ls=fs,us=h.forwardRef(({className:i,...s},t)=>e.jsx(Xe,{ref:t,className:T("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",i),...s}));us.displayName=Xe.displayName;const je=h.forwardRef(({className:i,...s},t)=>e.jsx(Ze,{ref:t,className:T("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",i),...s}));je.displayName=Ze.displayName;const Ne=h.forwardRef(({className:i,...s},t)=>e.jsx(Qe,{ref:t,className:T("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",i),...s}));Ne.displayName=Qe.displayName;const Os=hs("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive",success:"border-green-500/50 text-green-600 dark:text-green-400 [&>svg]:text-green-600",info:"border-facebook-300/50 text-facebook-600 dark:text-facebook-400 [&>svg]:text-facebook-600"}},defaultVariants:{variant:"default"}}),ae=h.forwardRef(({className:i,variant:s,...t},o)=>e.jsx("div",{ref:o,role:"alert",className:T(Os({variant:s}),i),...t}));ae.displayName="Alert";const te=h.forwardRef(({className:i,...s},t)=>e.jsx("h5",{ref:t,className:T("mb-1 font-medium leading-none tracking-tight",i),...s}));te.displayName="AlertTitle";const ne=h.forwardRef(({className:i,...s},t)=>e.jsx("div",{ref:t,className:T("text-sm [&_p]:leading-relaxed",i),...s}));ne.displayName="AlertDescription";const Je=["Page","Page ID","Reach","Engaged Users","Engagements","Reactions","Publications","Status","Comment"];function Us({onDataUploaded:i,onCancel:s}){const[t,o]=h.useState([]),[m,g]=h.useState(!1),[b,C]=h.useState(!1),[A,y]=h.useState([]),[k,N]=h.useState({}),z=h.useRef(null),R=j=>{const w=/^FB_(\d{4})_(\d{2})\.csv$/,v=j.match(w);if(!v)return{isValid:!1,error:"Felaktigt filnamnsformat. Förväntat: FB_YYYY_MM.csv (t.ex. FB_2025_08.csv)"};const l=parseInt(v[1]),x=parseInt(v[2]);return x<1||x>12?{isValid:!1,error:"Ogiltig månad. Måste vara mellan 01-12."}:l<2020||l>2030?{isValid:!1,error:"Ogiltigt år. Måste vara mellan 2020-2030."}:{isValid:!0,year:l,month:x,displayName:`${Y(x)} ${l}`}},Y=j=>["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"][j-1],P=(j,w)=>new Promise(v=>{Rs.parse(j,{header:!0,skipEmptyLines:!0,complete:l=>{if(l.errors.length>0){v({isValid:!1,error:`CSV-parsningsfel: ${l.errors[0].message}`,data:null});return}const x=l.meta.fields||[],f=Je.filter(n=>!x.includes(n));if(f.length>0){v({isValid:!1,error:`Saknade kolumner: ${f.join(", ")}`,data:null});return}if(l.data.length===0){v({isValid:!1,error:"CSV-filen innehåller ingen data",data:null});return}v({isValid:!0,data:l.data,pageCount:l.data.length,error:null})}})}),K=j=>{j.preventDefault(),j.stopPropagation(),C(!1);const w=Array.from(j.dataTransfer.files),v=w.filter(l=>l.name.toLowerCase().endsWith(".csv"));v.length!==w.length&&y(l=>[...l,"Endast CSV-filer är tillåtna"]),v.length>0&&Z(v)},E=j=>{const w=Array.from(j.target.files);Z(w)},Z=j=>{const w=j.map(f=>{const n=R(f.name);return{file:f,id:Math.random().toString(36),name:f.name,size:f.size,validation:n,status:n.isValid?"pending":"error"}}),v=t.map(f=>f.name),l=w.filter(f=>v.includes(f.name));l.length>0&&y(f=>[...f,`Följande filer är redan valda: ${l.map(n=>n.name).join(", ")}`]);const x=w.filter(f=>!v.includes(f.name));o(f=>[...f,...x])},_=j=>{o(w=>w.filter(v=>v.id!==j))},H=async()=>{g(!0),y([]),N({});const j=t.filter(v=>v.validation.isValid),w=[];for(const v of j){N(l=>({...l,[v.id]:"processing"}));try{const l=await W(v.file),x=await P(l,v.name);if(!x.isValid){N(n=>({...n,[v.id]:"error"})),y(n=>[...n,`${v.name}: ${x.error}`]);continue}const f={...v.validation,data:x.data,pageCount:x.pageCount,filename:v.name};w.push(f),N(n=>({...n,[v.id]:"success"})),await new Promise(n=>setTimeout(n,500))}catch(l){N(x=>({...x,[v.id]:"error"})),y(x=>[...x,`${v.name}: ${l.message}`])}}g(!1),w.length>0&&i(w)},W=j=>new Promise((w,v)=>{const l=new FileReader;l.onload=x=>w(x.target.result),l.onerror=()=>v(new Error("Kunde inte läsa fil")),l.readAsText(j)}),q=j=>{j.preventDefault(),j.stopPropagation(),C(!0)},J=j=>{j.preventDefault(),j.stopPropagation(),C(!1)},re=()=>{y([])},V=t.filter(j=>j.validation.isValid).length,I=V>0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(L,{children:[e.jsxs(O,{children:[e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"h-5 w-5 text-facebook-500"}),"Ladda upp Facebook CSV-filer"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Släpp dina FB_YYYY_MM.csv filer här eller klicka för att välja filer"})]}),e.jsx(B,{children:e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors cursor-pointer ${b?"border-facebook-400 bg-facebook-50":"border-gray-300 hover:border-facebook-400 hover:bg-facebook-50"}`,onDrop:K,onDragOver:q,onDragLeave:J,onClick:()=>{var j;return(j=z.current)==null?void 0:j.click()},children:[e.jsx("input",{type:"file",ref:z,onChange:E,multiple:!0,accept:".csv",className:"hidden"}),e.jsx(Be,{className:"h-12 w-12 mx-auto mb-4 text-facebook-400"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:b?"Släpp filerna här":"Ladda upp CSV-filer"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Släpp dina FB_YYYY_MM.csv filer här eller klicka för att välja"}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Format:"})," FB_YYYY_MM.csv (t.ex. FB_2025_08.csv)"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Kolumner:"})," ",Je.join(", ")]})]})]})})]}),A.length>0&&e.jsxs(ae,{variant:"destructive",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx(te,{children:"Valideringsfel"}),e.jsxs(ne,{children:[e.jsx("ul",{className:"list-disc list-inside space-y-1",children:A.map((j,w)=>e.jsx("li",{children:j},w))}),e.jsx(F,{variant:"outline",size:"sm",onClick:re,className:"mt-2",children:"Rensa fel"})]})]}),t.length>0&&e.jsxs(L,{children:[e.jsx(O,{children:e.jsxs(U,{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["Valda filer (",t.length,")"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[V," giltiga filer"]})]})}),e.jsx(B,{children:e.jsx("div",{className:"space-y-2",children:t.map(j=>{const w=k[j.id]||j.status;return e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg border ${j.validation.isValid?"border-green-200 bg-green-50":"border-red-200 bg-red-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(js,{className:"h-4 w-4"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:j.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:j.validation.isValid?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(be,{className:"h-3 w-3"}),j.validation.displayName]}):e.jsx("span",{className:"text-red-600",children:j.validation.error})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[w==="processing"&&e.jsx(ze,{className:"h-4 w-4 animate-spin text-blue-500"}),w==="success"&&e.jsx(Ns,{className:"h-4 w-4 text-green-500"}),w==="error"&&e.jsx(me,{className:"h-4 w-4 text-red-500"}),e.jsx(F,{variant:"ghost",size:"sm",onClick:()=>_(j.id),disabled:m,children:e.jsx(bs,{className:"h-4 w-4"})})]})]},j.id)})})})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(F,{variant:"outline",onClick:s,disabled:m,children:"Avbryt"}),e.jsxs("div",{className:"flex gap-2",children:[t.length>0&&e.jsx(F,{variant:"outline",onClick:()=>o([]),disabled:m,children:"Rensa alla"}),e.jsx(F,{onClick:H,disabled:!I||m,className:"min-w-[120px]",children:m?e.jsxs(e.Fragment,{children:[e.jsx(ze,{className:"mr-2 h-4 w-4 animate-spin"}),"Bearbetar..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),"Analysera data (",V,")"]})})]})]})]})}const Le=h.forwardRef(({className:i,...s},t)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:t,className:T("w-full caption-bottom text-sm",i),...s})}));Le.displayName="Table";const Oe=h.forwardRef(({className:i,...s},t)=>e.jsx("thead",{ref:t,className:T("[&_tr]:border-b",i),...s}));Oe.displayName="TableHeader";const Ue=h.forwardRef(({className:i,...s},t)=>e.jsx("tbody",{ref:t,className:T("[&_tr:last-child]:border-0",i),...s}));Ue.displayName="TableBody";const ye=h.forwardRef(({className:i,...s},t)=>e.jsx("tr",{ref:t,className:T("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",i),...s}));ye.displayName="TableRow";const ke=h.forwardRef(({className:i,...s},t)=>e.jsx("th",{ref:t,className:T("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",i),...s}));ke.displayName="TableHead";const Se=h.forwardRef(({className:i,...s},t)=>e.jsx("td",{ref:t,className:T("p-4 align-middle [&:has([role=checkbox])]:pr-0",i),...s}));Se.displayName="TableCell";const Ie=As,$e=Ms,we=h.forwardRef(({className:i,children:s,...t},o)=>e.jsxs(es,{ref:o,className:T("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",i),...t,children:[s,e.jsx(vs,{asChild:!0,children:e.jsx(ys,{className:"h-4 w-4 opacity-50"})})]}));we.displayName=es.displayName;const Ce=h.forwardRef(({className:i,children:s,position:t="popper",...o},m)=>e.jsx(ks,{children:e.jsx(ss,{ref:m,className:T("relative z-50 min-w-[8rem] overflow-hidden rounded-md border bg-white text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",i),position:t,...o,children:e.jsx(Ss,{className:T("p-1 max-h-[300px] overflow-y-auto",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s})})}));Ce.displayName=ss.displayName;const Bs=h.forwardRef(({className:i,...s},t)=>e.jsx(as,{ref:t,className:T("py-1.5 pl-8 pr-2 text-sm font-semibold",i),...s}));Bs.displayName=as.displayName;const Pe=h.forwardRef(({className:i,children:s,...t},o)=>e.jsxs(ts,{ref:o,className:T("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",i),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(ws,{children:e.jsx(Cs,{className:"h-4 w-4"})})}),e.jsx(Ps,{children:s})]}));Pe.displayName=ts.displayName;const zs=h.forwardRef(({className:i,...s},t)=>e.jsx(ns,{ref:t,className:T("-mx-1 my-1 h-px bg-muted",i),...s}));zs.displayName=ns.displayName;const ee={P1:"#0066cc",P2:"#ff6600",P3:"#00cc66",P4:"#cc33cc",EKOT:"#005eb8",RADIOSPORTEN:"#1c5c35",SR:"#000000",default:"#000000"},qe=({pageName:i})=>{const s=i||"Okänd";let t=ee.default,o="";const m=s.toLowerCase();m.includes("ekot")||m.includes("radio sweden")?(t=ee.EKOT,o="E"):m.includes("radiosporten")||m.includes("radio sporten")?(t=ee.RADIOSPORTEN,o="RS"):m.includes("p1")?(t=ee.P1,o="P1"):m.includes("p2")?(t=ee.P2,o="P2"):m.includes("p3")?(t=ee.P3,o="P3"):m.includes("p4")?(t=ee.P4,o="P4"):m.includes("sveriges radio")&&!m.includes("p1")&&!m.includes("p2")&&!m.includes("p3")&&!m.includes("p4")?(t=ee.SR,o="SR"):o=s.charAt(0).toUpperCase();const b=t===ee.P2||t===ee.P3?"text-black":"text-white";return e.jsx("div",{className:`flex-shrink-0 w-6 h-6 rounded-sm flex items-center justify-center text-xs font-bold ${b}`,style:{backgroundColor:t},title:i,children:o})},Ks=[{value:6,label:"6 per sida"},{value:12,label:"12 per sida"},{value:24,label:"24 per sida"}],Ys=[{key:"reach",label:"Räckvidd",canSum:!1},{key:"engagements",label:"Engagemang",canSum:!0},{key:"reactions",label:"Reaktioner",canSum:!0},{key:"publications",label:"Publiceringar",canSum:!0},{key:"status",label:"Status",canSum:!0},{key:"comment",label:"Kommentarer",canSum:!0}],Re={reach:{displayName:"Räckvidd",canSumAcrossPages:!1,category:"unique_persons"},engagements:{displayName:"Engagemang",canSumAcrossPages:!0,category:"countable"},reactions:{displayName:"Reaktioner",canSumAcrossPages:!0,category:"countable"},publications:{displayName:"Publiceringar",canSumAcrossPages:!0,category:"countable"},status:{displayName:"Status",canSumAcrossPages:!0,category:"countable"},comment:{displayName:"Kommentarer",canSumAcrossPages:!0,category:"countable"}};function Hs({uploadedPeriods:i=[]}){const[s,t]=h.useState([]),[o,m]=h.useState(""),[g,b]=h.useState([]),[C,A]=h.useState(!0),[y,k]=h.useState(null),[N,z]=h.useState(null),[R,Y]=h.useState({}),[P,K]=h.useState({key:"year_month",direction:"desc"}),[E,Z]=h.useState(1),[_,H]=h.useState(12),[W,q]=h.useState(["reach","engagements","publications"]);h.useEffect(()=>{(()=>{try{if(A(!0),i.length===0){t([]),A(!1);return}const r=new Map;i.forEach(u=>{u.data&&Array.isArray(u.data)&&u.data.forEach(p=>{const S=p.Page||p.page||"Okänd sida",$=p["Page ID"]||p.pageId||`page_${S.replace(/\s+/g,"_")}`;r.has($)||r.set($,{pageId:$,pageName:S})})});const d=Array.from(r.values()).sort((u,p)=>u.pageName.localeCompare(p.pageName));t(d),d.length>0&&m(d[0].pageId)}catch(r){console.error("Error loading pages:",r),k("Kunde inte ladda tillgängliga Facebook-sidor")}finally{A(!1)}})()},[i]),h.useEffect(()=>{if(!o||i.length===0)return;(()=>{try{A(!0),k(null);const r=[];if(i.forEach(u=>{if(u.data&&Array.isArray(u.data)){const p=u.data.find(S=>(S["Page ID"]||S.pageId||`page_${(S.Page||S.page||"").replace(/\s+/g,"_")}`)===o);p&&r.push({year:u.year,month:u.month,pageName:p.Page||p.page||"Okänd sida",pageId:o,metrics:{reach:J(p.Reach||p.reach),engagements:J(p.Engagements||p.engagements),reactions:J(p.Reactions||p.reactions),publications:J(p.Publications||p.publications),status:J(p.Status||p.status),comment:J(p.Comment||p.comment)}})}}),r.length===0){const u=s.find(p=>p.pageId===o);k(`Ingen tidserie-data hittades för ${(u==null?void 0:u.pageName)||"vald sida"}`);return}const d=r.sort((u,p)=>u.year!==p.year?p.year-u.year:p.month-u.month);b(d),re(d)}catch(r){console.error("Error loading page timeseries:",r);const d=s.find(u=>u.pageId===o);k(`Kunde inte ladda data för ${(d==null?void 0:d.pageName)||"vald sida"}`)}finally{A(!1)}})()},[o,i,s]);const J=a=>{if(a==null||a==="")return 0;const r=parseFloat(String(a).replace(/[,\s]/g,""));return isNaN(r)?0:r},re=a=>{var S,$,M;if(a.length===0)return;const r=s.find(D=>D.pageId===o),d={pageName:(r==null?void 0:r.pageName)||((S=a[0])==null?void 0:S.pageName)||"Okänd sida",totalPeriods:a.length,firstPeriod:a[a.length-1],lastPeriod:a[0],metrics:{}},u=["reach","engagements","reactions","publications"];for(const D of u){const G=a.map(Q=>Q.metrics[D]).filter(Q=>Q!=null&&!isNaN(Q));if(G.length>0){const Q=G.reduce((le,ge)=>le+ge,0)/G.length,X=Math.min(...G),ce=Math.max(...G),oe=a.find(le=>le.metrics[D]===ce),xe=a.find(le=>le.metrics[D]===X);d.metrics[D]={average:Math.round(Q),min:X,max:ce,bestMonth:oe?{year:oe.year,month:oe.month,value:ce}:null,worstMonth:xe?{year:xe.year,month:xe.month,value:X}:null}}}z(d);const p={};for(const D of W)if(a.length>=2){const G=(($=a[a.length-1])==null?void 0:$.metrics[D])||0,X=(((M=a[0])==null?void 0:M.metrics[D])||0)-G,ce=G>0?X/G*100:0;p[D]={change:X,percentChange:Math.round(ce*10)/10,trend:X>0?"up":X<0?"down":"stable"}}Y(p)},V=a=>["Jan","Feb","Mar","Apr","Maj","Jun","Jul","Aug","Sep","Okt","Nov","Dec"][a-1],I=h.useMemo(()=>g.length?[...g].sort((a,r)=>{let d,u;P.key==="year_month"?(d=a.year*100+a.month,u=r.year*100+r.month):(d=a.metrics[P.key]||0,u=r.metrics[P.key]||0);const p=d-u;return P.direction==="asc"?p:-p}):[],[g,P]),j=h.useMemo(()=>{const a=(E-1)*_;return I.slice(a,a+_)},[I,E,_]),w=Math.ceil(I.length/_),v=a=>{K(r=>({key:a,direction:r.key===a&&r.direction==="asc"?"desc":"asc"}))},l=a=>P.key!==a?e.jsx(os,{className:"h-4 w-4 ml-1 opacity-50"}):P.direction==="asc"?e.jsx(ds,{className:"h-4 w-4 ml-1"}):e.jsx(ms,{className:"h-4 w-4 ml-1"}),x=a=>{q(r=>r.includes(a)?r.filter(d=>d!==a):[...r,a])},f=()=>{const a=s.find(M=>M.pageId===o),r=["År","Månad","Period",...W.map(M=>{const D=Re[M];return D?D.displayName:M})],d=I.map(M=>[M.year,M.month,`${V(M.month)} ${M.year}`,...W.map(D=>M.metrics[D]||0)]),u=[r.join(","),...d.map(M=>M.join(","))].join(`
`),p=new Blob([u],{type:"text/csv;charset=utf-8;"}),S=document.createElement("a"),$=URL.createObjectURL(p);S.setAttribute("href",$),S.setAttribute("download",`${a==null?void 0:a.pageName.replace(/[^a-zA-Z0-9]/g,"_")}_tidsserie.csv`),S.style.visibility="hidden",document.body.appendChild(S),S.click(),document.body.removeChild(S)},n=a=>a==null||isNaN(a)?"-":new Intl.NumberFormat("sv-SE").format(a);if(C)return e.jsxs(ae,{children:[e.jsx(Fe,{className:"h-4 w-4"}),e.jsx(te,{children:"Laddar data"}),e.jsx(ne,{children:"Analyserar tidserie-data för Facebook-sidor..."})]});if(y)return e.jsxs(ae,{variant:"destructive",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx(te,{children:"Fel"}),e.jsx(ne,{children:y})]});if(s.length===0)return e.jsxs(ae,{children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx(te,{children:"Inga sidor hittades"}),e.jsx(ne,{children:"Kunde inte hitta några Facebook-sidor i den uppladdade datan."})]});const c=s.find(a=>a.pageId===o);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(L,{children:[e.jsx(O,{children:e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5 text-facebook-500"}),"Sidanalys över tid"]})}),e.jsxs(B,{children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Välj Facebook-sida"}),e.jsxs(Ie,{value:o,onValueChange:m,children:[e.jsx(we,{children:e.jsx($e,{placeholder:"Välj sida att analysera"})}),e.jsx(Ce,{children:s.map(a=>e.jsx(Pe,{value:a.pageId,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qe,{pageName:a.pageName}),e.jsx("span",{children:a.pageName})]})},a.pageId))})]}),c&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["ID: ",c.pageId]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Metrics att visa"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:Ys.map(a=>{const r=W.includes(a.key);return e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r,onChange:()=>x(a.key),className:"h-4 w-4 text-facebook-500 border-gray-300 rounded focus:ring-facebook-500"}),e.jsx("span",{className:"text-sm font-medium",children:a.label}),!a.canSum&&e.jsx("span",{className:"text-xs text-orange-600 font-medium",children:"*"})]},a.key)})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"* = Kan inte summeras över månader (unika personer)"})]})]}),N&&e.jsxs("div",{className:"grid md:grid-cols-4 gap-4 mb-6 p-4 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-facebook-600 flex items-center justify-center gap-2",children:[e.jsx(qe,{pageName:N.pageName}),N.totalPeriods]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Månader data"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-semibold",children:[V(N.firstPeriod.month)," ",N.firstPeriod.year]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Första månad"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-semibold",children:[V(N.lastPeriod.month)," ",N.lastPeriod.year]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Senaste månad"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-facebook-600",children:(c==null?void 0:c.pageName)||"Okänd sida"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Vald sida"})]})]}),Object.keys(R).length>0&&e.jsx("div",{className:"grid md:grid-cols-3 gap-4 mb-6",children:W.slice(0,3).map(a=>{const r=R[a],d=Re[a];return!r||!d?null:e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white border rounded-lg",children:[r.trend==="up"&&e.jsx(ve,{className:"h-5 w-5 text-green-600"}),r.trend==="down"&&e.jsx(rs,{className:"h-5 w-5 text-red-600"}),r.trend==="stable"&&e.jsx(Fe,{className:"h-5 w-5 text-gray-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm",children:d.displayName}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[r.percentChange>0?"+":"",r.percentChange,"% sedan första månad"]})]})]},a)})})]})]}),e.jsxs(L,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between",children:[e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-5 w-5"}),"Månadsvis utveckling - ",(c==null?void 0:c.pageName)||"Okänd sida"]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(F,{onClick:f,variant:"outline",size:"sm",children:[e.jsx(is,{className:"h-4 w-4 mr-2"}),"CSV"]})})]}),e.jsxs(B,{children:[g.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Ingen tidserie-data tillgänglig för vald sida"}):e.jsxs(e.Fragment,{children:[e.jsxs(Le,{children:[e.jsx(Oe,{children:e.jsxs(ye,{children:[e.jsx(ke,{className:"cursor-pointer select-none",onClick:()=>v("year_month"),children:e.jsxs("div",{className:"flex items-center",children:["Period",l("year_month")]})}),W.map(a=>{const r=Re[a];return e.jsx(ke,{className:"text-right cursor-pointer select-none",onClick:()=>v(a),children:e.jsxs("div",{className:"flex items-center justify-end",children:[(r==null?void 0:r.displayName)||a,l(a),!(r!=null&&r.canSumAcrossPages)&&e.jsx("span",{className:"ml-1 text-orange-600",children:"*"})]})},a)})]})}),e.jsx(Ue,{children:j.map((a,r)=>e.jsxs(ye,{children:[e.jsxs(Se,{className:"font-medium",children:[V(a.month)," ",a.year]}),W.map(d=>{var u,p;return e.jsx(Se,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[n(a.metrics[d]),((u=N==null?void 0:N.metrics[d])==null?void 0:u.bestMonth)&&N.metrics[d].bestMonth.year===a.year&&N.metrics[d].bestMonth.month===a.month&&e.jsx("span",{className:"text-yellow-600",title:"Bästa värde för denna sida",children:"🏆"}),((p=N==null?void 0:N.metrics[d])==null?void 0:p.worstMonth)&&N.metrics[d].worstMonth.year===a.year&&N.metrics[d].worstMonth.month===a.month&&e.jsx("span",{className:"text-gray-500",title:"Sämsta värde för denna sida",children:"📉"})]})},d)})]},`${a.year}_${a.month}`))})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Visa:"}),e.jsxs(Ie,{value:_.toString(),onValueChange:a=>{H(Number(a)),Z(1)},children:[e.jsx(we,{className:"w-[120px]",children:e.jsx($e,{})}),e.jsx(Ce,{children:Ks.map(a=>e.jsx(Pe,{value:a.value.toString(),children:a.label},a.value))})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Visar ",(E-1)*_+1," till ",Math.min(E*_,I.length)," av ",I.length]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{variant:"outline",size:"sm",onClick:()=>Z(a=>Math.max(1,a-1)),disabled:E===1,children:e.jsx(ls,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-sm",children:["Sida ",E," av ",w]}),e.jsx(F,{variant:"outline",size:"sm",onClick:()=>Z(a=>Math.min(w,a+1)),disabled:E>=w,children:e.jsx(cs,{className:"h-4 w-4"})})]})]})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-muted/30 rounded-lg",children:e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"🏆 = Bästa värde för denna sida"}),e.jsx("span",{className:"mx-4",children:"📉 = Sämsta värde för denna sida"})]}),e.jsx("div",{className:"text-muted-foreground text-xs",children:"Gröna värden = bästa prestanda, röda värden = sämsta prestanda för vald tidsperiod"})]})})]})]})]})}const se={P1:"#0066cc",P2:"#ff6600",P3:"#00cc66",P4:"#cc33cc",EKOT:"#005eb8",RADIOSPORTEN:"#1c5c35",SR:"#000000",default:"#000000"},Ws=({pageName:i})=>{const s=i||"Okänd";let t=se.default,o="";const m=s.toLowerCase();m.includes("ekot")||m.includes("radio sweden")?(t=se.EKOT,o="E"):m.includes("radiosporten")||m.includes("radio sporten")?(t=se.RADIOSPORTEN,o="RS"):m.includes("p1")?(t=se.P1,o="P1"):m.includes("p2")?(t=se.P2,o="P2"):m.includes("p3")?(t=se.P3,o="P3"):m.includes("p4")?(t=se.P4,o="P4"):m.includes("sveriges radio")&&!m.includes("p1")&&!m.includes("p2")&&!m.includes("p3")&&!m.includes("p4")?(t=se.SR,o="SR"):o=s.charAt(0).toUpperCase();const b=t===se.P2||t===se.P3?"text-black":"text-white";return e.jsx("div",{className:`flex-shrink-0 w-6 h-6 rounded-sm flex items-center justify-center text-xs font-bold ${b}`,style:{backgroundColor:t},title:i,children:o})},Js=[{value:10,label:"10 per sida"},{value:25,label:"25 per sida"},{value:50,label:"50 per sida"}],qs=[{key:"reach",label:"Räckvidd",canSum:!1},{key:"engagements",label:"Engagemang",canSum:!0},{key:"reactions",label:"Reaktioner",canSum:!0},{key:"publications",label:"Publiceringar",canSum:!0}],he={reach:{displayName:"Räckvidd",canSumAcrossPages:!1,category:"unique_persons"},engagements:{displayName:"Engagemang",canSumAcrossPages:!0,category:"countable"},reactions:{displayName:"Reaktioner",canSumAcrossPages:!0,category:"countable"},publications:{displayName:"Publiceringar",canSumAcrossPages:!0,category:"countable"}};function Gs({uploadedPeriods:i=[]}){const[s,t]=h.useState(null),[o,m]=h.useState([]),[g,b]=h.useState(null),[C,A]=h.useState(!1),[y,k]=h.useState(null),[N,z]=h.useState({key:"pageName",direction:"asc"}),[R,Y]=h.useState(1),[P,K]=h.useState(25),[E,Z]=h.useState(["reach","engagements","publications"]);h.useEffect(()=>{if(i.length>0&&!s){const l=i[0];t({year:l.year,month:l.month})}},[i,s]),h.useEffect(()=>{if(!s)return;(()=>{try{A(!0),k(null);const x=i.find(c=>c.year===s.year&&c.month===s.month);if(!x){k(`Ingen data hittades för ${H(s.month)} ${s.year}`),m([]),b(null);return}const f=x.data.map(c=>({page:{pageName:c.Page||c.page||"Okänd sida",pageId:c["Page ID"]||c.pageId||"unknown"},period:{year:s.year,month:s.month},metrics:{reach:_(c.Reach||c.reach),engagements:_(c.Engagements||c.engagements),reactions:_(c.Reactions||c.reactions),publications:_(c.Publications||c.publications)}}));m(f);const n=W(f,s.year,s.month);b(n)}catch(x){console.error("Error loading period data:",x),k(`Kunde inte ladda data för ${H(s.month)} ${s.year}`)}finally{A(!1)}})()},[s,i]);const _=l=>{if(l==null||l==="")return 0;const x=parseFloat(String(l).replace(/[,\s]/g,""));return isNaN(x)?0:x},H=l=>["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"][l-1],W=(l,x,f)=>{if(!l.length)return null;const n={period:{year:x,month:f},totalPages:l.length,metrics:{}},c=["reach","engagements","reactions","publications"];for(const a of c){const r=l.map(u=>u.metrics[a]).filter(u=>u!=null&&!isNaN(u)&&u>=0);if(r.length===0){n.metrics[a]={total:0,average:0,min:0,max:0,validPages:0,type:he[a].category};continue}if(!he[a].canSumAcrossPages)n.metrics[a]={average:Math.round(r.reduce((u,p)=>u+p,0)/r.length),min:Math.min(...r),max:Math.max(...r),validPages:r.length,type:"unique_persons",note:"Genomsnitt över sidor - total reach kan inte beräknas"};else{const u=r.reduce((p,S)=>p+S,0);n.metrics[a]={total:u,average:Math.round(u/r.length),min:Math.min(...r),max:Math.max(...r),validPages:r.length,type:"countable"}}}return n},q=h.useMemo(()=>o.length?[...o].sort((l,x)=>{let f,n;if(N.key==="pageName"?(f=l.page.pageName,n=x.page.pageName):(f=l.metrics[N.key]||0,n=x.metrics[N.key]||0),typeof f=="string"){const a=f.localeCompare(n);return N.direction==="asc"?a:-a}const c=f-n;return N.direction==="asc"?c:-c}):[],[o,N]),J=h.useMemo(()=>{const l=(R-1)*P;return q.slice(l,l+P)},[q,R,P]),re=Math.ceil(q.length/P),V=l=>{z(x=>({key:l,direction:x.key===l&&x.direction==="asc"?"desc":"asc"}))},I=l=>N.key!==l?e.jsx(os,{className:"h-4 w-4 ml-1 opacity-50"}):N.direction==="asc"?e.jsx(ds,{className:"h-4 w-4 ml-1"}):e.jsx(ms,{className:"h-4 w-4 ml-1"}),j=l=>{Z(x=>x.includes(l)?x.filter(f=>f!==l):[...x,l])},w=()=>{const l=["Sidnamn","Sido-ID",...E.map(d=>{const u=he[d];return u?u.displayName:d})],x=q.map(d=>[d.page.pageName,d.page.pageId,...E.map(u=>d.metrics[u]||0)]),f=[l.join(","),...x.map(d=>d.join(","))].join(`
`),n=new Blob([f],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a"),a=URL.createObjectURL(n);c.setAttribute("href",a);const r=s?`${H(s.month)}_${s.year}`:"månadsjämförelse";c.setAttribute("download",`Facebook_${r}.csv`),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c)},v=l=>l==null||isNaN(l)?"-":new Intl.NumberFormat("sv-SE").format(l);return C?e.jsxs(ae,{children:[e.jsx(Fe,{className:"h-4 w-4"}),e.jsx(te,{children:"Laddar data"}),e.jsx(ne,{children:"Analyserar månadsdata för Facebook-sidor..."})]}):y?e.jsxs(ae,{variant:"destructive",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx(te,{children:"Fel"}),e.jsx(ne,{children:y})]}):i.length===0?e.jsxs(ae,{children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx(te,{children:"Ingen data"}),e.jsx(ne,{children:"Ladda upp CSV-filer för att visa månadsvis jämförelse av Facebook-sidor."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(L,{children:[e.jsx(O,{children:e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-5 w-5 text-facebook-500"}),"Månadsvis jämförelse"]})}),e.jsxs(B,{children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Välj månad"}),e.jsxs(Ie,{value:s?`${s.year}_${s.month}`:"",onValueChange:l=>{const[x,f]=l.split("_");t({year:parseInt(x),month:parseInt(f)})},children:[e.jsx(we,{children:e.jsx($e,{placeholder:"Välj månad att analysera"})}),e.jsx(Ce,{children:i.map(l=>e.jsxs(Pe,{value:`${l.year}_${l.month}`,children:[H(l.month)," ",l.year]},`${l.year}_${l.month}`))})]}),s&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Visar data för ",H(s.month)," ",s.year]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Metrics att visa"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:qs.map(l=>{const x=E.includes(l.key);return e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:x,onChange:()=>j(l.key),className:"h-4 w-4 text-facebook-500 border-gray-300 rounded focus:ring-facebook-500"}),e.jsx("span",{className:"text-sm font-medium",children:l.label}),!l.canSum&&e.jsx("span",{className:"text-xs text-orange-600 font-medium",children:"*"})]},l.key)})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"* = Kan inte summeras över sidor (unika personer per månad)"})]})]}),g&&e.jsxs("div",{className:"grid md:grid-cols-4 gap-4 mb-6 p-4 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-facebook-600",children:g.totalPages}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Facebook-sidor"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-semibold",children:[H(g.period.month)," ",g.period.year]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Vald period"})]}),E.slice(0,2).map(l=>{const x=g.metrics[l],f=he[l];return!x||!f?null:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold",children:f.canSumAcrossPages?v(x.total):v(x.average)}),e.jsx("div",{className:"text-sm text-muted-foreground",children:f.canSumAcrossPages?`Total ${f.displayName}`:`Snitt ${f.displayName}`})]},l)})]})]})]}),e.jsxs(L,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between",children:[e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5"}),s?`${H(s.month)} ${s.year} - Alla sidor`:"Månadsdata"]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(F,{onClick:w,variant:"outline",size:"sm",children:[e.jsx(is,{className:"h-4 w-4 mr-2"}),"CSV"]})})]}),e.jsxs(B,{children:[o.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Ingen data tillgänglig för vald månad"}):e.jsxs(e.Fragment,{children:[e.jsxs(Le,{children:[e.jsx(Oe,{children:e.jsxs(ye,{children:[e.jsx(ke,{className:"cursor-pointer select-none",onClick:()=>V("pageName"),children:e.jsxs("div",{className:"flex items-center",children:["Sidnamn",I("pageName")]})}),E.map(l=>{const x=he[l];return e.jsx(ke,{className:"text-right cursor-pointer select-none",onClick:()=>V(l),children:e.jsxs("div",{className:"flex items-center justify-end",children:[(x==null?void 0:x.displayName)||l,I(l),!(x!=null&&x.canSumAcrossPages)&&e.jsx("span",{className:"ml-1 text-orange-600",children:"*"})]})},l)})]})}),e.jsx(Ue,{children:J.map((l,x)=>e.jsxs(ye,{children:[e.jsx(Se,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ws,{pageName:l.page.pageName}),e.jsx("span",{children:l.page.pageName})]})}),E.map(f=>e.jsx(Se,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[v(l.metrics[f]),(g==null?void 0:g.metrics[f])&&l.metrics[f]===g.metrics[f].max&&g.metrics[f].max!==g.metrics[f].min&&e.jsx("span",{className:"text-yellow-600",title:"Bästa värde för denna månad",children:"🏆"}),(g==null?void 0:g.metrics[f])&&l.metrics[f]===g.metrics[f].min&&g.metrics[f].max!==g.metrics[f].min&&e.jsx("span",{className:"text-gray-500",title:"Lägsta värde för denna månad",children:"📉"})]})},f))]},l.page.pageId))})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Visa:"}),e.jsxs(Ie,{value:P.toString(),onValueChange:l=>{K(Number(l)),Y(1)},children:[e.jsx(we,{className:"w-[120px]",children:e.jsx($e,{})}),e.jsx(Ce,{children:Js.map(l=>e.jsx(Pe,{value:l.value.toString(),children:l.label},l.value))})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Visar ",(R-1)*P+1," till ",Math.min(R*P,q.length)," av ",q.length]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{variant:"outline",size:"sm",onClick:()=>Y(l=>Math.max(1,l-1)),disabled:R===1,children:e.jsx(ls,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-sm",children:["Sida ",R," av ",re]}),e.jsx(F,{variant:"outline",size:"sm",onClick:()=>Y(l=>Math.min(re,l+1)),disabled:R>=re,children:e.jsx(cs,{className:"h-4 w-4"})})]})]})]})]}),E.some(l=>{var x;return((x=he[l])==null?void 0:x.category)==="unique_persons"})&&e.jsxs(ae,{className:"mt-4 bg-amber-50 border-amber-200",children:[e.jsx(me,{className:"h-4 w-4 text-amber-600"}),e.jsx(te,{className:"text-amber-800",children:"Viktigt om Räckvidd"}),e.jsx(ne,{className:"text-amber-700",children:"Räckvidd representerar unika personer per månad och kan ALDRIG summeras över månader eller sidor. Värdena i tabellen visar data för den valda månaden."})]})]})]})]})}const Xs=["reach","engagedUsers"],Zs=["engagements","reactions","publications","status","comment"],ue={reach:{category:"unique_persons",displayName:"Räckvidd",description:"Antal unika personer som såg innehållet under månaden",unit:"personer",canSumAcrossTime:!1,canSumAcrossPages:!1,preferredAggregation:"average",validAggregations:["average","min","max"],dataType:"integer",csvColumn:"Reach",icon:"👁️",color:"#3B82F6",warningNote:"Kan ALDRIG summeras över månader - representerar unika personer"},engagedUsers:{category:"unique_persons",displayName:"Engagerade användare",description:"Antal unika personer som interagerade med innehållet under månaden",unit:"personer",canSumAcrossTime:!1,canSumAcrossPages:!1,preferredAggregation:"average",validAggregations:["average","min","max"],dataType:"integer",csvColumn:"Engaged Users",icon:"🤝",color:"#10B981",warningNote:"Kan ALDRIG summeras över månader - representerar unika personer"},engagements:{category:"countable_events",displayName:"Interaktioner",description:"Totalt antal interaktioner (reactions + comments + shares)",unit:"interaktioner",canSumAcrossTime:!0,canSumAcrossPages:!0,preferredAggregation:"sum",validAggregations:["sum","average","min","max"],dataType:"integer",csvColumn:"Engagements",icon:"💬",color:"#8B5CF6",warningNote:null},reactions:{category:"countable_events",displayName:"Reaktioner",description:"Antal likes, hearts, och andra reaktioner på innehåll",unit:"reaktioner",canSumAcrossTime:!0,canSumAcrossPages:!0,preferredAggregation:"sum",validAggregations:["sum","average","min","max"],dataType:"integer",csvColumn:"Reactions",icon:"❤️",color:"#EF4444",warningNote:null},publications:{category:"countable_events",displayName:"Publiceringar",description:"Antal publicerade inlägg under månaden",unit:"inlägg",canSumAcrossTime:!0,canSumAcrossPages:!0,preferredAggregation:"sum",validAggregations:["sum","average","min","max"],dataType:"integer",csvColumn:"Publications",icon:"📝",color:"#F59E0B",warningNote:null},status:{category:"countable_events",displayName:"Statusuppdateringar",description:"Antal statusuppdateringar under månaden",unit:"statusar",canSumAcrossTime:!0,canSumAcrossPages:!0,preferredAggregation:"sum",validAggregations:["sum","average","min","max"],dataType:"integer",csvColumn:"Status",icon:"📢",color:"#14B8A6",warningNote:null},comment:{category:"countable_events",displayName:"Kommentarer",description:"Antal kommentarer på innehåll",unit:"kommentarer",canSumAcrossTime:!0,canSumAcrossPages:!0,preferredAggregation:"sum",validAggregations:["sum","average","min","max"],dataType:"integer",csvColumn:"Comment",icon:"💭",color:"#6366F1",warningNote:null}};function xs(i){return Object.keys(ue).filter(s=>ue[s].category===i)}function Qs(){return xs("countable_events")}function ea(){return xs("unique_persons")}function sa(){const i=[],s=[],t=Qs(),o=Zs,m=o.filter(k=>!t.includes(k)),g=t.filter(k=>!o.includes(k));m.length>0&&i.push(`Saknade summerbara metrics: ${m.join(", ")}`),g.length>0&&i.push(`Extra summerbara metrics: ${g.join(", ")}`);const b=ea(),C=Xs,A=C.filter(k=>!b.includes(k)),y=b.filter(k=>!C.includes(k));return A.length>0&&i.push(`Saknade icke-summerbara metrics: ${A.join(", ")}`),y.length>0&&i.push(`Extra icke-summerbara metrics: ${y.join(", ")}`),{isConsistent:i.length===0,errors:i,warnings:s}}const Ge=sa();Ge.isConsistent||console.error("KRITISK: metric_categorizer.js är inte konsistent med reach_calculator.js:",Ge.errors);function aa(i,s){return s===0||s===null||s===void 0?i>0?100:0:i==null?null:(i-s)/s*100}function ta(i,s){if(!i||!s)throw new Error("calculateMonthToMonthTrend kräver PageTimeseries och metric");const t=i.getAllMonthlyData();if(t.length<2)return[];const o=[];for(let m=1;m<t.length;m++){const g=t[m],b=t[m-1],C=g.metrics[s],A=b.metrics[s],y=aa(C,A);o.push({period:g.getPeriod(),previousPeriod:b.getPeriod(),currentValue:C,previousValue:A,absoluteChange:C-A,percentageChange:y,metric:s,pageName:g.page.pageName,pageId:g.page.pageId})}return o}function na(i){if(!i||i.length===0)return{averageAbsoluteChange:0,averagePercentageChange:0,totalPeriods:0,positiveMonths:0,negativeMonths:0,stableMonths:0};let s=0,t=0,o=0,m=0,g=0,b=0;for(const C of i)s+=C.absoluteChange,C.percentageChange!==null&&!isNaN(C.percentageChange)&&(t+=C.percentageChange,o++,C.percentageChange>1?m++:C.percentageChange<-1?g++:b++);return{averageAbsoluteChange:s/i.length,averagePercentageChange:o>0?t/o:0,totalPeriods:i.length,positiveMonths:m,negativeMonths:g,stableMonths:b}}class Ae{constructor(s,t){if(!s||!t)throw new Error("FacebookPage kräver både pageName och pageId");this.pageName=s.trim(),this.pageId=String(t).trim(),this.createdAt=new Date}static fromCSVRow(s){if(!s.Page||!s["Page ID"])throw new Error("CSV-rad saknar obligatoriska fält: Page eller Page ID");return new Ae(s.Page,s["Page ID"])}getKey(){return`page_${this.pageId}`}isValid(){return this.pageName.length>0&&this.pageId.length>0}}class Ee{constructor(s,t,o,m){if(!(s instanceof Ae))throw new Error("MonthlyPageData kräver en FacebookPage instans");if(!t||!o||o<1||o>12)throw new Error("MonthlyPageData kräver giltigt år och månad (1-12)");this.page=s,this.year=parseInt(t),this.month=parseInt(o),this.metrics=this.validateMetrics(m||{}),this.createdAt=new Date}validateMetrics(s){return{reach:this.parseNumeric(s.reach||s.Reach),engagedUsers:this.parseNumeric(s.engagedUsers||s["Engaged Users"]),engagements:this.parseNumeric(s.engagements||s.Engagements),reactions:this.parseNumeric(s.reactions||s.Reactions),publications:this.parseNumeric(s.publications||s.Publications),status:this.parseNumeric(s.status||s.Status),comment:this.parseNumeric(s.comment||s.Comment)}}parseNumeric(s){if(s==null||s==="")return 0;const t=parseFloat(String(s).replace(/,/g,""));return isNaN(t)?0:t}static fromCSVRow(s,t,o){const m=Ae.fromCSVRow(s);return new Ee(m,t,o,s)}getKey(){return`${this.page.getKey()}_${this.year}_${this.month}`}getPeriod(){return{year:this.year,month:this.month}}isSamePeriod(s,t){return this.year===s&&this.month===t}getSummerableMetrics(){return{engagements:this.metrics.engagements,reactions:this.metrics.reactions,publications:this.metrics.publications,status:this.metrics.status,comment:this.metrics.comment}}getNonSummerableMetrics(){return{reach:this.metrics.reach,engagedUsers:this.metrics.engagedUsers}}}class ra{constructor(s){if(!(s instanceof Ae))throw new Error("PageTimeseries kräver en FacebookPage instans");this.page=s,this.monthlyData=new Map,this.createdAt=new Date}addMonthlyData(s){if(!(s instanceof Ee))throw new Error("addMonthlyData kräver MonthlyPageData instans");if(s.page.pageId!==this.page.pageId)throw new Error("MonthlyData måste tillhöra samma sida");const t=`${s.year}_${s.month}`;this.monthlyData.set(t,s)}getMonthlyData(s,t){const o=`${s}_${t}`;return this.monthlyData.get(o)||null}getAvailablePeriods(){return Array.from(this.monthlyData.values()).map(s=>s.getPeriod()).sort((s,t)=>s.year!==t.year?s.year-t.year:s.month-t.month)}getAllMonthlyData(){return Array.from(this.monthlyData.values()).sort((s,t)=>s.year!==t.year?s.year-t.year:s.month-t.month)}hasDataForPeriod(s,t){return this.getMonthlyData(s,t)!==null}getMonthCount(){return this.monthlyData.size}}class ia{constructor(){this.pageTimeseries=new Map,this.createdAt=new Date}addMonthlyData(s){if(!(s instanceof Ee))throw new Error("addMonthlyData kräver MonthlyPageData instans");const t=s.page.getKey();this.pageTimeseries.has(t)||this.pageTimeseries.set(t,new ra(s.page)),this.pageTimeseries.get(t).addMonthlyData(s)}getPageTimeseries(s){const t=`page_${s}`;return this.pageTimeseries.get(t)||null}getAllPages(){return Array.from(this.pageTimeseries.values()).map(s=>s.page).sort((s,t)=>s.pageName.localeCompare(t.pageName))}getAllPeriods(){const s=new Set;for(const t of this.pageTimeseries.values())for(const o of t.getAvailablePeriods())s.add(`${o.year}_${o.month}`);return Array.from(s).map(t=>{const[o,m]=t.split("_");return{year:parseInt(o),month:parseInt(m)}}).sort((t,o)=>t.year!==o.year?t.year-o.year:t.month-o.month)}getDataForPeriod(s,t){const o=[];for(const m of this.pageTimeseries.values()){const g=m.getMonthlyData(s,t);g&&o.push(g)}return o.sort((m,g)=>m.page.pageName.localeCompare(g.page.pageName))}getStats(){return{totalPages:this.pageTimeseries.size,totalPeriods:this.getAllPeriods().length,totalDataPoints:Array.from(this.pageTimeseries.values()).reduce((s,t)=>s+t.getMonthCount(),0)}}clear(){this.pageTimeseries.clear()}}const la=[{key:"reach",label:"Räckvidd",canSum:!1},{key:"engagements",label:"Engagemang",canSum:!0},{key:"reactions",label:"Reaktioner",canSum:!0},{key:"publications",label:"Publiceringar",canSum:!0}],Ve=["#2563EB","#16A34A","#EAB308","#DC2626","#7C3AED","#EA580C","#0891B2","#BE185D","#059669","#7C2D12","#4338CA","#C2410C"],ca=({uploadedPeriods:i})=>{var x,f;const[s,t]=h.useState("reach"),[o,m]=h.useState([]),[g,b]=h.useState([]),[C,A]=h.useState(null),[y,k]=h.useState({x:0,y:0}),[N,z]=h.useState(!1),R=h.useMemo(()=>!i||i.length===0?null:new ia(i),[i]),Y=h.useMemo(()=>{if(!i||i.length===0)return[];const n=new Map;return i.forEach(c=>{c.data&&Array.isArray(c.data)&&c.data.forEach(a=>{const r=a.Page||a.page||"Okänd sida",d=a["Page ID"]||a.pageId||`page_${r.replace(/\s+/g,"_")}`;n.has(d)||n.set(d,{pageId:d,pageName:r})})}),Array.from(n.values()).sort((c,a)=>c.pageName.localeCompare(a.pageName))},[i]),P=h.useMemo(()=>i?i.map(n=>({...n,sortKey:n.year*100+n.month})).sort((n,c)=>n.sortKey-c.sortKey):[],[i]),K=n=>["Jan","Feb","Mar","Apr","Maj","Jun","Jul","Aug","Sep","Okt","Nov","Dec"][n-1]||n.toString(),E=n=>({reach:"Reach",engagements:"Engagements",reactions:"Reactions",publications:"Publications"})[n]||n,Z=(n,c)=>{const a=c.indexOf(n);return a>=0?Ve[a%Ve.length]:Ve[0]},_=()=>{const n=document.querySelector("#trend-chart-svg");if(!n||I.length===0)return;const c=document.createElement("canvas"),a=c.getContext("2d"),r=1920,d=1080;c.width=r,c.height=d,a.fillStyle="white",a.fillRect(0,0,r,d);const u=new XMLSerializer().serializeToString(n),p=new Blob([u],{type:"image/svg+xml;charset=utf-8"}),S=window.URL||window.webkitURL,$=S.createObjectURL(p),M=new Image;M.onload=()=>{var le;a.drawImage(M,0,150,r,d-400),a.fillStyle="#1f2937",a.font="bold 48px Arial, sans-serif",a.textAlign="center";const D=`Utveckling över tid - ${(le=ue[s])==null?void 0:le.displayName}`;a.fillText(D,r/2,80),a.fillStyle="#4b5563",a.font="bold 32px Arial, sans-serif",a.textAlign="left";const G=d-200,Q=40,X=12,ce=20,oe=4,xe=r/Math.ceil(I.length/oe);I.forEach((ge,pe)=>{const de=Math.floor(pe/oe),fe=pe%oe,Me=100+de*xe,Te=G+fe*Q;a.fillStyle=ge.color,a.beginPath(),a.arc(Me,Te,X,0,2*Math.PI),a.fill(),a.strokeStyle="white",a.lineWidth=3,a.stroke(),a.fillStyle="#1f2937",a.font="28px Arial, sans-serif",a.fillText(ge.pageName,Me+X+ce,Te+8)}),c.toBlob(ge=>{const pe=S.createObjectURL(ge),de=document.createElement("a");de.href=pe;const fe=I.map(Te=>Te.pageName),Me=fe.length===1?fe[0].replace(/[^a-zA-Z0-9]/g,"-"):`${fe.length}-konton`;de.download=`trend-analys-${s}-${Me}-${new Date().toISOString().slice(0,10)}.png`,document.body.appendChild(de),de.click(),document.body.removeChild(de),S.revokeObjectURL(pe)},"image/png",1),S.revokeObjectURL($)},M.src=$},H=n=>{m(c=>c.includes(n)?c.filter(a=>a!==n):[...c,n])},W=n=>{t(n)},q=n=>{const c=`${n.year}-${n.month}`;b(a=>a.find(d=>`${d.year}-${d.month}`===c)?a.filter(d=>`${d.year}-${d.month}`!==c):[...a,n])},J=h.useMemo(()=>g.length>0&&g.length===P.length,[g.length,P.length]),re=()=>{b(J?[]:P)},V=h.useMemo(()=>{if(!i||o.length===0||g.length===0)return[];const n=[];return g.forEach(a=>{a.data&&Array.isArray(a.data)&&o.forEach(r=>{const d=a.data.find(u=>(u["Page ID"]||u.pageId||`page_${(u.Page||u.page||"").replace(/\s+/g,"_")}`)===r);if(d){const u=E(s),p=d[u];let S=0;if(p!=null&&p!==""){const $=String(p).replace(/[,\s]/g,"");S=parseFloat($)||0}n.push({periodKey:`${a.year}-${a.month.toString().padStart(2,"0")}`,period:`${K(a.month)} ${a.year}`,month:K(a.month),year:a.year,pageId:r,pageName:d.Page||d.page||"Okänd sida",value:S,metric:s})}})}),n},[i,o,g,s]),I=h.useMemo(()=>{const n=new Map;return V.forEach(c=>{n.has(c.pageId)||n.set(c.pageId,{pageId:c.pageId,pageName:c.pageName,points:[],color:Z(c.pageId,o)}),n.get(c.pageId).points.push(c)}),n.forEach(c=>{c.points.sort((a,r)=>a.periodKey.localeCompare(r.periodKey))}),Array.from(n.values())},[V,o]),j=h.useMemo(()=>{if(V.length===0)return{min:0,max:100};const n=V.map(d=>d.value),c=Math.min(...n),a=Math.max(...n),r=(a-c)*.1||10;return{min:Math.max(0,c-r),max:a+r}},[V]),w=n=>{if(n.length<2)return"";if(n.length===2){const[a,r]=n;return`M ${a.x} ${a.y} L ${r.x} ${r.y}`}let c=`M ${n[0].x} ${n[0].y}`;for(let a=1;a<n.length;a++){const r=n[a],d=n[a-1];if(a===1){const u=n[a+1]||r,p=d.x+(r.x-d.x)*.3,S=d.y+(r.y-d.y)*.3,$=r.x-(u.x-d.x)*.1,M=r.y-(u.y-d.y)*.1;c+=` C ${p} ${S}, ${$} ${M}, ${r.x} ${r.y}`}else if(a===n.length-1){const u=n[a-2]||d,p=d.x+(r.x-u.x)*.1,S=d.y+(r.y-u.y)*.1,$=r.x-(r.x-d.x)*.3,M=r.y-(r.y-d.y)*.3;c+=` C ${p} ${S}, ${$} ${M}, ${r.x} ${r.y}`}else{const u=n[a+1],p=n[a-2]||d,S=d.x+(r.x-p.x)*.1,$=d.y+(r.y-p.y)*.1,M=r.x-(u.x-d.x)*.1,D=r.y-(u.y-d.y)*.1;c+=` C ${S} ${$}, ${M} ${D}, ${r.x} ${r.y}`}}return c},v=(n,c)=>{const a=n.currentTarget.getBoundingClientRect();k({x:n.clientX-a.left,y:n.clientY-a.top}),A(c)},l=h.useMemo(()=>{if(!R)return[];const n=[];return Y.forEach(c=>{const a=R.getPageTimeseries(c.pageId);if(!a)return;const r=ta(a,s),d=na(r);r.length>0&&n.push({page:c,trendData:r,avgTrend:d,totalPeriods:r.length+1,latestChange:r[r.length-1]})}),n.sort((c,a)=>a.avgTrend.averagePercentageChange-c.avgTrend.averagePercentageChange)},[R,Y,s]);return!i||i.length===0?e.jsxs(L,{children:[e.jsx(O,{children:e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-5 w-5"}),"Trendanalys"]})}),e.jsx(B,{children:e.jsx("p",{className:"text-muted-foreground",children:"Ladda upp minst två månadsfiler för att se trendanalys."})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(L,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between",children:[e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"h-5 w-5"}),"Utveckling över tid"]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(F,{onClick:_,variant:"outline",size:"sm",disabled:I.length===0,children:"📊 Exportera PNG"})})]}),e.jsxs(B,{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 block",children:["Välj Facebook-sidor (",o.length," valda)"]}),e.jsx("div",{className:"max-h-32 overflow-y-auto border rounded p-2 space-y-1",children:Y.map(n=>{const c=o.includes(n.pageId);return e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:c,onChange:()=>H(n.pageId),className:"h-4 w-4 text-facebook-500 border-gray-300 rounded focus:ring-facebook-500"}),e.jsx("span",{className:"text-sm font-medium",children:n.pageName})]},n.pageId)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Välj datapunkt"}),e.jsx("div",{className:"space-y-2",children:la.map(n=>{const c=s===n.key;return e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"metric",checked:c,onChange:()=>W(n.key),className:"h-4 w-4 text-facebook-500 border-gray-300 focus:ring-facebook-500"}),e.jsx("span",{className:"text-sm font-medium",children:n.label})]},n.key)})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 block",children:["Välj perioder (",g.length," valda)"]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer mb-2 p-2 bg-gray-50 rounded",children:[e.jsx("input",{type:"checkbox",checked:J,onChange:re,className:"h-4 w-4 text-facebook-500 border-gray-300 rounded focus:ring-facebook-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Välj alla perioder"})]}),e.jsx("div",{className:"max-h-32 overflow-y-auto border rounded p-2 space-y-1",children:P.map(n=>{const c=g.some(a=>a.year===n.year&&a.month===n.month);return e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:c,onChange:()=>q(n),className:"h-4 w-4 text-facebook-500 border-gray-300 rounded focus:ring-facebook-500"}),e.jsxs("span",{className:"text-sm font-medium",children:[K(n.month)," ",n.year]})]},`${n.year}-${n.month}`)})})]})]}),s&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-center",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-900",children:["Visar: ",(x=ue[s])==null?void 0:x.displayName]}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Aktuell datapunkt som visas i diagrammet"})]}),I.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-wrap gap-3",children:I.map(n=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full border",style:{backgroundColor:n.color}}),e.jsx("span",{className:"text-sm font-medium",children:n.pageName})]},n.pageId))}),e.jsx("div",{className:"relative",children:e.jsxs("svg",{id:"trend-chart-svg",width:"100%",height:"500",viewBox:"0 0 1000 500",className:"border rounded bg-gray-50",onMouseLeave:()=>A(null),children:[e.jsx("defs",{children:e.jsx("pattern",{id:"grid",width:"50",height:"50",patternUnits:"userSpaceOnUse",children:e.jsx("path",{d:"M 50 0 L 0 0 0 50",fill:"none",stroke:"#e5e7eb",strokeWidth:"1"})})}),e.jsx("rect",{width:"100%",height:"100%",fill:"url(#grid)"}),[0,25,50,75,100].map(n=>{const c=450-n/100*380,a=j.min+n/100*(j.max-j.min);return e.jsxs("g",{children:[e.jsx("line",{x1:"70",y1:c,x2:"930",y2:c,stroke:"#d1d5db",strokeWidth:"1"}),e.jsx("text",{x:"65",y:c+4,textAnchor:"end",fontSize:"14",fill:"#6b7280",children:Math.round(a).toLocaleString()})]},n)}),P.map((n,c)=>{const a=70+c/Math.max(1,P.length-1)*860;return e.jsxs("g",{children:[e.jsx("line",{x1:a,y1:"70",x2:a,y2:"450",stroke:"#d1d5db",strokeWidth:"1"}),e.jsx("text",{x:a,y:"475",textAnchor:"middle",fontSize:"14",fill:"#6b7280",children:K(n.month)}),e.jsx("text",{x:a,y:"490",textAnchor:"middle",fontSize:"12",fill:"#9ca3af",children:n.year})]},`${n.year}-${n.month}`)}),I.map(n=>{if(n.points.length<1)return null;const c=n.points.map((a,r)=>{const u=70+P.findIndex(S=>`${S.year}-${S.month.toString().padStart(2,"0")}`===a.periodKey)/Math.max(1,P.length-1)*860,p=450-(a.value-j.min)/(j.max-j.min)*380;return{x:u,y:p,point:a}});return e.jsxs("g",{children:[n.points.length>1&&e.jsx("path",{d:w(c),fill:"none",stroke:n.color,strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),c.map(({x:a,y:r,point:d},u)=>e.jsx("circle",{cx:a,cy:r,r:"6",fill:n.color,stroke:"white",strokeWidth:"3",className:"cursor-pointer",onMouseEnter:p=>v(p,d),onMouseLeave:()=>A(null)},u))]},n.pageId)}),C&&e.jsx("g",{children:(()=>{var d;let a=y.x+15,r=y.y-35;return a+200>980&&(a=y.x-200-15),r<15&&(r=y.y+15),r+70>480&&(r=y.y-70-15),e.jsxs(e.Fragment,{children:[e.jsx("rect",{x:a,y:r,width:200,height:70,fill:"rgba(0,0,0,0.85)",rx:"6"}),e.jsx("text",{x:a+12,y:r+20,fill:"white",fontSize:"13",fontWeight:"bold",children:C.pageName}),e.jsx("text",{x:a+12,y:r+38,fill:"white",fontSize:"12",children:C.period}),e.jsxs("text",{x:a+12,y:r+55,fill:"white",fontSize:"12",children:[(d=ue[C.metric])==null?void 0:d.displayName,": ",C.value.toLocaleString()]})]})})()})]})})]}):e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(Ke,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"Välj sidor och perioder för att visa diagram"}),e.jsx("p",{className:"text-sm",children:o.length===0&&g.length===0?"Markera minst en Facebook-sida och period":o.length===0?"Markera minst en Facebook-sida i listan ovan":"Markera minst en period i listan ovan"})]})]})]}),e.jsxs(L,{children:[e.jsxs(O,{className:"flex flex-row items-center justify-between",children:[e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5"}),"Trendstatistik - ",(f=ue[s])==null?void 0:f.displayName]}),e.jsx(F,{variant:"outline",onClick:()=>z(!N),children:N?"Dölj detaljer":"Visa detaljer"})]}),e.jsx(B,{children:l.length===0?e.jsx("p",{className:"text-muted-foreground",children:"Ingen trenddata tillgänglig för vald metric."}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(ve,{className:"h-4 w-4 text-green-600"}),"Bäst presterande sidor"]}),l.slice(0,3).map((n,c)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:n.page.pageName}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[n.totalPeriods," månader"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-bold text-green-700",children:["+",n.avgTrend.averagePercentageChange.toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-green-600",children:"genomsnitt/månad"})]})]},n.page.pageId))]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(rs,{className:"h-4 w-4 text-red-600"}),"Sämst presterande sidor"]}),l.slice(-3).reverse().map((n,c)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 rounded",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:n.page.pageName}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[n.totalPeriods," månader"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-bold text-red-700",children:[n.avgTrend.averagePercentageChange.toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-red-600",children:"genomsnitt/månad"})]})]},n.page.pageId))]})]}),N&&e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-muted p-3 font-medium",children:"Detaljerad trendanalys för alla sidor"}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:l.map(n=>{var c;return e.jsxs("div",{className:"p-3 border-b last:border-b-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-medium",children:n.page.pageName}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:`px-2 py-1 rounded text-xs font-medium ${n.avgTrend.averagePercentageChange>0?"bg-green-100 text-green-800":n.avgTrend.averagePercentageChange<0?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:[n.avgTrend.averagePercentageChange>0?"+":"",n.avgTrend.averagePercentageChange.toFixed(1),"% snitt"]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[n.avgTrend.positiveMonths,"↗ ",n.avgTrend.negativeMonths,"↘ ",n.avgTrend.stableMonths,"→"]})]})]}),n.latestChange&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Senaste förändring: ",n.latestChange.previousPeriod," → ",n.latestChange.period,e.jsxs("span",{className:`ml-2 font-medium ${n.latestChange.percentageChange>0?"text-green-600":n.latestChange.percentageChange<0?"text-red-600":"text-gray-600"}`,children:[n.latestChange.percentageChange>0?"+":"",(c=n.latestChange.percentageChange)==null?void 0:c.toFixed(1),"%"]})]})]},n.page.pageId)})})]})]})})]})]})};function oa(){const[i,s]=h.useState(!1),[t,o]=h.useState(!1),[m,g]=h.useState("upload"),[b,C]=h.useState([]),A=k=>{console.log("Data uploaded successfully:",k),C(k),s(!0),o(!1),g("monthly")},y=()=>{o(!1)};return t?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"border-b border-border",children:e.jsx("div",{className:"container py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"facebook-brand flex items-center gap-3",children:[e.jsx(ie,{className:"h-8 w-8"}),e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Facebook API data analyser"})]}),e.jsxs(F,{variant:"outline",onClick:y,children:[e.jsx(Ts,{className:"mr-2 h-4 w-4"}),"Tillbaka"]})]})})}),e.jsx("main",{className:"container py-6",children:e.jsx(Us,{onDataUploaded:A,onCancel:y})})]}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"border-b border-border",children:e.jsx("div",{className:"container py-4",children:e.jsxs("div",{className:"facebook-brand flex items-center gap-3",children:[e.jsx(ie,{className:"h-8 w-8"}),e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Facebook API data analyser"})]})})}),e.jsx("main",{className:"container py-6",children:e.jsx("div",{className:"space-y-6",children:i?e.jsxs("div",{className:"grid gap-6",children:[e.jsxs(L,{children:[e.jsx(O,{children:e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5 text-facebook-500"}),"Uppladdad data"]})}),e.jsxs(B,{children:[e.jsxs("div",{className:"grid md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center p-3 bg-facebook-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-facebook-900",children:b.length}),e.jsx("div",{className:"text-sm text-facebook-700",children:"Månader"})]}),e.jsxs("div",{className:"text-center p-3 bg-facebook-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-facebook-900",children:b.reduce((k,N)=>k+N.pageCount,0)}),e.jsx("div",{className:"text-sm text-facebook-700",children:"Totalt dataposter"})]}),e.jsxs("div",{className:"text-center p-3 bg-facebook-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-facebook-900",children:b.length>0?Math.max(...b.map(k=>k.pageCount)):0}),e.jsx("div",{className:"text-sm text-facebook-700",children:"Sidor per månad"})]})]}),b.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Tillgängliga perioder:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:b.map((k,N)=>e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-facebook-50 text-facebook-700 border border-facebook-200",children:[k.displayName," (",k.pageCount," sidor)"]},N))})]})]})]}),e.jsxs(Ls,{value:m,onValueChange:g,children:[e.jsxs(us,{className:"grid w-full grid-cols-4",children:[e.jsxs(je,{value:"upload",children:[e.jsx(De,{className:"mr-2 h-4 w-4"}),"Ladda data"]}),e.jsxs(je,{value:"monthly",children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),"Månadsanalys"]}),e.jsxs(je,{value:"pages",children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),"Sidanalys"]}),e.jsxs(je,{value:"trends",children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Trender"]})]}),e.jsx(Ne,{value:"upload",className:"mt-6",children:e.jsxs(L,{children:[e.jsx(O,{children:e.jsx(U,{children:"Hantera CSV-data"})}),e.jsxs(B,{className:"space-y-4",children:[e.jsx("p",{className:"text-muted-foreground",children:"Hantera dina uppladdade CSV-filer och ladda upp ytterligare månadsdata."}),e.jsxs(F,{onClick:()=>o(!0),children:[e.jsx(De,{className:"mr-2 h-4 w-4"}),"Ladda upp mer data"]})]})]})}),e.jsx(Ne,{value:"monthly",className:"mt-6",children:e.jsx(Gs,{uploadedPeriods:b})}),e.jsx(Ne,{value:"pages",className:"mt-6",children:e.jsx(Hs,{uploadedPeriods:b})}),e.jsx(Ne,{value:"trends",className:"mt-6",children:e.jsx(ca,{uploadedPeriods:b})})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(L,{children:[e.jsx(O,{className:"text-center",children:e.jsx(U,{className:"text-2xl",children:"Välkommen till Facebook API data analyser"})}),e.jsxs(B,{className:"text-center space-y-4",children:[e.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto",children:"Analysera och visualisera utvecklingen av dina Facebook-sidor över tid. Ladda upp månadsvis CSV-data från Facebook API för att komma igång."}),e.jsxs(ae,{className:"max-w-2xl mx-auto",children:[e.jsx(Is,{className:"h-4 w-4"}),e.jsx(te,{children:"CSV-format som krävs"}),e.jsxs(ne,{children:["Filnamn: ",e.jsx("code",{children:"FB_YYYY_MM.csv"})," (ex: FB_2025_08.csv)",e.jsx("br",{}),"Kolumner: Page, Page ID, Reach, Engaged Users, Engagements, Reactions, Publications, Status, Comment"]})]}),e.jsx("div",{className:"pt-4",children:e.jsxs(F,{size:"lg",onClick:()=>o(!0),children:[e.jsx(De,{className:"mr-2 h-5 w-5"}),"Ladda upp CSV-filer"]})})]})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs(L,{className:"opacity-50",children:[e.jsxs(O,{children:[e.jsx(be,{className:"h-8 w-8 text-facebook-500 mb-2"}),e.jsx(U,{className:"text-lg",children:"Månadsanalys"})]}),e.jsx(B,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Jämför alla Facebook-sidor för en specifik månad och identifiera toppresterare"})})]}),e.jsxs(L,{className:"opacity-50",children:[e.jsxs(O,{children:[e.jsx(ve,{className:"h-8 w-8 text-facebook-500 mb-2"}),e.jsx(U,{className:"text-lg",children:"Trendanalys"})]}),e.jsx(B,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Upptäck trender och utvecklingsmönster över tid för alla Facebook-sidor"})})]}),e.jsxs(L,{className:"opacity-50",children:[e.jsxs(O,{children:[e.jsx(ie,{className:"h-8 w-8 text-facebook-500 mb-2"}),e.jsx(U,{className:"text-lg",children:"Sidanalys"})]}),e.jsx(B,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Djupdyk i specifika Facebook-sidor och deras utveckling över månader"})})]})]})]})})}),e.jsx("footer",{className:"border-t border-border mt-12",children:e.jsxs("div",{className:"container py-4 text-center text-sm text-muted-foreground",children:[e.jsxs("p",{children:["Facebook API data analyser © ",new Date().getFullYear()]}),e.jsxs("p",{className:"mt-1",children:["Tidserie-baserad analys av månadsstatistik |",e.jsx("span",{className:"text-facebook-500 font-medium",children:" Utvecklad för projektfas 1-8"})]})]})})]})}_e.createRoot(document.getElementById("root")).render(e.jsx(Es.StrictMode,{children:e.jsx(oa,{})}));
//# sourceMappingURL=index-BS-jJUCi.js.map
