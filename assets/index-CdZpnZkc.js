import{j as e,S as fa,L as Ze,T as Qe,C as ea,R as ja,U as ze,A as he,F as Na,a as fe,b as Ke,c as ya,X as ba,B as ne,d as aa,I as va,e as Sa,P as ka,f as sa,V as wa,g as ta,h as na,i as Ca,k as Pa,l as Aa,m as ra,n as Ea,o as Da,p as _e,q as je,r as ia,s as la,t as oa,u as ca,v as da,w as ma,x as ga,y as Ye,z as Ta,D as Ee,E as Ma,G as Ie}from"./ui-DvaxdRLu.js";import{b as Ia,r as h,R as Ra}from"./vendor-DB9HQzDI.js";import{t as $a,c as ha,P as _a}from"./utils-GaJ1HoMq.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))o(d);new MutationObserver(d=>{for(const m of d)if(m.type==="childList")for(const N of m.addedNodes)N.tagName==="LINK"&&N.rel==="modulepreload"&&o(N)}).observe(document,{childList:!0,subtree:!0});function t(d){const m={};return d.integrity&&(m.integrity=d.integrity),d.referrerPolicy&&(m.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?m.credentials="include":d.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function o(d){if(d.ep)return;d.ep=!0;const m=t(d);fetch(d.href,m)}})();var Oe={},He=Ia;Oe.createRoot=He.createRoot,Oe.hydrateRoot=He.hydrateRoot;function R(...r){return $a(ha(r))}const X=h.forwardRef(({className:r,...a},t)=>e.jsx("div",{ref:t,className:R("rounded-lg border bg-card text-card-foreground shadow-sm",r),...a}));X.displayName="Card";const J=h.forwardRef(({className:r,...a},t)=>e.jsx("div",{ref:t,className:R("flex flex-col space-y-1.5 p-6",r),...a}));J.displayName="CardHeader";const Z=h.forwardRef(({className:r,...a},t)=>e.jsx("h3",{ref:t,className:R("text-2xl font-semibold leading-none tracking-tight",r),...a}));Z.displayName="CardTitle";const Oa=h.forwardRef(({className:r,...a},t)=>e.jsx("p",{ref:t,className:R("text-sm text-muted-foreground",r),...a}));Oa.displayName="CardDescription";const Q=h.forwardRef(({className:r,...a},t)=>e.jsx("div",{ref:t,className:R("p-6 pt-0",r),...a}));Q.displayName="CardContent";const Fa=h.forwardRef(({className:r,...a},t)=>e.jsx("div",{ref:t,className:R("flex items-center p-6 pt-0",r),...a}));Fa.displayName="CardFooter";const Xe=r=>typeof r=="boolean"?`${r}`:r===0?"0":r,We=ha,ua=(r,a)=>t=>{var o;if((a==null?void 0:a.variants)==null)return We(r,t==null?void 0:t.class,t==null?void 0:t.className);const{variants:d,defaultVariants:m}=a,N=Object.keys(d).map(y=>{const C=t==null?void 0:t[y],b=m==null?void 0:m[y];if(C===null)return null;const B=Xe(C)||Xe(b);return d[y][B]}),k=t&&Object.entries(t).reduce((y,C)=>{let[b,B]=C;return B===void 0||(y[b]=B),y},{}),v=a==null||(o=a.compoundVariants)===null||o===void 0?void 0:o.reduce((y,C)=>{let{class:b,className:B,..._}=C;return Object.entries(_).every(Y=>{let[A,E]=Y;return Array.isArray(E)?E.includes({...m,...k}[A]):{...m,...k}[A]===E})?[...y,b,B]:y},[]);return We(r,N,v,t==null?void 0:t.class,t==null?void 0:t.className)},La=ua("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"underline-offset-4 hover:underline text-primary",facebook:"bg-facebook-500 text-white hover:bg-facebook-600"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),L=h.forwardRef(({className:r,variant:a,size:t,asChild:o=!1,...d},m)=>{const N=o?fa:"button";return e.jsx(N,{className:R(La({variant:a,size:t,className:r})),ref:m,...d})});L.displayName="Button";const Va=ja,xa=h.forwardRef(({className:r,...a},t)=>e.jsx(Ze,{ref:t,className:R("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",r),...a}));xa.displayName=Ze.displayName;const ye=h.forwardRef(({className:r,...a},t)=>e.jsx(Qe,{ref:t,className:R("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",r),...a}));ye.displayName=Qe.displayName;const be=h.forwardRef(({className:r,...a},t)=>e.jsx(ea,{ref:t,className:R("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...a}));be.displayName=ea.displayName;const Ba=ua("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive",success:"border-green-500/50 text-green-600 dark:text-green-400 [&>svg]:text-green-600",info:"border-facebook-300/50 text-facebook-600 dark:text-facebook-400 [&>svg]:text-facebook-600"}},defaultVariants:{variant:"default"}}),re=h.forwardRef(({className:r,variant:a,...t},o)=>e.jsx("div",{ref:o,role:"alert",className:R(Ba({variant:a}),r),...t}));re.displayName="Alert";const ie=h.forwardRef(({className:r,...a},t)=>e.jsx("h5",{ref:t,className:R("mb-1 font-medium leading-none tracking-tight",r),...a}));ie.displayName="AlertTitle";const le=h.forwardRef(({className:r,...a},t)=>e.jsx("div",{ref:t,className:R("text-sm [&_p]:leading-relaxed",r),...a}));le.displayName="AlertDescription";const qe=["Page","Page ID","Reach","Engaged Users","Engagements","Reactions","Publications","Status","Comment"];function Ua({onDataUploaded:r,onCancel:a}){const[t,o]=h.useState([]),[d,m]=h.useState(!1),[N,k]=h.useState(!1),[v,y]=h.useState([]),[C,b]=h.useState({}),B=h.useRef(null),_=j=>{const P=/^FB_(\d{4})_(\d{2})\.csv$/,S=j.match(P);if(!S)return{isValid:!1,error:"Felaktigt filnamnsformat. Förväntat: FB_YYYY_MM.csv (t.ex. FB_2025_08.csv)"};const l=parseInt(S[1]),x=parseInt(S[2]);return x<1||x>12?{isValid:!1,error:"Ogiltig månad. Måste vara mellan 01-12."}:l<2020||l>2030?{isValid:!1,error:"Ogiltigt år. Måste vara mellan 2020-2030."}:{isValid:!0,year:l,month:x,displayName:`${Y(x)} ${l}`}},Y=j=>["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"][j-1],A=(j,P)=>new Promise(S=>{_a.parse(j,{header:!0,skipEmptyLines:!0,complete:l=>{if(l.errors.length>0){S({isValid:!1,error:`CSV-parsningsfel: ${l.errors[0].message}`,data:null});return}const x=l.meta.fields||[],f=qe.filter(n=>!x.includes(n));if(f.length>0){S({isValid:!1,error:`Saknade kolumner: ${f.join(", ")}`,data:null});return}if(l.data.length===0){S({isValid:!1,error:"CSV-filen innehåller ingen data",data:null});return}S({isValid:!0,data:l.data,pageCount:l.data.length,error:null})}})}),E=j=>{j.preventDefault(),j.stopPropagation(),k(!1);const P=Array.from(j.dataTransfer.files),S=P.filter(l=>l.name.toLowerCase().endsWith(".csv"));S.length!==P.length&&y(l=>[...l,"Endast CSV-filer är tillåtna"]),S.length>0&&T(S)},D=j=>{const P=Array.from(j.target.files);T(P)},T=j=>{const P=j.map(f=>{const n=_(f.name);return{file:f,id:Math.random().toString(36),name:f.name,size:f.size,validation:n,status:n.isValid?"pending":"error"}}),S=t.map(f=>f.name),l=P.filter(f=>S.includes(f.name));l.length>0&&y(f=>[...f,`Följande filer är redan valda: ${l.map(n=>n.name).join(", ")}`]);const x=P.filter(f=>!S.includes(f.name));o(f=>[...f,...x])},$=j=>{o(P=>P.filter(S=>S.id!==j))},z=async()=>{m(!0),y([]),b({});const j=t.filter(S=>S.validation.isValid),P=[];for(const S of j){b(l=>({...l,[S.id]:"processing"}));try{const l=await M(S.file),x=await A(l,S.name);if(!x.isValid){b(n=>({...n,[S.id]:"error"})),y(n=>[...n,`${S.name}: ${x.error}`]);continue}const f={...S.validation,data:x.data,pageCount:x.pageCount,filename:S.name};P.push(f),b(n=>({...n,[S.id]:"success"})),await new Promise(n=>setTimeout(n,500))}catch(l){b(x=>({...x,[S.id]:"error"})),y(x=>[...x,`${S.name}: ${l.message}`])}}m(!1),P.length>0&&r(P)},M=j=>new Promise((P,S)=>{const l=new FileReader;l.onload=x=>P(x.target.result),l.onerror=()=>S(new Error("Kunde inte läsa fil")),l.readAsText(j)}),q=j=>{j.preventDefault(),j.stopPropagation(),k(!0)},W=j=>{j.preventDefault(),j.stopPropagation(),k(!1)},oe=()=>{y([])},U=t.filter(j=>j.validation.isValid).length,V=U>0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(X,{children:[e.jsxs(J,{children:[e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"h-5 w-5 text-facebook-500"}),"Ladda upp Facebook CSV-filer"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Släpp dina FB_YYYY_MM.csv filer här eller klicka för att välja filer"})]}),e.jsx(Q,{children:e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors cursor-pointer ${N?"border-facebook-400 bg-facebook-50":"border-gray-300 hover:border-facebook-400 hover:bg-facebook-50"}`,onDrop:E,onDragOver:q,onDragLeave:W,onClick:()=>{var j;return(j=B.current)==null?void 0:j.click()},children:[e.jsx("input",{type:"file",ref:B,onChange:D,multiple:!0,accept:".csv",className:"hidden"}),e.jsx(ze,{className:"h-12 w-12 mx-auto mb-4 text-facebook-400"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:N?"Släpp filerna här":"Ladda upp CSV-filer"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Släpp dina FB_YYYY_MM.csv filer här eller klicka för att välja"}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Format:"})," FB_YYYY_MM.csv (t.ex. FB_2025_08.csv)"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Kolumner:"})," ",qe.join(", ")]})]})]})})]}),v.length>0&&e.jsxs(re,{variant:"destructive",children:[e.jsx(he,{className:"h-4 w-4"}),e.jsx(ie,{children:"Valideringsfel"}),e.jsxs(le,{children:[e.jsx("ul",{className:"list-disc list-inside space-y-1",children:v.map((j,P)=>e.jsx("li",{children:j},P))}),e.jsx(L,{variant:"outline",size:"sm",onClick:oe,className:"mt-2",children:"Rensa fel"})]})]}),t.length>0&&e.jsxs(X,{children:[e.jsx(J,{children:e.jsxs(Z,{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["Valda filer (",t.length,")"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[U," giltiga filer"]})]})}),e.jsx(Q,{children:e.jsx("div",{className:"space-y-2",children:t.map(j=>{const P=C[j.id]||j.status;return e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg border ${j.validation.isValid?"border-green-200 bg-green-50":"border-red-200 bg-red-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Na,{className:"h-4 w-4"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:j.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:j.validation.isValid?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(fe,{className:"h-3 w-3"}),j.validation.displayName]}):e.jsx("span",{className:"text-red-600",children:j.validation.error})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[P==="processing"&&e.jsx(Ke,{className:"h-4 w-4 animate-spin text-blue-500"}),P==="success"&&e.jsx(ya,{className:"h-4 w-4 text-green-500"}),P==="error"&&e.jsx(he,{className:"h-4 w-4 text-red-500"}),e.jsx(L,{variant:"ghost",size:"sm",onClick:()=>$(j.id),disabled:d,children:e.jsx(ba,{className:"h-4 w-4"})})]})]},j.id)})})})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(L,{variant:"outline",onClick:a,disabled:d,children:"Avbryt"}),e.jsxs("div",{className:"flex gap-2",children:[t.length>0&&e.jsx(L,{variant:"outline",onClick:()=>o([]),disabled:d,children:"Rensa alla"}),e.jsx(L,{onClick:z,disabled:!V||d,className:"min-w-[120px]",children:d?e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"mr-2 h-4 w-4 animate-spin"}),"Bearbetar..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"mr-2 h-4 w-4"}),"Analysera data (",U,")"]})})]})]})]})}const Fe=h.forwardRef(({className:r,...a},t)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:t,className:R("w-full caption-bottom text-sm",r),...a})}));Fe.displayName="Table";const Le=h.forwardRef(({className:r,...a},t)=>e.jsx("thead",{ref:t,className:R("[&_tr]:border-b",r),...a}));Le.displayName="TableHeader";const Ve=h.forwardRef(({className:r,...a},t)=>e.jsx("tbody",{ref:t,className:R("[&_tr:last-child]:border-0",r),...a}));Ve.displayName="TableBody";const ve=h.forwardRef(({className:r,...a},t)=>e.jsx("tr",{ref:t,className:R("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",r),...a}));ve.displayName="TableRow";const Se=h.forwardRef(({className:r,...a},t)=>e.jsx("th",{ref:t,className:R("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",r),...a}));Se.displayName="TableHead";const ke=h.forwardRef(({className:r,...a},t)=>e.jsx("td",{ref:t,className:R("p-4 align-middle [&:has([role=checkbox])]:pr-0",r),...a}));ke.displayName="TableCell";const De=Ea,Te=Da,we=h.forwardRef(({className:r,children:a,...t},o)=>e.jsxs(aa,{ref:o,className:R("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),...t,children:[a,e.jsx(va,{asChild:!0,children:e.jsx(Sa,{className:"h-4 w-4 opacity-50"})})]}));we.displayName=aa.displayName;const Ce=h.forwardRef(({className:r,children:a,position:t="popper",...o},d)=>e.jsx(ka,{children:e.jsx(sa,{ref:d,className:R("relative z-50 min-w-[8rem] overflow-hidden rounded-md border bg-white text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",r),position:t,...o,children:e.jsx(wa,{className:R("p-1 max-h-[300px] overflow-y-auto",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a})})}));Ce.displayName=sa.displayName;const za=h.forwardRef(({className:r,...a},t)=>e.jsx(ta,{ref:t,className:R("py-1.5 pl-8 pr-2 text-sm font-semibold",r),...a}));za.displayName=ta.displayName;const Pe=h.forwardRef(({className:r,children:a,...t},o)=>e.jsxs(na,{ref:o,className:R("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ca,{children:e.jsx(Pa,{className:"h-4 w-4"})})}),e.jsx(Aa,{children:a})]}));Pe.displayName=na.displayName;const Ka=h.forwardRef(({className:r,...a},t)=>e.jsx(ra,{ref:t,className:R("-mx-1 my-1 h-px bg-muted",r),...a}));Ka.displayName=ra.displayName;const se={P1:"#0066cc",P2:"#ff6600",P3:"#00cc66",P4:"#cc33cc",EKOT:"#005eb8",RADIOSPORTEN:"#1c5c35",SR:"#000000",default:"#000000"},Ge=({pageName:r})=>{const a=r||"Okänd";let t=se.default,o="";const d=a.toLowerCase();d.includes("ekot")||d.includes("radio sweden")?(t=se.EKOT,o="E"):d.includes("radiosporten")||d.includes("radio sporten")?(t=se.RADIOSPORTEN,o="RS"):d.includes("p1")?(t=se.P1,o="P1"):d.includes("p2")?(t=se.P2,o="P2"):d.includes("p3")?(t=se.P3,o="P3"):d.includes("p4")?(t=se.P4,o="P4"):d.includes("sveriges radio")&&!d.includes("p1")&&!d.includes("p2")&&!d.includes("p3")&&!d.includes("p4")?(t=se.SR,o="SR"):o=a.charAt(0).toUpperCase();const N=t===se.P2||t===se.P3?"text-black":"text-white";return e.jsx("div",{className:`flex-shrink-0 w-6 h-6 rounded-sm flex items-center justify-center text-xs font-bold ${N}`,style:{backgroundColor:t},title:r,children:o})},Ya=[{value:6,label:"6 per sida"},{value:12,label:"12 per sida"},{value:24,label:"24 per sida"}],Ha=[{key:"reach",label:"Räckvidd",canSum:!1},{key:"engagements",label:"Engagemang",canSum:!0},{key:"reactions",label:"Reaktioner",canSum:!0},{key:"publications",label:"Publiceringar",canSum:!0},{key:"status",label:"Status",canSum:!0},{key:"comment",label:"Kommentarer",canSum:!0}],Re={reach:{displayName:"Räckvidd",canSumAcrossPages:!1,category:"unique_persons"},engagements:{displayName:"Engagemang",canSumAcrossPages:!0,category:"countable"},reactions:{displayName:"Reaktioner",canSumAcrossPages:!0,category:"countable"},publications:{displayName:"Publiceringar",canSumAcrossPages:!0,category:"countable"},status:{displayName:"Status",canSumAcrossPages:!0,category:"countable"},comment:{displayName:"Kommentarer",canSumAcrossPages:!0,category:"countable"}};function Xa({uploadedPeriods:r=[]}){const[a,t]=h.useState([]),[o,d]=h.useState(""),[m,N]=h.useState([]),[k,v]=h.useState(!0),[y,C]=h.useState(null),[b,B]=h.useState(null),[_,Y]=h.useState({}),[A,E]=h.useState({key:"year_month",direction:"desc"}),[D,T]=h.useState(1),[$,z]=h.useState(12),[M,q]=h.useState(["reach","engagements","publications"]);h.useEffect(()=>{(()=>{try{if(v(!0),r.length===0){t([]),v(!1);return}const i=new Map;r.forEach(u=>{u.data&&Array.isArray(u.data)&&u.data.forEach(p=>{const w=p.Page||p.page||"Okänd sida",O=p["Page ID"]||p.pageId||`page_${w.replace(/\s+/g,"_")}`;i.has(O)||i.set(O,{pageId:O,pageName:w})})});const g=Array.from(i.values()).sort((u,p)=>u.pageName.localeCompare(p.pageName));t(g),g.length>0&&d(g[0].pageId)}catch(i){console.error("Error loading pages:",i),C("Kunde inte ladda tillgängliga Facebook-sidor")}finally{v(!1)}})()},[r]),h.useEffect(()=>{if(!o||r.length===0)return;(()=>{try{v(!0),C(null);const i=[];if(r.forEach(u=>{if(u.data&&Array.isArray(u.data)){const p=u.data.find(w=>(w["Page ID"]||w.pageId||`page_${(w.Page||w.page||"").replace(/\s+/g,"_")}`)===o);p&&i.push({year:u.year,month:u.month,pageName:p.Page||p.page||"Okänd sida",pageId:o,metrics:{reach:W(p.Reach||p.reach),engagements:W(p.Engagements||p.engagements),reactions:W(p.Reactions||p.reactions),publications:W(p.Publications||p.publications),status:W(p.Status||p.status),comment:W(p.Comment||p.comment)}})}}),i.length===0){const u=a.find(p=>p.pageId===o);C(`Ingen tidserie-data hittades för ${(u==null?void 0:u.pageName)||"vald sida"}`);return}const g=i.sort((u,p)=>u.year!==p.year?p.year-u.year:p.month-u.month);N(g),oe(g)}catch(i){console.error("Error loading page timeseries:",i);const g=a.find(u=>u.pageId===o);C(`Kunde inte ladda data för ${(g==null?void 0:g.pageName)||"vald sida"}`)}finally{v(!1)}})()},[o,r,a]);const W=s=>{if(s==null||s==="")return 0;const i=parseFloat(String(s).replace(/[,\s]/g,""));return isNaN(i)?0:i},oe=s=>{var w,O,I;if(s.length===0)return;const i=a.find(F=>F.pageId===o),g={pageName:(i==null?void 0:i.pageName)||((w=s[0])==null?void 0:w.pageName)||"Okänd sida",totalPeriods:s.length,firstPeriod:s[s.length-1],lastPeriod:s[0],metrics:{}},u=["reach","engagements","reactions","publications"];for(const F of u){const K=s.map(ee=>ee.metrics[F]).filter(ee=>ee!=null&&!isNaN(ee));if(K.length>0){const ee=K.reduce((me,G)=>me+G,0)/K.length,ae=Math.min(...K),ce=Math.max(...K),de=s.find(me=>me.metrics[F]===ce),ge=s.find(me=>me.metrics[F]===ae);g.metrics[F]={average:Math.round(ee),min:ae,max:ce,bestMonth:de?{year:de.year,month:de.month,value:ce}:null,worstMonth:ge?{year:ge.year,month:ge.month,value:ae}:null}}}B(g);const p={};for(const F of M)if(s.length>=2){const K=((O=s[s.length-1])==null?void 0:O.metrics[F])||0,ae=(((I=s[0])==null?void 0:I.metrics[F])||0)-K,ce=K>0?ae/K*100:0;p[F]={change:ae,percentChange:Math.round(ce*10)/10,trend:ae>0?"up":ae<0?"down":"stable"}}Y(p)},U=s=>["Jan","Feb","Mar","Apr","Maj","Jun","Jul","Aug","Sep","Okt","Nov","Dec"][s-1],V=h.useMemo(()=>m.length?[...m].sort((s,i)=>{let g,u;A.key==="year_month"?(g=s.year*100+s.month,u=i.year*100+i.month):(g=s.metrics[A.key]||0,u=i.metrics[A.key]||0);const p=g-u;return A.direction==="asc"?p:-p}):[],[m,A]),j=h.useMemo(()=>{const s=(D-1)*$;return V.slice(s,s+$)},[V,D,$]),P=Math.ceil(V.length/$),S=s=>{E(i=>({key:s,direction:i.key===s&&i.direction==="asc"?"desc":"asc"}))},l=s=>A.key!==s?e.jsx(da,{className:"h-4 w-4 ml-1 opacity-50"}):A.direction==="asc"?e.jsx(ma,{className:"h-4 w-4 ml-1"}):e.jsx(ga,{className:"h-4 w-4 ml-1"}),x=s=>{q(i=>i.includes(s)?i.filter(g=>g!==s):[...i,s])},f=()=>{const s=a.find(I=>I.pageId===o),i=["År","Månad","Period",...M.map(I=>{const F=Re[I];return F?F.displayName:I})],g=V.map(I=>[I.year,I.month,`${U(I.month)} ${I.year}`,...M.map(F=>I.metrics[F]||0)]),u=[i.join(","),...g.map(I=>I.join(","))].join(`
`),p=new Blob([u],{type:"text/csv;charset=utf-8;"}),w=document.createElement("a"),O=URL.createObjectURL(p);w.setAttribute("href",O),w.setAttribute("download",`${s==null?void 0:s.pageName.replace(/[^a-zA-Z0-9]/g,"_")}_tidsserie.csv`),w.style.visibility="hidden",document.body.appendChild(w),w.click(),document.body.removeChild(w)},n=s=>s==null||isNaN(s)?"-":new Intl.NumberFormat("sv-SE").format(s);if(k)return e.jsxs(re,{children:[e.jsx(_e,{className:"h-4 w-4"}),e.jsx(ie,{children:"Laddar data"}),e.jsx(le,{children:"Analyserar tidserie-data för Facebook-sidor..."})]});if(y)return e.jsxs(re,{variant:"destructive",children:[e.jsx(he,{className:"h-4 w-4"}),e.jsx(ie,{children:"Fel"}),e.jsx(le,{children:y})]});if(a.length===0)return e.jsxs(re,{children:[e.jsx(he,{className:"h-4 w-4"}),e.jsx(ie,{children:"Inga sidor hittades"}),e.jsx(le,{children:"Kunde inte hitta några Facebook-sidor i den uppladdade datan."})]});const c=a.find(s=>s.pageId===o);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(X,{children:[e.jsx(J,{children:e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-5 w-5 text-facebook-500"}),"Sidanalys över tid"]})}),e.jsxs(Q,{children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Välj Facebook-sida"}),e.jsxs(De,{value:o,onValueChange:d,children:[e.jsx(we,{children:e.jsx(Te,{placeholder:"Välj sida att analysera"})}),e.jsx(Ce,{children:a.map(s=>e.jsx(Pe,{value:s.pageId,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ge,{pageName:s.pageName}),e.jsx("span",{children:s.pageName})]})},s.pageId))})]}),c&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["ID: ",c.pageId]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Metrics att visa"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:Ha.map(s=>{const i=M.includes(s.key);return e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i,onChange:()=>x(s.key),className:"h-4 w-4 text-facebook-500 border-gray-300 rounded focus:ring-facebook-500"}),e.jsx("span",{className:"text-sm font-medium",children:s.label}),!s.canSum&&e.jsx("span",{className:"text-xs text-orange-600 font-medium",children:"*"})]},s.key)})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"* = Kan inte summeras över månader (unika personer)"})]})]}),b&&e.jsxs("div",{className:"grid md:grid-cols-4 gap-4 mb-6 p-4 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-facebook-600 flex items-center justify-center gap-2",children:[e.jsx(Ge,{pageName:b.pageName}),b.totalPeriods]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Månader data"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-semibold",children:[U(b.firstPeriod.month)," ",b.firstPeriod.year]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Första månad"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-semibold",children:[U(b.lastPeriod.month)," ",b.lastPeriod.year]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Senaste månad"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-facebook-600",children:(c==null?void 0:c.pageName)||"Okänd sida"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Vald sida"})]})]}),Object.keys(_).length>0&&e.jsx("div",{className:"grid md:grid-cols-3 gap-4 mb-6",children:M.slice(0,3).map(s=>{const i=_[s],g=Re[s];return!i||!g?null:e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white border rounded-lg",children:[i.trend==="up"&&e.jsx(je,{className:"h-5 w-5 text-green-600"}),i.trend==="down"&&e.jsx(ia,{className:"h-5 w-5 text-red-600"}),i.trend==="stable"&&e.jsx(_e,{className:"h-5 w-5 text-gray-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm",children:g.displayName}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[i.percentChange>0?"+":"",i.percentChange,"% sedan första månad"]})]})]},s)})})]})]}),e.jsxs(X,{children:[e.jsxs(J,{className:"flex flex-row items-center justify-between",children:[e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-5 w-5"}),"Månadsvis utveckling - ",(c==null?void 0:c.pageName)||"Okänd sida"]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(L,{onClick:f,variant:"outline",size:"sm",children:[e.jsx(la,{className:"h-4 w-4 mr-2"}),"CSV"]})})]}),e.jsxs(Q,{children:[m.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Ingen tidserie-data tillgänglig för vald sida"}):e.jsxs(e.Fragment,{children:[e.jsxs(Fe,{children:[e.jsx(Le,{children:e.jsxs(ve,{children:[e.jsx(Se,{className:"cursor-pointer select-none",onClick:()=>S("year_month"),children:e.jsxs("div",{className:"flex items-center",children:["Period",l("year_month")]})}),M.map(s=>{const i=Re[s];return e.jsx(Se,{className:"text-right cursor-pointer select-none",onClick:()=>S(s),children:e.jsxs("div",{className:"flex items-center justify-end",children:[(i==null?void 0:i.displayName)||s,l(s),!(i!=null&&i.canSumAcrossPages)&&e.jsx("span",{className:"ml-1 text-orange-600",children:"*"})]})},s)})]})}),e.jsx(Ve,{children:j.map((s,i)=>e.jsxs(ve,{children:[e.jsxs(ke,{className:"font-medium",children:[U(s.month)," ",s.year]}),M.map(g=>{var u,p;return e.jsx(ke,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[n(s.metrics[g]),((u=b==null?void 0:b.metrics[g])==null?void 0:u.bestMonth)&&b.metrics[g].bestMonth.year===s.year&&b.metrics[g].bestMonth.month===s.month&&e.jsx("span",{className:"text-yellow-600",title:"Bästa värde för denna sida",children:"🏆"}),((p=b==null?void 0:b.metrics[g])==null?void 0:p.worstMonth)&&b.metrics[g].worstMonth.year===s.year&&b.metrics[g].worstMonth.month===s.month&&e.jsx("span",{className:"text-gray-500",title:"Sämsta värde för denna sida",children:"📉"})]})},g)})]},`${s.year}_${s.month}`))})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Visa:"}),e.jsxs(De,{value:$.toString(),onValueChange:s=>{z(Number(s)),T(1)},children:[e.jsx(we,{className:"w-[120px]",children:e.jsx(Te,{})}),e.jsx(Ce,{children:Ya.map(s=>e.jsx(Pe,{value:s.value.toString(),children:s.label},s.value))})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Visar ",(D-1)*$+1," till ",Math.min(D*$,V.length)," av ",V.length]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{variant:"outline",size:"sm",onClick:()=>T(s=>Math.max(1,s-1)),disabled:D===1,children:e.jsx(oa,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-sm",children:["Sida ",D," av ",P]}),e.jsx(L,{variant:"outline",size:"sm",onClick:()=>T(s=>Math.min(P,s+1)),disabled:D>=P,children:e.jsx(ca,{className:"h-4 w-4"})})]})]})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-muted/30 rounded-lg",children:e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"🏆 = Bästa värde för denna sida"}),e.jsx("span",{className:"mx-4",children:"📉 = Sämsta värde för denna sida"})]}),e.jsx("div",{className:"text-muted-foreground text-xs",children:"Gröna värden = bästa prestanda, röda värden = sämsta prestanda för vald tidsperiod"})]})})]})]})]})}const te={P1:"#0066cc",P2:"#ff6600",P3:"#00cc66",P4:"#cc33cc",EKOT:"#005eb8",RADIOSPORTEN:"#1c5c35",SR:"#000000",default:"#000000"},Wa=({pageName:r})=>{const a=r||"Okänd";let t=te.default,o="";const d=a.toLowerCase();d.includes("ekot")||d.includes("radio sweden")?(t=te.EKOT,o="E"):d.includes("radiosporten")||d.includes("radio sporten")?(t=te.RADIOSPORTEN,o="RS"):d.includes("p1")?(t=te.P1,o="P1"):d.includes("p2")?(t=te.P2,o="P2"):d.includes("p3")?(t=te.P3,o="P3"):d.includes("p4")?(t=te.P4,o="P4"):d.includes("sveriges radio")&&!d.includes("p1")&&!d.includes("p2")&&!d.includes("p3")&&!d.includes("p4")?(t=te.SR,o="SR"):o=a.charAt(0).toUpperCase();const N=t===te.P2||t===te.P3?"text-black":"text-white";return e.jsx("div",{className:`flex-shrink-0 w-6 h-6 rounded-sm flex items-center justify-center text-xs font-bold ${N}`,style:{backgroundColor:t},title:r,children:o})},qa=[{value:10,label:"10 per sida"},{value:25,label:"25 per sida"},{value:50,label:"50 per sida"}],Ga=[{key:"reach",label:"Räckvidd",canSum:!1},{key:"engagements",label:"Engagemang",canSum:!0},{key:"reactions",label:"Reaktioner",canSum:!0},{key:"publications",label:"Publiceringar",canSum:!0}],xe={reach:{displayName:"Räckvidd",canSumAcrossPages:!1,category:"unique_persons"},engagements:{displayName:"Engagemang",canSumAcrossPages:!0,category:"countable"},reactions:{displayName:"Reaktioner",canSumAcrossPages:!0,category:"countable"},publications:{displayName:"Publiceringar",canSumAcrossPages:!0,category:"countable"}};function Ja({uploadedPeriods:r=[]}){const[a,t]=h.useState(null),[o,d]=h.useState([]),[m,N]=h.useState(null),[k,v]=h.useState(!1),[y,C]=h.useState(null),[b,B]=h.useState({key:"pageName",direction:"asc"}),[_,Y]=h.useState(1),[A,E]=h.useState(25),[D,T]=h.useState(["reach","engagements","publications"]);h.useEffect(()=>{if(r.length>0&&!a){const l=r[0];t({year:l.year,month:l.month})}},[r,a]),h.useEffect(()=>{if(!a)return;(()=>{try{v(!0),C(null);const x=r.find(c=>c.year===a.year&&c.month===a.month);if(!x){C(`Ingen data hittades för ${z(a.month)} ${a.year}`),d([]),N(null);return}const f=x.data.map(c=>({page:{pageName:c.Page||c.page||"Okänd sida",pageId:c["Page ID"]||c.pageId||"unknown"},period:{year:a.year,month:a.month},metrics:{reach:$(c.Reach||c.reach),engagements:$(c.Engagements||c.engagements),reactions:$(c.Reactions||c.reactions),publications:$(c.Publications||c.publications)}}));d(f);const n=M(f,a.year,a.month);N(n)}catch(x){console.error("Error loading period data:",x),C(`Kunde inte ladda data för ${z(a.month)} ${a.year}`)}finally{v(!1)}})()},[a,r]);const $=l=>{if(l==null||l==="")return 0;const x=parseFloat(String(l).replace(/[,\s]/g,""));return isNaN(x)?0:x},z=l=>["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"][l-1],M=(l,x,f)=>{if(!l.length)return null;const n={period:{year:x,month:f},totalPages:l.length,metrics:{}},c=["reach","engagements","reactions","publications"];for(const s of c){const i=l.map(u=>u.metrics[s]).filter(u=>u!=null&&!isNaN(u)&&u>=0);if(i.length===0){n.metrics[s]={total:0,average:0,min:0,max:0,validPages:0,type:xe[s].category};continue}if(!xe[s].canSumAcrossPages)n.metrics[s]={average:Math.round(i.reduce((u,p)=>u+p,0)/i.length),min:Math.min(...i),max:Math.max(...i),validPages:i.length,type:"unique_persons",note:"Genomsnitt över sidor - total reach kan inte beräknas"};else{const u=i.reduce((p,w)=>p+w,0);n.metrics[s]={total:u,average:Math.round(u/i.length),min:Math.min(...i),max:Math.max(...i),validPages:i.length,type:"countable"}}}return n},q=h.useMemo(()=>o.length?[...o].sort((l,x)=>{let f,n;if(b.key==="pageName"?(f=l.page.pageName,n=x.page.pageName):(f=l.metrics[b.key]||0,n=x.metrics[b.key]||0),typeof f=="string"){const s=f.localeCompare(n);return b.direction==="asc"?s:-s}const c=f-n;return b.direction==="asc"?c:-c}):[],[o,b]),W=h.useMemo(()=>{const l=(_-1)*A;return q.slice(l,l+A)},[q,_,A]),oe=Math.ceil(q.length/A),U=l=>{B(x=>({key:l,direction:x.key===l&&x.direction==="asc"?"desc":"asc"}))},V=l=>b.key!==l?e.jsx(da,{className:"h-4 w-4 ml-1 opacity-50"}):b.direction==="asc"?e.jsx(ma,{className:"h-4 w-4 ml-1"}):e.jsx(ga,{className:"h-4 w-4 ml-1"}),j=l=>{T(x=>x.includes(l)?x.filter(f=>f!==l):[...x,l])},P=()=>{const l=["Sidnamn","Sido-ID",...D.map(g=>{const u=xe[g];return u?u.displayName:g})],x=q.map(g=>[g.page.pageName,g.page.pageId,...D.map(u=>g.metrics[u]||0)]),f=[l.join(","),...x.map(g=>g.join(","))].join(`
`),n=new Blob([f],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a"),s=URL.createObjectURL(n);c.setAttribute("href",s);const i=a?`${z(a.month)}_${a.year}`:"månadsjämförelse";c.setAttribute("download",`Facebook_${i}.csv`),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c)},S=l=>l==null||isNaN(l)?"-":new Intl.NumberFormat("sv-SE").format(l);return k?e.jsxs(re,{children:[e.jsx(_e,{className:"h-4 w-4"}),e.jsx(ie,{children:"Laddar data"}),e.jsx(le,{children:"Analyserar månadsdata för Facebook-sidor..."})]}):y?e.jsxs(re,{variant:"destructive",children:[e.jsx(he,{className:"h-4 w-4"}),e.jsx(ie,{children:"Fel"}),e.jsx(le,{children:y})]}):r.length===0?e.jsxs(re,{children:[e.jsx(he,{className:"h-4 w-4"}),e.jsx(ie,{children:"Ingen data"}),e.jsx(le,{children:"Ladda upp CSV-filer för att visa månadsvis jämförelse av Facebook-sidor."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(X,{children:[e.jsx(J,{children:e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-5 w-5 text-facebook-500"}),"Månadsvis jämförelse"]})}),e.jsxs(Q,{children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Välj månad"}),e.jsxs(De,{value:a?`${a.year}_${a.month}`:"",onValueChange:l=>{const[x,f]=l.split("_");t({year:parseInt(x),month:parseInt(f)})},children:[e.jsx(we,{children:e.jsx(Te,{placeholder:"Välj månad att analysera"})}),e.jsx(Ce,{children:r.map(l=>e.jsxs(Pe,{value:`${l.year}_${l.month}`,children:[z(l.month)," ",l.year]},`${l.year}_${l.month}`))})]}),a&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Visar data för ",z(a.month)," ",a.year]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Metrics att visa"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:Ga.map(l=>{const x=D.includes(l.key);return e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:x,onChange:()=>j(l.key),className:"h-4 w-4 text-facebook-500 border-gray-300 rounded focus:ring-facebook-500"}),e.jsx("span",{className:"text-sm font-medium",children:l.label}),!l.canSum&&e.jsx("span",{className:"text-xs text-orange-600 font-medium",children:"*"})]},l.key)})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"* = Kan inte summeras över sidor (unika personer per månad)"})]})]}),m&&e.jsxs("div",{className:"grid md:grid-cols-4 gap-4 mb-6 p-4 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-facebook-600",children:m.totalPages}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Facebook-sidor"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-semibold",children:[z(m.period.month)," ",m.period.year]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Vald period"})]}),D.slice(0,2).map(l=>{const x=m.metrics[l],f=xe[l];return!x||!f?null:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold",children:f.canSumAcrossPages?S(x.total):S(x.average)}),e.jsx("div",{className:"text-sm text-muted-foreground",children:f.canSumAcrossPages?`Total ${f.displayName}`:`Snitt ${f.displayName}`})]},l)})]})]})]}),e.jsxs(X,{children:[e.jsxs(J,{className:"flex flex-row items-center justify-between",children:[e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-5 w-5"}),a?`${z(a.month)} ${a.year} - Alla sidor`:"Månadsdata"]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(L,{onClick:P,variant:"outline",size:"sm",children:[e.jsx(la,{className:"h-4 w-4 mr-2"}),"CSV"]})})]}),e.jsxs(Q,{children:[o.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Ingen data tillgänglig för vald månad"}):e.jsxs(e.Fragment,{children:[e.jsxs(Fe,{children:[e.jsx(Le,{children:e.jsxs(ve,{children:[e.jsx(Se,{className:"cursor-pointer select-none",onClick:()=>U("pageName"),children:e.jsxs("div",{className:"flex items-center",children:["Sidnamn",V("pageName")]})}),D.map(l=>{const x=xe[l];return e.jsx(Se,{className:"text-right cursor-pointer select-none",onClick:()=>U(l),children:e.jsxs("div",{className:"flex items-center justify-end",children:[(x==null?void 0:x.displayName)||l,V(l),!(x!=null&&x.canSumAcrossPages)&&e.jsx("span",{className:"ml-1 text-orange-600",children:"*"})]})},l)})]})}),e.jsx(Ve,{children:W.map((l,x)=>e.jsxs(ve,{children:[e.jsx(ke,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Wa,{pageName:l.page.pageName}),e.jsx("span",{children:l.page.pageName})]})}),D.map(f=>e.jsx(ke,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[S(l.metrics[f]),(m==null?void 0:m.metrics[f])&&l.metrics[f]===m.metrics[f].max&&m.metrics[f].max!==m.metrics[f].min&&e.jsx("span",{className:"text-yellow-600",title:"Bästa värde för denna månad",children:"🏆"}),(m==null?void 0:m.metrics[f])&&l.metrics[f]===m.metrics[f].min&&m.metrics[f].max!==m.metrics[f].min&&e.jsx("span",{className:"text-gray-500",title:"Lägsta värde för denna månad",children:"📉"})]})},f))]},l.page.pageId))})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Visa:"}),e.jsxs(De,{value:A.toString(),onValueChange:l=>{E(Number(l)),Y(1)},children:[e.jsx(we,{className:"w-[120px]",children:e.jsx(Te,{})}),e.jsx(Ce,{children:qa.map(l=>e.jsx(Pe,{value:l.value.toString(),children:l.label},l.value))})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Visar ",(_-1)*A+1," till ",Math.min(_*A,q.length)," av ",q.length]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{variant:"outline",size:"sm",onClick:()=>Y(l=>Math.max(1,l-1)),disabled:_===1,children:e.jsx(oa,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-sm",children:["Sida ",_," av ",oe]}),e.jsx(L,{variant:"outline",size:"sm",onClick:()=>Y(l=>Math.min(oe,l+1)),disabled:_>=oe,children:e.jsx(ca,{className:"h-4 w-4"})})]})]})]})]}),D.some(l=>{var x;return((x=xe[l])==null?void 0:x.category)==="unique_persons"})&&e.jsxs(re,{className:"mt-4 bg-amber-50 border-amber-200",children:[e.jsx(he,{className:"h-4 w-4 text-amber-600"}),e.jsx(ie,{className:"text-amber-800",children:"Viktigt om Räckvidd"}),e.jsx(le,{className:"text-amber-700",children:"Räckvidd representerar unika personer per månad och kan ALDRIG summeras över månader eller sidor. Värdena i tabellen visar data för den valda månaden."})]})]})]})]})}const Za=["reach","engagedUsers"],Qa=["engagements","reactions","publications","status","comment"],pe={reach:{category:"unique_persons",displayName:"Räckvidd",description:"Antal unika personer som såg innehållet under månaden",unit:"personer",canSumAcrossTime:!1,canSumAcrossPages:!1,preferredAggregation:"average",validAggregations:["average","min","max"],dataType:"integer",csvColumn:"Reach",icon:"👁️",color:"#3B82F6",warningNote:"Kan ALDRIG summeras över månader - representerar unika personer"},engagedUsers:{category:"unique_persons",displayName:"Engagerade användare",description:"Antal unika personer som interagerade med innehållet under månaden",unit:"personer",canSumAcrossTime:!1,canSumAcrossPages:!1,preferredAggregation:"average",validAggregations:["average","min","max"],dataType:"integer",csvColumn:"Engaged Users",icon:"🤝",color:"#10B981",warningNote:"Kan ALDRIG summeras över månader - representerar unika personer"},engagements:{category:"countable_events",displayName:"Interaktioner",description:"Totalt antal interaktioner (reactions + comments + shares)",unit:"interaktioner",canSumAcrossTime:!0,canSumAcrossPages:!0,preferredAggregation:"sum",validAggregations:["sum","average","min","max"],dataType:"integer",csvColumn:"Engagements",icon:"💬",color:"#8B5CF6",warningNote:null},reactions:{category:"countable_events",displayName:"Reaktioner",description:"Antal likes, hearts, och andra reaktioner på innehåll",unit:"reaktioner",canSumAcrossTime:!0,canSumAcrossPages:!0,preferredAggregation:"sum",validAggregations:["sum","average","min","max"],dataType:"integer",csvColumn:"Reactions",icon:"❤️",color:"#EF4444",warningNote:null},publications:{category:"countable_events",displayName:"Publiceringar",description:"Antal publicerade inlägg under månaden",unit:"inlägg",canSumAcrossTime:!0,canSumAcrossPages:!0,preferredAggregation:"sum",validAggregations:["sum","average","min","max"],dataType:"integer",csvColumn:"Publications",icon:"📝",color:"#F59E0B",warningNote:null},status:{category:"countable_events",displayName:"Statusuppdateringar",description:"Antal statusuppdateringar under månaden",unit:"statusar",canSumAcrossTime:!0,canSumAcrossPages:!0,preferredAggregation:"sum",validAggregations:["sum","average","min","max"],dataType:"integer",csvColumn:"Status",icon:"📢",color:"#14B8A6",warningNote:null},comment:{category:"countable_events",displayName:"Kommentarer",description:"Antal kommentarer på innehåll",unit:"kommentarer",canSumAcrossTime:!0,canSumAcrossPages:!0,preferredAggregation:"sum",validAggregations:["sum","average","min","max"],dataType:"integer",csvColumn:"Comment",icon:"💭",color:"#6366F1",warningNote:null}};function pa(r){return Object.keys(pe).filter(a=>pe[a].category===r)}function es(){return pa("countable_events")}function as(){return pa("unique_persons")}function ss(){const r=[],a=[],t=es(),o=Qa,d=o.filter(C=>!t.includes(C)),m=t.filter(C=>!o.includes(C));d.length>0&&r.push(`Saknade summerbara metrics: ${d.join(", ")}`),m.length>0&&r.push(`Extra summerbara metrics: ${m.join(", ")}`);const N=as(),k=Za,v=k.filter(C=>!N.includes(C)),y=N.filter(C=>!k.includes(C));return v.length>0&&r.push(`Saknade icke-summerbara metrics: ${v.join(", ")}`),y.length>0&&r.push(`Extra icke-summerbara metrics: ${y.join(", ")}`),{isConsistent:r.length===0,errors:r,warnings:a}}const Je=ss();Je.isConsistent||console.error("KRITISK: metric_categorizer.js är inte konsistent med reach_calculator.js:",Je.errors);function ts(r,a){return a===0||a===null||a===void 0?r>0?100:0:r==null?null:(r-a)/a*100}function ns(r,a){if(!r||!a)throw new Error("calculateMonthToMonthTrend kräver PageTimeseries och metric");const t=r.getAllMonthlyData();if(t.length<2)return[];const o=[];for(let d=1;d<t.length;d++){const m=t[d],N=t[d-1],k=m.metrics[a],v=N.metrics[a],y=ts(k,v);o.push({period:m.getPeriod(),previousPeriod:N.getPeriod(),currentValue:k,previousValue:v,absoluteChange:k-v,percentageChange:y,metric:a,pageName:m.page.pageName,pageId:m.page.pageId})}return o}function rs(r){if(!r||r.length===0)return{averageAbsoluteChange:0,averagePercentageChange:0,totalPeriods:0,positiveMonths:0,negativeMonths:0,stableMonths:0};let a=0,t=0,o=0,d=0,m=0,N=0;for(const k of r)a+=k.absoluteChange,k.percentageChange!==null&&!isNaN(k.percentageChange)&&(t+=k.percentageChange,o++,k.percentageChange>1?d++:k.percentageChange<-1?m++:N++);return{averageAbsoluteChange:a/r.length,averagePercentageChange:o>0?t/o:0,totalPeriods:r.length,positiveMonths:d,negativeMonths:m,stableMonths:N}}class Ae{constructor(a,t){if(!a||!t)throw new Error("FacebookPage kräver både pageName och pageId");this.pageName=a.trim(),this.pageId=String(t).trim(),this.createdAt=new Date}static fromCSVRow(a){if(!a.Page||!a["Page ID"])throw new Error("CSV-rad saknar obligatoriska fält: Page eller Page ID");return new Ae(a.Page,a["Page ID"])}getKey(){return`page_${this.pageId}`}isValid(){return this.pageName.length>0&&this.pageId.length>0}}class Me{constructor(a,t,o,d){if(!(a instanceof Ae))throw new Error("MonthlyPageData kräver en FacebookPage instans");if(!t||!o||o<1||o>12)throw new Error("MonthlyPageData kräver giltigt år och månad (1-12)");this.page=a,this.year=parseInt(t),this.month=parseInt(o),this.metrics=this.validateMetrics(d||{}),this.createdAt=new Date}validateMetrics(a){return{reach:this.parseNumeric(a.reach||a.Reach),engagedUsers:this.parseNumeric(a.engagedUsers||a["Engaged Users"]),engagements:this.parseNumeric(a.engagements||a.Engagements),reactions:this.parseNumeric(a.reactions||a.Reactions),publications:this.parseNumeric(a.publications||a.Publications),status:this.parseNumeric(a.status||a.Status),comment:this.parseNumeric(a.comment||a.Comment)}}parseNumeric(a){if(a==null||a==="")return 0;const t=parseFloat(String(a).replace(/,/g,""));return isNaN(t)?0:t}static fromCSVRow(a,t,o){const d=Ae.fromCSVRow(a);return new Me(d,t,o,a)}getKey(){return`${this.page.getKey()}_${this.year}_${this.month}`}getPeriod(){return{year:this.year,month:this.month}}isSamePeriod(a,t){return this.year===a&&this.month===t}getSummerableMetrics(){return{engagements:this.metrics.engagements,reactions:this.metrics.reactions,publications:this.metrics.publications,status:this.metrics.status,comment:this.metrics.comment}}getNonSummerableMetrics(){return{reach:this.metrics.reach,engagedUsers:this.metrics.engagedUsers}}}class is{constructor(a){if(!(a instanceof Ae))throw new Error("PageTimeseries kräver en FacebookPage instans");this.page=a,this.monthlyData=new Map,this.createdAt=new Date}addMonthlyData(a){if(!(a instanceof Me))throw new Error("addMonthlyData kräver MonthlyPageData instans");if(a.page.pageId!==this.page.pageId)throw new Error("MonthlyData måste tillhöra samma sida");const t=`${a.year}_${a.month}`;this.monthlyData.set(t,a)}getMonthlyData(a,t){const o=`${a}_${t}`;return this.monthlyData.get(o)||null}getAvailablePeriods(){return Array.from(this.monthlyData.values()).map(a=>a.getPeriod()).sort((a,t)=>a.year!==t.year?a.year-t.year:a.month-t.month)}getAllMonthlyData(){return Array.from(this.monthlyData.values()).sort((a,t)=>a.year!==t.year?a.year-t.year:a.month-t.month)}hasDataForPeriod(a,t){return this.getMonthlyData(a,t)!==null}getMonthCount(){return this.monthlyData.size}}class ls{constructor(){this.pageTimeseries=new Map,this.createdAt=new Date}addMonthlyData(a){if(!(a instanceof Me))throw new Error("addMonthlyData kräver MonthlyPageData instans");const t=a.page.getKey();this.pageTimeseries.has(t)||this.pageTimeseries.set(t,new is(a.page)),this.pageTimeseries.get(t).addMonthlyData(a)}getPageTimeseries(a){const t=`page_${a}`;return this.pageTimeseries.get(t)||null}getAllPages(){return Array.from(this.pageTimeseries.values()).map(a=>a.page).sort((a,t)=>a.pageName.localeCompare(t.pageName))}getAllPeriods(){const a=new Set;for(const t of this.pageTimeseries.values())for(const o of t.getAvailablePeriods())a.add(`${o.year}_${o.month}`);return Array.from(a).map(t=>{const[o,d]=t.split("_");return{year:parseInt(o),month:parseInt(d)}}).sort((t,o)=>t.year!==o.year?t.year-o.year:t.month-o.month)}getDataForPeriod(a,t){const o=[];for(const d of this.pageTimeseries.values()){const m=d.getMonthlyData(a,t);m&&o.push(m)}return o.sort((d,m)=>d.page.pageName.localeCompare(m.page.pageName))}getStats(){return{totalPages:this.pageTimeseries.size,totalPeriods:this.getAllPeriods().length,totalDataPoints:Array.from(this.pageTimeseries.values()).reduce((a,t)=>a+t.getMonthCount(),0)}}clear(){this.pageTimeseries.clear()}}const os=[{key:"reach",label:"Räckvidd",canSum:!1},{key:"engagements",label:"Engagemang",canSum:!0},{key:"reactions",label:"Reaktioner",canSum:!0},{key:"publications",label:"Publiceringar",canSum:!0}],$e=["#2563EB","#16A34A","#EAB308","#DC2626","#7C3AED","#EA580C","#0891B2","#BE185D","#059669","#7C2D12","#4338CA","#C2410C"],cs=({uploadedPeriods:r})=>{var x,f;const[a,t]=h.useState("reach"),[o,d]=h.useState([]),[m,N]=h.useState([]),[k,v]=h.useState(null),[y,C]=h.useState({x:0,y:0}),[b,B]=h.useState(!1),_=h.useMemo(()=>!r||r.length===0?null:new ls(r),[r]),Y=h.useMemo(()=>{if(!r||r.length===0)return[];const n=new Map;return r.forEach(c=>{c.data&&Array.isArray(c.data)&&c.data.forEach(s=>{const i=s.Page||s.page||"Okänd sida",g=s["Page ID"]||s.pageId||`page_${i.replace(/\s+/g,"_")}`;n.has(g)||n.set(g,{pageId:g,pageName:i})})}),Array.from(n.values()).sort((c,s)=>c.pageName.localeCompare(s.pageName))},[r]),A=h.useMemo(()=>r?r.map(n=>({...n,sortKey:n.year*100+n.month})).sort((n,c)=>n.sortKey-c.sortKey):[],[r]),E=n=>["Jan","Feb","Mar","Apr","Maj","Jun","Jul","Aug","Sep","Okt","Nov","Dec"][n-1]||n.toString(),D=n=>({reach:"Reach",engagements:"Engagements",reactions:"Reactions",publications:"Publications"})[n]||n,T=(n,c)=>{const s=c.indexOf(n);return s>=0?$e[s%$e.length]:$e[0]},$=()=>{const n=document.querySelector("#trend-chart-svg");if(!n||V.length===0)return;const c=document.createElement("canvas"),s=c.getContext("2d"),i=1920,g=1080;c.width=i,c.height=g,s.fillStyle="white",s.fillRect(0,0,i,g);const u=new XMLSerializer().serializeToString(n),p=new Blob([u],{type:"image/svg+xml;charset=utf-8"}),w=window.URL||window.webkitURL,O=w.createObjectURL(p),I=new Image;I.onload=()=>{var me;s.drawImage(I,0,150,i,g-350),s.fillStyle="#1f2937",s.font="bold 48px Arial, sans-serif",s.textAlign="center";const F=`Utveckling över tid - ${(me=pe[a])==null?void 0:me.displayName}`;s.fillText(F,i/2,80),s.fillStyle="#4b5563",s.font="32px Arial, sans-serif";const K=V.map(G=>G.pageName),ee=K.length===1?`Konto: ${K[0]}`:`Konton: ${K.join(", ")}`,ae=i-200,ce=ee.split(" ");let de="",ge=g-80;for(let G=0;G<ce.length;G++){const Ne=de+ce[G]+" ";s.measureText(Ne).width>ae&&G>0?(s.fillText(de,i/2,ge),de=ce[G]+" ",ge+=40):de=Ne}s.fillText(de,i/2,ge),c.toBlob(G=>{const Ne=w.createObjectURL(G),ue=document.createElement("a");ue.href=Ne;const Ue=K.length===1?K[0].replace(/[^a-zA-Z0-9]/g,"-"):`${K.length}-konton`;ue.download=`trend-analys-${a}-${Ue}-${new Date().toISOString().slice(0,10)}.png`,document.body.appendChild(ue),ue.click(),document.body.removeChild(ue),w.revokeObjectURL(Ne)},"image/png",1),w.revokeObjectURL(O)},I.src=O},z=n=>{d(c=>c.includes(n)?c.filter(s=>s!==n):[...c,n])},M=n=>{t(n)},q=n=>{const c=`${n.year}-${n.month}`;N(s=>s.find(g=>`${g.year}-${g.month}`===c)?s.filter(g=>`${g.year}-${g.month}`!==c):[...s,n])},W=h.useMemo(()=>m.length>0&&m.length===A.length,[m.length,A.length]),oe=()=>{N(W?[]:A)},U=h.useMemo(()=>{if(!r||o.length===0||m.length===0)return[];const n=[];return m.forEach(s=>{s.data&&Array.isArray(s.data)&&o.forEach(i=>{const g=s.data.find(u=>(u["Page ID"]||u.pageId||`page_${(u.Page||u.page||"").replace(/\s+/g,"_")}`)===i);if(g){const u=D(a),p=g[u];let w=0;if(p!=null&&p!==""){const O=String(p).replace(/[,\s]/g,"");w=parseFloat(O)||0}n.push({periodKey:`${s.year}-${s.month.toString().padStart(2,"0")}`,period:`${E(s.month)} ${s.year}`,month:E(s.month),year:s.year,pageId:i,pageName:g.Page||g.page||"Okänd sida",value:w,metric:a})}})}),n},[r,o,m,a]),V=h.useMemo(()=>{const n=new Map;return U.forEach(c=>{n.has(c.pageId)||n.set(c.pageId,{pageId:c.pageId,pageName:c.pageName,points:[],color:T(c.pageId,o)}),n.get(c.pageId).points.push(c)}),n.forEach(c=>{c.points.sort((s,i)=>s.periodKey.localeCompare(i.periodKey))}),Array.from(n.values())},[U,o]),j=h.useMemo(()=>{if(U.length===0)return{min:0,max:100};const n=U.map(g=>g.value),c=Math.min(...n),s=Math.max(...n),i=(s-c)*.1||10;return{min:Math.max(0,c-i),max:s+i}},[U]),P=n=>{if(n.length<2)return"";if(n.length===2){const[s,i]=n;return`M ${s.x} ${s.y} L ${i.x} ${i.y}`}let c=`M ${n[0].x} ${n[0].y}`;for(let s=1;s<n.length;s++){const i=n[s],g=n[s-1];if(s===1){const u=n[s+1]||i,p=g.x+(i.x-g.x)*.3,w=g.y+(i.y-g.y)*.3,O=i.x-(u.x-g.x)*.1,I=i.y-(u.y-g.y)*.1;c+=` C ${p} ${w}, ${O} ${I}, ${i.x} ${i.y}`}else if(s===n.length-1){const u=n[s-2]||g,p=g.x+(i.x-u.x)*.1,w=g.y+(i.y-u.y)*.1,O=i.x-(i.x-g.x)*.3,I=i.y-(i.y-g.y)*.3;c+=` C ${p} ${w}, ${O} ${I}, ${i.x} ${i.y}`}else{const u=n[s+1],p=n[s-2]||g,w=g.x+(i.x-p.x)*.1,O=g.y+(i.y-p.y)*.1,I=i.x-(u.x-g.x)*.1,F=i.y-(u.y-g.y)*.1;c+=` C ${w} ${O}, ${I} ${F}, ${i.x} ${i.y}`}}return c},S=(n,c)=>{const s=n.currentTarget.getBoundingClientRect();C({x:n.clientX-s.left,y:n.clientY-s.top}),v(c)},l=h.useMemo(()=>{if(!_)return[];const n=[];return Y.forEach(c=>{const s=_.getPageTimeseries(c.pageId);if(!s)return;const i=ns(s,a),g=rs(i);i.length>0&&n.push({page:c,trendData:i,avgTrend:g,totalPeriods:i.length+1,latestChange:i[i.length-1]})}),n.sort((c,s)=>s.avgTrend.averagePercentageChange-c.avgTrend.averagePercentageChange)},[_,Y,a]);return!r||r.length===0?e.jsxs(X,{children:[e.jsx(J,{children:e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-5 w-5"}),"Trendanalys"]})}),e.jsx(Q,{children:e.jsx("p",{className:"text-muted-foreground",children:"Ladda upp minst två månadsfiler för att se trendanalys."})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(X,{children:[e.jsxs(J,{className:"flex flex-row items-center justify-between",children:[e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"h-5 w-5"}),"Utveckling över tid"]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(L,{onClick:$,variant:"outline",size:"sm",disabled:V.length===0,children:"📊 Exportera PNG"})})]}),e.jsxs(Q,{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 block",children:["Välj Facebook-sidor (",o.length," valda)"]}),e.jsx("div",{className:"max-h-32 overflow-y-auto border rounded p-2 space-y-1",children:Y.map(n=>{const c=o.includes(n.pageId);return e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:c,onChange:()=>z(n.pageId),className:"h-4 w-4 text-facebook-500 border-gray-300 rounded focus:ring-facebook-500"}),e.jsx("span",{className:"text-sm font-medium",children:n.pageName})]},n.pageId)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Välj datapunkt"}),e.jsx("div",{className:"space-y-2",children:os.map(n=>{const c=a===n.key;return e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"metric",checked:c,onChange:()=>M(n.key),className:"h-4 w-4 text-facebook-500 border-gray-300 focus:ring-facebook-500"}),e.jsx("span",{className:"text-sm font-medium",children:n.label})]},n.key)})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 block",children:["Välj perioder (",m.length," valda)"]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer mb-2 p-2 bg-gray-50 rounded",children:[e.jsx("input",{type:"checkbox",checked:W,onChange:oe,className:"h-4 w-4 text-facebook-500 border-gray-300 rounded focus:ring-facebook-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Välj alla perioder"})]}),e.jsx("div",{className:"max-h-32 overflow-y-auto border rounded p-2 space-y-1",children:A.map(n=>{const c=m.some(s=>s.year===n.year&&s.month===n.month);return e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:c,onChange:()=>q(n),className:"h-4 w-4 text-facebook-500 border-gray-300 rounded focus:ring-facebook-500"}),e.jsxs("span",{className:"text-sm font-medium",children:[E(n.month)," ",n.year]})]},`${n.year}-${n.month}`)})})]})]}),a&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-center",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-900",children:["Visar: ",(x=pe[a])==null?void 0:x.displayName]}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Aktuell datapunkt som visas i diagrammet"})]}),V.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-wrap gap-3",children:V.map(n=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full border",style:{backgroundColor:n.color}}),e.jsx("span",{className:"text-sm font-medium",children:n.pageName})]},n.pageId))}),e.jsx("div",{className:"relative",children:e.jsxs("svg",{id:"trend-chart-svg",width:"100%",height:"500",viewBox:"0 0 1000 500",className:"border rounded bg-gray-50",onMouseLeave:()=>v(null),children:[e.jsx("defs",{children:e.jsx("pattern",{id:"grid",width:"50",height:"50",patternUnits:"userSpaceOnUse",children:e.jsx("path",{d:"M 50 0 L 0 0 0 50",fill:"none",stroke:"#e5e7eb",strokeWidth:"1"})})}),e.jsx("rect",{width:"100%",height:"100%",fill:"url(#grid)"}),[0,25,50,75,100].map(n=>{const c=450-n/100*380,s=j.min+n/100*(j.max-j.min);return e.jsxs("g",{children:[e.jsx("line",{x1:"70",y1:c,x2:"930",y2:c,stroke:"#d1d5db",strokeWidth:"1"}),e.jsx("text",{x:"65",y:c+4,textAnchor:"end",fontSize:"14",fill:"#6b7280",children:Math.round(s).toLocaleString()})]},n)}),A.map((n,c)=>{const s=70+c/Math.max(1,A.length-1)*860;return e.jsxs("g",{children:[e.jsx("line",{x1:s,y1:"70",x2:s,y2:"450",stroke:"#d1d5db",strokeWidth:"1"}),e.jsx("text",{x:s,y:"475",textAnchor:"middle",fontSize:"14",fill:"#6b7280",children:E(n.month)}),e.jsx("text",{x:s,y:"490",textAnchor:"middle",fontSize:"12",fill:"#9ca3af",children:n.year})]},`${n.year}-${n.month}`)}),V.map(n=>{if(n.points.length<1)return null;const c=n.points.map((s,i)=>{const u=70+A.findIndex(w=>`${w.year}-${w.month.toString().padStart(2,"0")}`===s.periodKey)/Math.max(1,A.length-1)*860,p=450-(s.value-j.min)/(j.max-j.min)*380;return{x:u,y:p,point:s}});return e.jsxs("g",{children:[n.points.length>1&&e.jsx("path",{d:P(c),fill:"none",stroke:n.color,strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),c.map(({x:s,y:i,point:g},u)=>e.jsx("circle",{cx:s,cy:i,r:"6",fill:n.color,stroke:"white",strokeWidth:"3",className:"cursor-pointer",onMouseEnter:p=>S(p,g),onMouseLeave:()=>v(null)},u))]},n.pageId)}),k&&e.jsx("g",{children:(()=>{var g;let s=y.x+15,i=y.y-35;return s+200>980&&(s=y.x-200-15),i<15&&(i=y.y+15),i+70>480&&(i=y.y-70-15),e.jsxs(e.Fragment,{children:[e.jsx("rect",{x:s,y:i,width:200,height:70,fill:"rgba(0,0,0,0.85)",rx:"6"}),e.jsx("text",{x:s+12,y:i+20,fill:"white",fontSize:"13",fontWeight:"bold",children:k.pageName}),e.jsx("text",{x:s+12,y:i+38,fill:"white",fontSize:"12",children:k.period}),e.jsxs("text",{x:s+12,y:i+55,fill:"white",fontSize:"12",children:[(g=pe[k.metric])==null?void 0:g.displayName,": ",k.value.toLocaleString()]})]})})()})]})})]}):e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(Ye,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"Välj sidor och perioder för att visa diagram"}),e.jsx("p",{className:"text-sm",children:o.length===0&&m.length===0?"Markera minst en Facebook-sida och period":o.length===0?"Markera minst en Facebook-sida i listan ovan":"Markera minst en period i listan ovan"})]})]})]}),e.jsxs(X,{children:[e.jsxs(J,{className:"flex flex-row items-center justify-between",children:[e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-5 w-5"}),"Trendstatistik - ",(f=pe[a])==null?void 0:f.displayName]}),e.jsx(L,{variant:"outline",onClick:()=>B(!b),children:b?"Dölj detaljer":"Visa detaljer"})]}),e.jsx(Q,{children:l.length===0?e.jsx("p",{className:"text-muted-foreground",children:"Ingen trenddata tillgänglig för vald metric."}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(je,{className:"h-4 w-4 text-green-600"}),"Bäst presterande sidor"]}),l.slice(0,3).map((n,c)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:n.page.pageName}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[n.totalPeriods," månader"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-bold text-green-700",children:["+",n.avgTrend.averagePercentageChange.toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-green-600",children:"genomsnitt/månad"})]})]},n.page.pageId))]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(ia,{className:"h-4 w-4 text-red-600"}),"Sämst presterande sidor"]}),l.slice(-3).reverse().map((n,c)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 rounded",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:n.page.pageName}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[n.totalPeriods," månader"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-bold text-red-700",children:[n.avgTrend.averagePercentageChange.toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-red-600",children:"genomsnitt/månad"})]})]},n.page.pageId))]})]}),b&&e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-muted p-3 font-medium",children:"Detaljerad trendanalys för alla sidor"}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:l.map(n=>{var c;return e.jsxs("div",{className:"p-3 border-b last:border-b-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-medium",children:n.page.pageName}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:`px-2 py-1 rounded text-xs font-medium ${n.avgTrend.averagePercentageChange>0?"bg-green-100 text-green-800":n.avgTrend.averagePercentageChange<0?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:[n.avgTrend.averagePercentageChange>0?"+":"",n.avgTrend.averagePercentageChange.toFixed(1),"% snitt"]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[n.avgTrend.positiveMonths,"↗ ",n.avgTrend.negativeMonths,"↘ ",n.avgTrend.stableMonths,"→"]})]})]}),n.latestChange&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Senaste förändring: ",n.latestChange.previousPeriod," → ",n.latestChange.period,e.jsxs("span",{className:`ml-2 font-medium ${n.latestChange.percentageChange>0?"text-green-600":n.latestChange.percentageChange<0?"text-red-600":"text-gray-600"}`,children:[n.latestChange.percentageChange>0?"+":"",(c=n.latestChange.percentageChange)==null?void 0:c.toFixed(1),"%"]})]})]},n.page.pageId)})})]})]})})]})]})},H={LOCALSTORAGE_KEYS:{METADATA:"fb_analyzer_metadata",PERIODS:"fb_analyzer_periods",PAGES:"fb_analyzer_pages",SETTINGS:"fb_analyzer_settings"},INDEXEDDB:{NAME:"FacebookAnalyzerDB",VERSION:1,STORES:{MONTHLY_DATA:"monthlyData",TIMESERIES:"timeseries"}},LIMITS:{LOCALSTORAGE_MAX:5*1024*1024,INDEXEDDB_MAX:50*1024*1024,MAX_PERIODS:120,MAX_PAGES:1e3}};async function Be(){return new Promise((r,a)=>{const t=indexedDB.open(H.INDEXEDDB.NAME,H.INDEXEDDB.VERSION);t.onerror=()=>{console.error("IndexedDB initialization failed:",t.error),a(t.error)},t.onupgradeneeded=o=>{const d=o.target.result;if(!d.objectStoreNames.contains(H.INDEXEDDB.STORES.MONTHLY_DATA)){const m=d.createObjectStore(H.INDEXEDDB.STORES.MONTHLY_DATA,{keyPath:"id"});m.createIndex("pageId","pageId",{unique:!1}),m.createIndex("period",["year","month"],{unique:!1}),m.createIndex("pagePeriod",["pageId","year","month"],{unique:!0}),console.log("Created monthlyData store with indexes")}d.objectStoreNames.contains(H.INDEXEDDB.STORES.TIMESERIES)||(d.createObjectStore(H.INDEXEDDB.STORES.TIMESERIES,{keyPath:"pageId"}).createIndex("pageName","pageName",{unique:!1}),console.log("Created timeseries store"))},t.onsuccess=()=>{r(t.result)}})}async function ds(r,a){if(!r||!a)throw new Error("year och month krävs");try{const t=await Be();return new Promise((o,d)=>{const v=t.transaction([H.INDEXEDDB.STORES.MONTHLY_DATA],"readonly").objectStore(H.INDEXEDDB.STORES.MONTHLY_DATA).index("period").getAll([r,a]);v.onsuccess=()=>{const y=v.result.sort((C,b)=>C.pageName.localeCompare(b.pageName));o(y)},v.onerror=()=>{d(v.error)}})}catch(t){throw console.error("Error getting period data:",t),t}}async function ms(){try{const r=await Be();return new Promise((a,t)=>{const m=r.transaction([H.INDEXEDDB.STORES.MONTHLY_DATA],"readonly").objectStore(H.INDEXEDDB.STORES.MONTHLY_DATA).getAll();m.onsuccess=()=>{const N=new Set;for(const v of m.result)N.add(`${v.year}_${v.month}`);const k=Array.from(N).map(v=>{const[y,C]=v.split("_");return{year:parseInt(y),month:parseInt(C)}}).sort((v,y)=>v.year!==y.year?v.year-y.year:v.month-y.month);a(k)},m.onerror=()=>{t(m.error)}})}catch(r){throw console.error("Error getting all periods:",r),r}}async function gs(){try{for(const a of Object.values(H.LOCALSTORAGE_KEYS))localStorage.removeItem(a);const r=await Be();return new Promise((a,t)=>{const o=r.transaction([H.INDEXEDDB.STORES.MONTHLY_DATA,H.INDEXEDDB.STORES.TIMESERIES],"readwrite");let d=0;const m=2,k=o.objectStore(H.INDEXEDDB.STORES.MONTHLY_DATA).clear();k.onsuccess=()=>{d++,d===m&&(console.log("All data cleared successfully"),a(!0))};const y=o.objectStore(H.INDEXEDDB.STORES.TIMESERIES).clear();y.onsuccess=()=>{d++,d===m&&(console.log("All data cleared successfully"),a(!0))},o.onerror=()=>{t(o.error)}})}catch(r){throw console.error("Error clearing data:",r),r}}function hs(){const[r,a]=h.useState(!1),[t,o]=h.useState(!1),[d,m]=h.useState("upload"),[N,k]=h.useState([]),[v,y]=h.useState(!0),[C,b]=h.useState(!1);h.useEffect(()=>{B()},[]);const B=async()=>{try{y(!0),console.log("Laddar befintlig data från storage...");const E=await ms();if(console.log("Hittade perioder i storage:",E),E.length>0){const D=await Promise.all(E.map(async T=>{const z=(await ds(T.year,T.month)).map(M=>({Page:M.pageName,"Page ID":M.pageId,Reach:M.metrics.reach||0,"Engaged Users":M.metrics.engagedUsers||0,Engagements:M.metrics.engagements||0,Reactions:M.metrics.reactions||0,Publications:M.metrics.publications||0,Status:M.metrics.status||0,Comment:M.metrics.comment||0}));return{year:T.year,month:T.month,data:z,filename:`FB_${T.year}_${String(T.month).padStart(2,"0")}.csv`}}));console.log("Konverterade periodsWithData:",D),k(D),a(!0),m("monthly")}else console.log("Ingen befintlig data hittades")}catch(E){console.error("Kunde inte ladda befintlig data:",E)}finally{y(!1)}},_=async E=>{console.log("Data uploaded successfully:",E);const D=Array.isArray(E)?E:[],T=[...N];D.forEach($=>{T.some(M=>M.year===$.year&&M.month===$.month)?console.log(`Period ${$.year}-${$.month} finns redan, hoppar över dubblett`):T.push($)}),console.log("Merged periods:",T),k(T),a(!0),o(!1),m("monthly")},Y=async()=>{if(window.confirm("Är du säker på att du vill rensa all data? Detta kan inte ångras."))try{b(!0),console.log("Rensar all data..."),await gs(),k([]),a(!1),m("upload"),console.log("✅ All data rensad framgångsrikt")}catch(E){console.error("❌ Fel vid rensning av data:",E),alert(`Fel vid rensning av data: ${E.message}`)}finally{b(!1)}},A=()=>{o(!1)};return v?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ne,{className:"h-12 w-12 mx-auto mb-4 text-primary animate-pulse"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Facebook API data analyser"}),e.jsx("p",{className:"text-muted-foreground",children:"Laddar befintlig data..."})]})}):t?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"border-b border-border",children:e.jsx("div",{className:"container py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"facebook-brand flex items-center gap-3",children:[e.jsx(ne,{className:"h-8 w-8"}),e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Facebook API data analyser"})]}),e.jsxs(L,{variant:"outline",onClick:A,children:[e.jsx(Ta,{className:"mr-2 h-4 w-4"}),"Tillbaka"]})]})})}),e.jsx("main",{className:"container py-6",children:e.jsx(Ua,{onDataUploaded:_,onCancel:A})})]}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"border-b border-border",children:e.jsx("div",{className:"container py-4",children:e.jsxs("div",{className:"facebook-brand flex items-center gap-3",children:[e.jsx(ne,{className:"h-8 w-8"}),e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Facebook API data analyser"})]})})}),e.jsx("main",{className:"container py-6",children:e.jsx("div",{className:"space-y-6",children:r?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Analysera Facebook-data"}),e.jsxs("p",{className:"text-muted-foreground",children:[N.length," period",N.length!==1?"er":""," tillgänglig",N.length!==1?"a":""]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(L,{variant:"outline",onClick:()=>o(!0),children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),"Ladda upp mer data"]}),e.jsx(L,{variant:"destructive",onClick:Y,disabled:C,children:C?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mr-2 h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"}),"Rensar..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ma,{className:"mr-2 h-4 w-4"}),"Rensa data"]})})]})]}),e.jsxs(Va,{value:d,onValueChange:m,className:"space-y-4",children:[e.jsxs(xa,{className:"grid w-full grid-cols-4",children:[e.jsxs(ye,{value:"upload",className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"h-4 w-4"}),"Info"]}),e.jsxs(ye,{value:"monthly",className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-4 w-4"}),"Månadsanalys"]}),e.jsxs(ye,{value:"pages",className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),"Sidor över tid"]}),e.jsxs(ye,{value:"trends",className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-4 w-4"}),"Trendanalys"]})]}),e.jsx(be,{value:"upload",className:"mt-6",children:e.jsxs(X,{children:[e.jsx(J,{children:e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"h-5 w-5"}),"Dataöversikt"]})}),e.jsxs(Q,{className:"space-y-4",children:[e.jsxs(re,{children:[e.jsx(Ie,{className:"h-4 w-4"}),e.jsx(ie,{children:"Data laddad och redo"}),e.jsxs(le,{children:["Du har ",N.length," period",N.length!==1?"er":""," av Facebook-data tillgänglig för analys. Använd flikarna ovan för att utforska dina data eller ladda upp mer data."]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[e.jsx(fe,{className:"w-8 h-8 mx-auto mb-2 text-blue-600"}),e.jsx("div",{className:"font-bold text-2xl text-blue-900",children:N.length}),e.jsx("div",{className:"text-sm text-blue-700",children:"Månader data"})]}),e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[e.jsx(ne,{className:"w-8 h-8 mx-auto mb-2 text-green-600"}),e.jsx("div",{className:"font-bold text-2xl text-green-900",children:N.reduce((E,D)=>{var T;return E+(((T=D.data)==null?void 0:T.length)||0)},0)}),e.jsx("div",{className:"text-sm text-green-700",children:"Totalt dataposter"})]}),e.jsxs("div",{className:"text-center p-4 bg-purple-50 rounded-lg",children:[e.jsx(je,{className:"w-8 h-8 mx-auto mb-2 text-purple-600"}),e.jsx("div",{className:"font-bold text-2xl text-purple-900",children:[...new Set(N.flatMap(E=>{var D;return((D=E.data)==null?void 0:D.map(T=>T.Page||T.page))||[]}))].length}),e.jsx("div",{className:"text-sm text-purple-700",children:"Unika Facebook-sidor"})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Data sparas automatiskt i webbläsaren och kommer att finnas kvar när du laddar om sidan."}),e.jsxs(L,{onClick:()=>o(!0),children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),"Ladda upp mer data"]})]})]})}),e.jsx(be,{value:"monthly",className:"mt-6",children:e.jsx(Ja,{uploadedPeriods:N})}),e.jsx(be,{value:"pages",className:"mt-6",children:e.jsx(Xa,{uploadedPeriods:N})}),e.jsx(be,{value:"trends",className:"mt-6",children:e.jsx(cs,{uploadedPeriods:N})})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ee,{className:"mx-auto h-24 w-24 text-muted-foreground mb-6"}),e.jsx("h2",{className:"text-3xl font-bold tracking-tight mb-4",children:"Välkommen till Facebook API data analyser"}),e.jsx("p",{className:"text-xl text-muted-foreground mb-8 max-w-2xl mx-auto",children:"Analysera och visualisera dina Facebook-sidor över tid. Ladda upp månadsdata för att komma igång med tidserie-analys."}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6 max-w-4xl mx-auto mb-12",children:[e.jsxs(X,{className:"text-center p-6",children:[e.jsx(fe,{className:"mx-auto h-12 w-12 text-primary mb-4"}),e.jsx("h3",{className:"font-semibold mb-2",children:"Månadsanalys"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Jämför prestanda mellan Facebook-sidor för specifika månader"})]}),e.jsxs(X,{className:"text-center p-6",children:[e.jsx(je,{className:"mx-auto h-12 w-12 text-primary mb-4"}),e.jsx("h3",{className:"font-semibold mb-2",children:"Tidserie-analys"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Följ utvecklingen av enskilda sidor över tid"})]}),e.jsxs(X,{className:"text-center p-6",children:[e.jsx(ne,{className:"mx-auto h-12 w-12 text-primary mb-4"}),e.jsx("h3",{className:"font-semibold mb-2",children:"Trend-upptäckt"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Upptäck mönster och trender i dina Facebook-data"})]})]}),e.jsxs(L,{onClick:()=>o(!0),size:"lg",children:[e.jsx(Ee,{className:"mr-2 h-5 w-5"}),"Ladda upp Facebook API data"]})]})})}),e.jsx("footer",{className:"border-t border-border mt-12",children:e.jsxs("div",{className:"container py-4 text-center text-sm text-muted-foreground",children:[e.jsxs("p",{children:["Facebook API data analyser © ",new Date().getFullYear()]}),e.jsxs("p",{className:"mt-1",children:["Tidserie-baserad analys av månadsstatistik |",e.jsx("span",{className:"text-facebook-500 font-medium",children:" Utvecklad för projektfas 1-8"})]})]})})]})}Oe.createRoot(document.getElementById("root")).render(e.jsx(Ra.StrictMode,{children:e.jsx(hs,{})}));
//# sourceMappingURL=index-CdZpnZkc.js.map
