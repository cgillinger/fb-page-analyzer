import{j as e,S as va,L as ta,T as na,C as ra,R as Sa,U as We,A as he,F as ka,a as pe,b as qe,c as wa,X as Aa,B as me,d as la,I as Pa,e as Ca,P as Ea,f as ia,V as Da,g as oa,h as ca,i as Ta,k as Ia,l as Ma,m as da,n as Ra,o as $a,p as Be,q as ve,r as _a,s as ma,t as ua,u as ga,v as ha,w as xa,x as fa,y as Ge,z as Oa,D as Ie,E as Fa,G as Fe}from"./ui-DvaxdRLu.js";import{b as La,r as h,R as Va}from"./vendor-DB9HQzDI.js";import{t as Ba,c as pa,P as Ua}from"./utils-GaJ1HoMq.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))o(d);new MutationObserver(d=>{for(const m of d)if(m.type==="childList")for(const N of m.addedNodes)N.tagName==="LINK"&&N.rel==="modulepreload"&&o(N)}).observe(document,{childList:!0,subtree:!0});function t(d){const m={};return d.integrity&&(m.integrity=d.integrity),d.referrerPolicy&&(m.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?m.credentials="include":d.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function o(d){if(d.ep)return;d.ep=!0;const m=t(d);fetch(d.href,m)}})();var Ue={},Je=La;Ue.createRoot=Je.createRoot,Ue.hydrateRoot=Je.hydrateRoot;function I(...i){return Ba(pa(i))}const X=h.forwardRef(({className:i,...s},t)=>e.jsx("div",{ref:t,className:I("rounded-lg border bg-card text-card-foreground shadow-sm",i),...s}));X.displayName="Card";const ie=h.forwardRef(({className:i,...s},t)=>e.jsx("div",{ref:t,className:I("flex flex-col space-y-1.5 p-6",i),...s}));ie.displayName="CardHeader";const oe=h.forwardRef(({className:i,...s},t)=>e.jsx("h3",{ref:t,className:I("text-2xl font-semibold leading-none tracking-tight",i),...s}));oe.displayName="CardTitle";const za=h.forwardRef(({className:i,...s},t)=>e.jsx("p",{ref:t,className:I("text-sm text-muted-foreground",i),...s}));za.displayName="CardDescription";const ce=h.forwardRef(({className:i,...s},t)=>e.jsx("div",{ref:t,className:I("p-6 pt-0",i),...s}));ce.displayName="CardContent";const Ka=h.forwardRef(({className:i,...s},t)=>e.jsx("div",{ref:t,className:I("flex items-center p-6 pt-0",i),...s}));Ka.displayName="CardFooter";const Ze=i=>typeof i=="boolean"?`${i}`:i===0?"0":i,Qe=pa,ya=(i,s)=>t=>{var o;if((s==null?void 0:s.variants)==null)return Qe(i,t==null?void 0:t.class,t==null?void 0:t.className);const{variants:d,defaultVariants:m}=s,N=Object.keys(d).map(j=>{const k=t==null?void 0:t[j],b=m==null?void 0:m[j];if(k===null)return null;const B=Ze(k)||Ze(b);return d[j][B]}),P=t&&Object.entries(t).reduce((j,k)=>{let[b,B]=k;return B===void 0||(j[b]=B),j},{}),S=s==null||(o=s.compoundVariants)===null||o===void 0?void 0:o.reduce((j,k)=>{let{class:b,className:B,...F}=k;return Object.entries(F).every($=>{let[C,E]=$;return Array.isArray(E)?E.includes({...m,...P}[C]):{...m,...P}[C]===E})?[...j,b,B]:j},[]);return Qe(i,N,S,t==null?void 0:t.class,t==null?void 0:t.className)},Ya=ya("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"underline-offset-4 hover:underline text-primary",facebook:"bg-facebook-500 text-white hover:bg-facebook-600"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),L=h.forwardRef(({className:i,variant:s,size:t,asChild:o=!1,...d},m)=>{const N=o?va:"button";return e.jsx(N,{className:I(Ya({variant:s,size:t,className:i})),ref:m,...d})});L.displayName="Button";const Ha=Sa,ja=h.forwardRef(({className:i,...s},t)=>e.jsx(ta,{ref:t,className:I("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",i),...s}));ja.displayName=ta.displayName;const Ne=h.forwardRef(({className:i,...s},t)=>e.jsx(na,{ref:t,className:I("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",i),...s}));Ne.displayName=na.displayName;const be=h.forwardRef(({className:i,...s},t)=>e.jsx(ra,{ref:t,className:I("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",i),...s}));be.displayName=ra.displayName;const Xa=ya("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive",success:"border-green-500/50 text-green-600 dark:text-green-400 [&>svg]:text-green-600",info:"border-facebook-300/50 text-facebook-600 dark:text-facebook-400 [&>svg]:text-facebook-600"}},defaultVariants:{variant:"default"}}),ne=h.forwardRef(({className:i,variant:s,...t},o)=>e.jsx("div",{ref:o,role:"alert",className:I(Xa({variant:s}),i),...t}));ne.displayName="Alert";const re=h.forwardRef(({className:i,...s},t)=>e.jsx("h5",{ref:t,className:I("mb-1 font-medium leading-none tracking-tight",i),...s}));re.displayName="AlertTitle";const le=h.forwardRef(({className:i,...s},t)=>e.jsx("div",{ref:t,className:I("text-sm [&_p]:leading-relaxed",i),...s}));le.displayName="AlertDescription";const ea=["Page","Page ID","Reach","Engaged Users","Engagements","Reactions","Publications","Status","Comment"];function Wa({onDataUploaded:i,onCancel:s}){const[t,o]=h.useState([]),[d,m]=h.useState(!1),[N,P]=h.useState(!1),[S,j]=h.useState([]),[k,b]=h.useState({}),B=h.useRef(null),F=y=>{const w=/^FB_(\d{4})_(\d{2})\.csv$/,v=y.match(w);if(!v)return{isValid:!1,error:"Felaktigt filnamnsformat. Förväntat: FB_YYYY_MM.csv (t.ex. FB_2025_08.csv)"};const a=parseInt(v[1]),l=parseInt(v[2]);return l<1||l>12?{isValid:!1,error:"Ogiltig månad. Måste vara mellan 01-12."}:a<2020||a>2030?{isValid:!1,error:"Ogiltigt år. Måste vara mellan 2020-2030."}:{isValid:!0,year:a,month:l,displayName:`${$(l)} ${a}`}},$=y=>["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"][y-1],C=(y,w)=>new Promise(v=>{Ua.parse(y,{header:!0,skipEmptyLines:!0,complete:a=>{if(a.errors.length>0){v({isValid:!1,error:`CSV-parsningsfel: ${a.errors[0].message}`,data:null});return}const l=a.meta.fields||[],n=ea.filter(c=>!l.includes(c));if(n.length>0){v({isValid:!1,error:`Saknade kolumner: ${n.join(", ")}`,data:null});return}if(a.data.length===0){v({isValid:!1,error:"CSV-filen innehåller ingen data",data:null});return}v({isValid:!0,data:a.data,pageCount:a.data.length,error:null})}})}),E=y=>{y.preventDefault(),y.stopPropagation(),P(!1);const w=Array.from(y.dataTransfer.files),v=w.filter(a=>a.name.toLowerCase().endsWith(".csv"));v.length!==w.length&&j(a=>[...a,"Endast CSV-filer är tillåtna"]),v.length>0&&D(v)},A=y=>{const w=Array.from(y.target.files);D(w)},D=y=>{const w=y.map(n=>{const c=F(n.name);return{file:n,id:Math.random().toString(36),name:n.name,size:n.size,validation:c,status:c.isValid?"pending":"error"}}),v=t.map(n=>n.name),a=w.filter(n=>v.includes(n.name));a.length>0&&j(n=>[...n,`Följande filer är redan valda: ${a.map(c=>c.name).join(", ")}`]);const l=w.filter(n=>!v.includes(n.name));o(n=>[...n,...l])},M=y=>{o(w=>w.filter(v=>v.id!==y))},U=async()=>{m(!0),j([]),b({});const y=t.filter(v=>v.validation.isValid),w=[];for(const v of y){b(a=>({...a,[v.id]:"processing"}));try{const a=await T(v.file),l=await C(a,v.name);if(!l.isValid){b(c=>({...c,[v.id]:"error"})),j(c=>[...c,`${v.name}: ${l.error}`]);continue}const n={...v.validation,data:l.data,pageCount:l.pageCount,filename:v.name};w.push(n),b(c=>({...c,[v.id]:"success"})),await new Promise(c=>setTimeout(c,500))}catch(a){b(l=>({...l,[v.id]:"error"})),j(l=>[...l,`${v.name}: ${a.message}`])}}m(!1),w.length>0&&i(w)},T=y=>new Promise((w,v)=>{const a=new FileReader;a.onload=l=>w(l.target.result),a.onerror=()=>v(new Error("Kunde inte läsa fil")),a.readAsText(y)}),Y=y=>{y.preventDefault(),y.stopPropagation(),P(!0)},W=y=>{y.preventDefault(),y.stopPropagation(),P(!1)},H=()=>{j([])},_=t.filter(y=>y.validation.isValid).length,z=_>0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(X,{children:[e.jsxs(ie,{children:[e.jsxs(oe,{className:"flex items-center gap-2",children:[e.jsx(We,{className:"h-5 w-5 text-facebook-500"}),"Ladda upp Facebook CSV-filer"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Släpp dina FB_YYYY_MM.csv filer här eller klicka för att välja filer"})]}),e.jsx(ce,{children:e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors cursor-pointer ${N?"border-facebook-400 bg-facebook-50":"border-gray-300 hover:border-facebook-400 hover:bg-facebook-50"}`,onDrop:E,onDragOver:Y,onDragLeave:W,onClick:()=>{var y;return(y=B.current)==null?void 0:y.click()},children:[e.jsx("input",{type:"file",ref:B,onChange:A,multiple:!0,accept:".csv",className:"hidden"}),e.jsx(We,{className:"h-12 w-12 mx-auto mb-4 text-facebook-400"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:N?"Släpp filerna här":"Ladda upp CSV-filer"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Släpp dina FB_YYYY_MM.csv filer här eller klicka för att välja"}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Format:"})," FB_YYYY_MM.csv (t.ex. FB_2025_08.csv)"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Kolumner:"})," ",ea.join(", ")]})]})]})})]}),S.length>0&&e.jsxs(ne,{variant:"destructive",children:[e.jsx(he,{className:"h-4 w-4"}),e.jsx(re,{children:"Valideringsfel"}),e.jsxs(le,{children:[e.jsx("ul",{className:"list-disc list-inside space-y-1",children:S.map((y,w)=>e.jsx("li",{children:y},w))}),e.jsx(L,{variant:"outline",size:"sm",onClick:H,className:"mt-2",children:"Rensa fel"})]})]}),t.length>0&&e.jsxs(X,{children:[e.jsx(ie,{children:e.jsxs(oe,{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["Valda filer (",t.length,")"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[_," giltiga filer"]})]})}),e.jsx(ce,{children:e.jsx("div",{className:"space-y-2",children:t.map(y=>{const w=k[y.id]||y.status;return e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg border ${y.validation.isValid?"border-green-200 bg-green-50":"border-red-200 bg-red-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ka,{className:"h-4 w-4"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:y.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:y.validation.isValid?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(pe,{className:"h-3 w-3"}),y.validation.displayName]}):e.jsx("span",{className:"text-red-600",children:y.validation.error})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[w==="processing"&&e.jsx(qe,{className:"h-4 w-4 animate-spin text-blue-500"}),w==="success"&&e.jsx(wa,{className:"h-4 w-4 text-green-500"}),w==="error"&&e.jsx(he,{className:"h-4 w-4 text-red-500"}),e.jsx(L,{variant:"ghost",size:"sm",onClick:()=>M(y.id),disabled:d,children:e.jsx(Aa,{className:"h-4 w-4"})})]})]},y.id)})})})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(L,{variant:"outline",onClick:s,disabled:d,children:"Avbryt"}),e.jsxs("div",{className:"flex gap-2",children:[t.length>0&&e.jsx(L,{variant:"outline",onClick:()=>o([]),disabled:d,children:"Rensa alla"}),e.jsx(L,{onClick:U,disabled:!z||d,className:"min-w-[120px]",children:d?e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"mr-2 h-4 w-4 animate-spin"}),"Bearbetar..."]}):e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"mr-2 h-4 w-4"}),"Analysera data (",_,")"]})})]})]})]})}const ze=h.forwardRef(({className:i,...s},t)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:t,className:I("w-full caption-bottom text-sm",i),...s})}));ze.displayName="Table";const Ke=h.forwardRef(({className:i,...s},t)=>e.jsx("thead",{ref:t,className:I("[&_tr]:border-b",i),...s}));Ke.displayName="TableHeader";const Ye=h.forwardRef(({className:i,...s},t)=>e.jsx("tbody",{ref:t,className:I("[&_tr:last-child]:border-0",i),...s}));Ye.displayName="TableBody";const ke=h.forwardRef(({className:i,...s},t)=>e.jsx("tr",{ref:t,className:I("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",i),...s}));ke.displayName="TableRow";const we=h.forwardRef(({className:i,...s},t)=>e.jsx("th",{ref:t,className:I("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",i),...s}));we.displayName="TableHead";const Ae=h.forwardRef(({className:i,...s},t)=>e.jsx("td",{ref:t,className:I("p-4 align-middle [&:has([role=checkbox])]:pr-0",i),...s}));Ae.displayName="TableCell";const Me=Ra,Re=$a,Pe=h.forwardRef(({className:i,children:s,...t},o)=>e.jsxs(la,{ref:o,className:I("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",i),...t,children:[s,e.jsx(Pa,{asChild:!0,children:e.jsx(Ca,{className:"h-4 w-4 opacity-50"})})]}));Pe.displayName=la.displayName;const Ce=h.forwardRef(({className:i,children:s,position:t="popper",...o},d)=>e.jsx(Ea,{children:e.jsx(ia,{ref:d,className:I("relative z-50 min-w-[8rem] overflow-hidden rounded-md border bg-white text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",i),position:t,...o,children:e.jsx(Da,{className:I("p-1 max-h-[300px] overflow-y-auto",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s})})}));Ce.displayName=ia.displayName;const qa=h.forwardRef(({className:i,...s},t)=>e.jsx(oa,{ref:t,className:I("py-1.5 pl-8 pr-2 text-sm font-semibold",i),...s}));qa.displayName=oa.displayName;const Ee=h.forwardRef(({className:i,children:s,...t},o)=>e.jsxs(ca,{ref:o,className:I("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",i),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ta,{children:e.jsx(Ia,{className:"h-4 w-4"})})}),e.jsx(Ma,{children:s})]}));Ee.displayName=ca.displayName;const Ga=h.forwardRef(({className:i,...s},t)=>e.jsx(da,{ref:t,className:I("-mx-1 my-1 h-px bg-muted",i),...s}));Ga.displayName=da.displayName;const se={P1:"#0066cc",P2:"#ff6600",P3:"#00cc66",P4:"#cc33cc",EKOT:"#005eb8",RADIOSPORTEN:"#1c5c35",SR:"#000000",default:"#000000"},aa=({pageName:i})=>{const s=i||"Okänd";let t=se.default,o="";const d=s.toLowerCase();d.includes("ekot")||d.includes("radio sweden")?(t=se.EKOT,o="E"):d.includes("radiosporten")||d.includes("radio sporten")?(t=se.RADIOSPORTEN,o="RS"):d.includes("p1")?(t=se.P1,o="P1"):d.includes("p2")?(t=se.P2,o="P2"):d.includes("p3")?(t=se.P3,o="P3"):d.includes("p4")?(t=se.P4,o="P4"):d.includes("sveriges radio")&&!d.includes("p1")&&!d.includes("p2")&&!d.includes("p3")&&!d.includes("p4")?(t=se.SR,o="SR"):o=s.charAt(0).toUpperCase();const N=t===se.P2||t===se.P3?"text-black":"text-white";return e.jsx("div",{className:`flex-shrink-0 w-6 h-6 rounded-sm flex items-center justify-center text-xs font-bold ${N}`,style:{backgroundColor:t},title:i,children:o})},Ja=[{value:6,label:"6 per sida"},{value:12,label:"12 per sida"},{value:24,label:"24 per sida"}],Za=[{key:"reach",label:"Räckvidd",canSum:!1},{key:"engagements",label:"Engagemang",canSum:!0},{key:"reactions",label:"Reaktioner",canSum:!0},{key:"publications",label:"Publiceringar",canSum:!0},{key:"status",label:"Status",canSum:!0},{key:"comment",label:"Kommentarer",canSum:!0}],Le={reach:{displayName:"Räckvidd",canSumAcrossPages:!1,category:"unique_persons"},engagements:{displayName:"Engagemang",canSumAcrossPages:!0,category:"countable"},reactions:{displayName:"Reaktioner",canSumAcrossPages:!0,category:"countable"},publications:{displayName:"Publiceringar",canSumAcrossPages:!0,category:"countable"},status:{displayName:"Status",canSumAcrossPages:!0,category:"countable"},comment:{displayName:"Kommentarer",canSumAcrossPages:!0,category:"countable"}};function Qa({uploadedPeriods:i=[]}){const[s,t]=h.useState([]),[o,d]=h.useState(""),[m,N]=h.useState([]),[P,S]=h.useState(!0),[j,k]=h.useState(null),[b,B]=h.useState(null),[F,$]=h.useState({}),[C,E]=h.useState({key:"year_month",direction:"desc"}),[A,D]=h.useState(1),[M,U]=h.useState(12),[T,Y]=h.useState(["reach","engagements","publications"]);h.useEffect(()=>{(()=>{try{if(S(!0),i.length===0){t([]),S(!1);return}const u=new Map;i.forEach(x=>{x.data&&Array.isArray(x.data)&&x.data.forEach(p=>{const R=p.Page||p.page||"Okänd sida",Z=p["Page ID"]||p.pageId||`page_${R.replace(/\s+/g,"_")}`;u.has(Z)||u.set(Z,{pageId:Z,pageName:R})})});const f=Array.from(u.values()).sort((x,p)=>x.pageName.localeCompare(p.pageName));t(f),f.length>0&&d(f[0].pageId)}catch(u){console.error("Error loading pages:",u),k("Kunde inte ladda tillgängliga Facebook-sidor")}finally{S(!1)}})()},[i]),h.useEffect(()=>{if(!o||i.length===0)return;(()=>{try{S(!0),k(null);const u=[];if(i.forEach(x=>{if(x.data&&Array.isArray(x.data)){const p=x.data.find(R=>(R["Page ID"]||R.pageId||`page_${(R.Page||R.page||"").replace(/\s+/g,"_")}`)===o);p&&u.push({year:x.year,month:x.month,pageName:p.Page||p.page||"Okänd sida",pageId:o,metrics:{reach:W(p.Reach||p.reach),engagements:W(p.Engagements||p.engagements),reactions:W(p.Reactions||p.reactions),publications:W(p.Publications||p.publications),status:W(p.Status||p.status),comment:W(p.Comment||p.comment)}})}}),u.length===0){const x=s.find(p=>p.pageId===o);k(`Ingen tidserie-data hittades för ${(x==null?void 0:x.pageName)||"vald sida"}`);return}const f=u.sort((x,p)=>x.year!==p.year?p.year-x.year:p.month-x.month);N(f),H(f)}catch(u){console.error("Error loading page timeseries:",u);const f=s.find(x=>x.pageId===o);k(`Kunde inte ladda data för ${(f==null?void 0:f.pageName)||"vald sida"}`)}finally{S(!1)}})()},[o,i,s]);const W=r=>{if(r==null||r==="")return 0;const u=parseFloat(String(r).replace(/[,\s]/g,""));return isNaN(u)?0:u},H=r=>{var R,Z,V;if(r.length===0)return;const u=s.find(O=>O.pageId===o),f={pageName:(u==null?void 0:u.pageName)||((R=r[0])==null?void 0:R.pageName)||"Okänd sida",totalPeriods:r.length,firstPeriod:r[r.length-1],lastPeriod:r[0],metrics:{}},x=["reach","engagements","reactions","publications"];for(const O of x){const q=r.map(G=>G.metrics[O]).filter(G=>G!=null&&!isNaN(G));if(q.length>0){const G=q.reduce((J,ae)=>J+ae,0)/q.length,Q=Math.min(...q),ee=Math.max(...q),ge=r.find(J=>J.metrics[O]===ee),ue=r.find(J=>J.metrics[O]===Q);f.metrics[O]={average:Math.round(G),min:Q,max:ee,bestMonth:ge?{year:ge.year,month:ge.month,value:ee}:null,worstMonth:ue?{year:ue.year,month:ue.month,value:Q}:null}}}B(f);const p={};for(const O of T)if(r.length>=2){const q=((Z=r[r.length-1])==null?void 0:Z.metrics[O])||0,Q=(((V=r[0])==null?void 0:V.metrics[O])||0)-q,ee=q>0?Q/q*100:0;p[O]={change:Q,percentChange:Math.round(ee*10)/10,trend:Q>0?"up":Q<0?"down":"stable"}}$(p)},_=r=>["Jan","Feb","Mar","Apr","Maj","Jun","Jul","Aug","Sep","Okt","Nov","Dec"][r-1],z=h.useMemo(()=>m.length?[...m].sort((r,u)=>{let f,x;C.key==="year_month"?(f=r.year*100+r.month,x=u.year*100+u.month):(f=r.metrics[C.key]||0,x=u.metrics[C.key]||0);const p=f-x;return C.direction==="asc"?p:-p}):[],[m,C]),y=h.useMemo(()=>{const r=(A-1)*M;return z.slice(r,r+M)},[z,A,M]),w=Math.ceil(z.length/M),v=r=>{E(u=>({key:r,direction:u.key===r&&u.direction==="asc"?"desc":"asc"}))},a=r=>C.key!==r?e.jsx(ha,{className:"h-4 w-4 ml-1 opacity-50"}):C.direction==="asc"?e.jsx(xa,{className:"h-4 w-4 ml-1"}):e.jsx(fa,{className:"h-4 w-4 ml-1"}),l=r=>{Y(u=>u.includes(r)?u.filter(f=>f!==r):[...u,r])},n=()=>{const r=s.find(V=>V.pageId===o),u=["År","Månad","Period",...T.map(V=>{const O=Le[V];return O?O.displayName:V})],f=z.map(V=>[V.year,V.month,`${_(V.month)} ${V.year}`,...T.map(O=>V.metrics[O]||0)]),x=[u.join(","),...f.map(V=>V.join(","))].join(`
`),p=new Blob([x],{type:"text/csv;charset=utf-8;"}),R=document.createElement("a"),Z=URL.createObjectURL(p);R.setAttribute("href",Z),R.setAttribute("download",`${r==null?void 0:r.pageName.replace(/[^a-zA-Z0-9]/g,"_")}_tidsserie.csv`),R.style.visibility="hidden",document.body.appendChild(R),R.click(),document.body.removeChild(R)},c=r=>r==null||isNaN(r)?"-":new Intl.NumberFormat("sv-SE").format(r);if(P)return e.jsxs(ne,{children:[e.jsx(Be,{className:"h-4 w-4"}),e.jsx(re,{children:"Laddar data"}),e.jsx(le,{children:"Analyserar tidserie-data för Facebook-sidor..."})]});if(j)return e.jsxs(ne,{variant:"destructive",children:[e.jsx(he,{className:"h-4 w-4"}),e.jsx(re,{children:"Fel"}),e.jsx(le,{children:j})]});if(s.length===0)return e.jsxs(ne,{children:[e.jsx(he,{className:"h-4 w-4"}),e.jsx(re,{children:"Inga sidor hittades"}),e.jsx(le,{children:"Kunde inte hitta några Facebook-sidor i den uppladdade datan."})]});const g=s.find(r=>r.pageId===o);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(X,{children:[e.jsx(ie,{children:e.jsxs(oe,{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-5 w-5 text-facebook-500"}),"Sidanalys över tid"]})}),e.jsxs(ce,{children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Välj Facebook-sida"}),e.jsxs(Me,{value:o,onValueChange:d,children:[e.jsx(Pe,{children:e.jsx(Re,{placeholder:"Välj sida att analysera"})}),e.jsx(Ce,{children:s.map(r=>e.jsx(Ee,{value:r.pageId,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(aa,{pageName:r.pageName}),e.jsx("span",{children:r.pageName})]})},r.pageId))})]}),g&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["ID: ",g.pageId]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Metrics att visa"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:Za.map(r=>{const u=T.includes(r.key);return e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:u,onChange:()=>l(r.key),className:"h-4 w-4 text-facebook-500 border-gray-300 rounded focus:ring-facebook-500"}),e.jsx("span",{className:"text-sm font-medium",children:r.label}),!r.canSum&&e.jsx("span",{className:"text-xs text-orange-600 font-medium",children:"*"})]},r.key)})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"* = Kan inte summeras över månader (unika personer)"})]})]}),b&&e.jsxs("div",{className:"grid md:grid-cols-4 gap-4 mb-6 p-4 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-facebook-600 flex items-center justify-center gap-2",children:[e.jsx(aa,{pageName:b.pageName}),b.totalPeriods]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Månader data"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-semibold",children:[_(b.firstPeriod.month)," ",b.firstPeriod.year]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Första månad"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-semibold",children:[_(b.lastPeriod.month)," ",b.lastPeriod.year]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Senaste månad"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-facebook-600",children:(g==null?void 0:g.pageName)||"Okänd sida"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Vald sida"})]})]}),Object.keys(F).length>0&&e.jsx("div",{className:"grid md:grid-cols-3 gap-4 mb-6",children:T.slice(0,3).map(r=>{const u=F[r],f=Le[r];return!u||!f?null:e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white border rounded-lg",children:[u.trend==="up"&&e.jsx(ve,{className:"h-5 w-5 text-green-600"}),u.trend==="down"&&e.jsx(_a,{className:"h-5 w-5 text-red-600"}),u.trend==="stable"&&e.jsx(Be,{className:"h-5 w-5 text-gray-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm",children:f.displayName}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[u.percentChange>0?"+":"",u.percentChange,"% sedan första månad"]})]})]},r)})})]})]}),e.jsxs(X,{children:[e.jsxs(ie,{className:"flex flex-row items-center justify-between",children:[e.jsxs(oe,{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-5 w-5"}),"Månadsvis utveckling - ",(g==null?void 0:g.pageName)||"Okänd sida"]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(L,{onClick:n,variant:"outline",size:"sm",children:[e.jsx(ma,{className:"h-4 w-4 mr-2"}),"CSV"]})})]}),e.jsxs(ce,{children:[m.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Ingen tidserie-data tillgänglig för vald sida"}):e.jsxs(e.Fragment,{children:[e.jsxs(ze,{children:[e.jsx(Ke,{children:e.jsxs(ke,{children:[e.jsx(we,{className:"cursor-pointer select-none",onClick:()=>v("year_month"),children:e.jsxs("div",{className:"flex items-center",children:["Period",a("year_month")]})}),T.map(r=>{const u=Le[r];return e.jsx(we,{className:"text-right cursor-pointer select-none",onClick:()=>v(r),children:e.jsxs("div",{className:"flex items-center justify-end",children:[(u==null?void 0:u.displayName)||r,a(r),!(u!=null&&u.canSumAcrossPages)&&e.jsx("span",{className:"ml-1 text-orange-600",children:"*"})]})},r)})]})}),e.jsx(Ye,{children:y.map((r,u)=>e.jsxs(ke,{children:[e.jsxs(Ae,{className:"font-medium",children:[_(r.month)," ",r.year]}),T.map(f=>{var x,p;return e.jsx(Ae,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[c(r.metrics[f]),((x=b==null?void 0:b.metrics[f])==null?void 0:x.bestMonth)&&b.metrics[f].bestMonth.year===r.year&&b.metrics[f].bestMonth.month===r.month&&e.jsx("span",{className:"text-yellow-600",title:"Bästa värde för denna sida",children:"🏆"}),((p=b==null?void 0:b.metrics[f])==null?void 0:p.worstMonth)&&b.metrics[f].worstMonth.year===r.year&&b.metrics[f].worstMonth.month===r.month&&e.jsx("span",{className:"text-gray-500",title:"Sämsta värde för denna sida",children:"📉"})]})},f)})]},`${r.year}_${r.month}`))})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Visa:"}),e.jsxs(Me,{value:M.toString(),onValueChange:r=>{U(Number(r)),D(1)},children:[e.jsx(Pe,{className:"w-[120px]",children:e.jsx(Re,{})}),e.jsx(Ce,{children:Ja.map(r=>e.jsx(Ee,{value:r.value.toString(),children:r.label},r.value))})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Visar ",(A-1)*M+1," till ",Math.min(A*M,z.length)," av ",z.length]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{variant:"outline",size:"sm",onClick:()=>D(r=>Math.max(1,r-1)),disabled:A===1,children:e.jsx(ua,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-sm",children:["Sida ",A," av ",w]}),e.jsx(L,{variant:"outline",size:"sm",onClick:()=>D(r=>Math.min(w,r+1)),disabled:A>=w,children:e.jsx(ga,{className:"h-4 w-4"})})]})]})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-muted/30 rounded-lg",children:e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"🏆 = Bästa värde för denna sida"}),e.jsx("span",{className:"mx-4",children:"📉 = Sämsta värde för denna sida"})]}),e.jsx("div",{className:"text-muted-foreground text-xs",children:"Gröna värden = bästa prestanda, röda värden = sämsta prestanda för vald tidsperiod"})]})})]})]})]})}const te={P1:"#0066cc",P2:"#ff6600",P3:"#00cc66",P4:"#cc33cc",EKOT:"#005eb8",RADIOSPORTEN:"#1c5c35",SR:"#000000",default:"#000000"},es=({pageName:i})=>{const s=i||"Okänd";let t=te.default,o="";const d=s.toLowerCase();d.includes("ekot")||d.includes("radio sweden")?(t=te.EKOT,o="E"):d.includes("radiosporten")||d.includes("radio sporten")?(t=te.RADIOSPORTEN,o="RS"):d.includes("p1")?(t=te.P1,o="P1"):d.includes("p2")?(t=te.P2,o="P2"):d.includes("p3")?(t=te.P3,o="P3"):d.includes("p4")?(t=te.P4,o="P4"):d.includes("sveriges radio")&&!d.includes("p1")&&!d.includes("p2")&&!d.includes("p3")&&!d.includes("p4")?(t=te.SR,o="SR"):o=s.charAt(0).toUpperCase();const N=t===te.P2||t===te.P3?"text-black":"text-white";return e.jsx("div",{className:`flex-shrink-0 w-6 h-6 rounded-sm flex items-center justify-center text-xs font-bold ${N}`,style:{backgroundColor:t},title:i,children:o})},as=[{value:10,label:"10 per sida"},{value:25,label:"25 per sida"},{value:50,label:"50 per sida"}],ss=[{key:"reach",label:"Räckvidd",canSum:!1},{key:"engagements",label:"Engagemang",canSum:!0},{key:"reactions",label:"Reaktioner",canSum:!0},{key:"publications",label:"Publiceringar",canSum:!0}],fe={reach:{displayName:"Räckvidd",canSumAcrossPages:!1,category:"unique_persons"},engagements:{displayName:"Engagemang",canSumAcrossPages:!0,category:"countable"},reactions:{displayName:"Reaktioner",canSumAcrossPages:!0,category:"countable"},publications:{displayName:"Publiceringar",canSumAcrossPages:!0,category:"countable"}};function ts({uploadedPeriods:i=[]}){const[s,t]=h.useState(null),[o,d]=h.useState([]),[m,N]=h.useState(null),[P,S]=h.useState(!1),[j,k]=h.useState(null),[b,B]=h.useState({key:"pageName",direction:"asc"}),[F,$]=h.useState(1),[C,E]=h.useState(25),[A,D]=h.useState(["reach","engagements","publications"]);h.useEffect(()=>{if(i.length>0&&!s){const a=i[0];t({year:a.year,month:a.month})}},[i,s]),h.useEffect(()=>{if(!s)return;(()=>{try{S(!0),k(null);const l=i.find(g=>g.year===s.year&&g.month===s.month);if(!l){k(`Ingen data hittades för ${U(s.month)} ${s.year}`),d([]),N(null);return}const n=l.data.map(g=>({page:{pageName:g.Page||g.page||"Okänd sida",pageId:g["Page ID"]||g.pageId||"unknown"},period:{year:s.year,month:s.month},metrics:{reach:M(g.Reach||g.reach),engagements:M(g.Engagements||g.engagements),reactions:M(g.Reactions||g.reactions),publications:M(g.Publications||g.publications)}}));d(n);const c=T(n,s.year,s.month);N(c)}catch(l){console.error("Error loading period data:",l),k(`Kunde inte ladda data för ${U(s.month)} ${s.year}`)}finally{S(!1)}})()},[s,i]);const M=a=>{if(a==null||a==="")return 0;const l=parseFloat(String(a).replace(/[,\s]/g,""));return isNaN(l)?0:l},U=a=>["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"][a-1],T=(a,l,n)=>{if(!a.length)return null;const c={period:{year:l,month:n},totalPages:a.length,metrics:{}},g=["reach","engagements","reactions","publications"];for(const r of g){const u=a.map(x=>x.metrics[r]).filter(x=>x!=null&&!isNaN(x)&&x>=0);if(u.length===0){c.metrics[r]={total:0,average:0,min:0,max:0,validPages:0,type:fe[r].category};continue}if(!fe[r].canSumAcrossPages)c.metrics[r]={average:Math.round(u.reduce((x,p)=>x+p,0)/u.length),min:Math.min(...u),max:Math.max(...u),validPages:u.length,type:"unique_persons",note:"Genomsnitt över sidor - total reach kan inte beräknas"};else{const x=u.reduce((p,R)=>p+R,0);c.metrics[r]={total:x,average:Math.round(x/u.length),min:Math.min(...u),max:Math.max(...u),validPages:u.length,type:"countable"}}}return c},Y=h.useMemo(()=>o.length?[...o].sort((a,l)=>{let n,c;if(b.key==="pageName"?(n=a.page.pageName,c=l.page.pageName):(n=a.metrics[b.key]||0,c=l.metrics[b.key]||0),typeof n=="string"){const r=n.localeCompare(c);return b.direction==="asc"?r:-r}const g=n-c;return b.direction==="asc"?g:-g}):[],[o,b]),W=h.useMemo(()=>{const a=(F-1)*C;return Y.slice(a,a+C)},[Y,F,C]),H=Math.ceil(Y.length/C),_=a=>{B(l=>({key:a,direction:l.key===a&&l.direction==="asc"?"desc":"asc"}))},z=a=>b.key!==a?e.jsx(ha,{className:"h-4 w-4 ml-1 opacity-50"}):b.direction==="asc"?e.jsx(xa,{className:"h-4 w-4 ml-1"}):e.jsx(fa,{className:"h-4 w-4 ml-1"}),y=a=>{D(l=>l.includes(a)?l.filter(n=>n!==a):[...l,a])},w=()=>{const a=["Sidnamn","Sido-ID",...A.map(f=>{const x=fe[f];return x?x.displayName:f})],l=Y.map(f=>[f.page.pageName,f.page.pageId,...A.map(x=>f.metrics[x]||0)]),n=[a.join(","),...l.map(f=>f.join(","))].join(`
`),c=new Blob([n],{type:"text/csv;charset=utf-8;"}),g=document.createElement("a"),r=URL.createObjectURL(c);g.setAttribute("href",r);const u=s?`${U(s.month)}_${s.year}`:"månadsjämförelse";g.setAttribute("download",`Facebook_${u}.csv`),g.style.visibility="hidden",document.body.appendChild(g),g.click(),document.body.removeChild(g)},v=a=>a==null||isNaN(a)?"-":new Intl.NumberFormat("sv-SE").format(a);return P?e.jsxs(ne,{children:[e.jsx(Be,{className:"h-4 w-4"}),e.jsx(re,{children:"Laddar data"}),e.jsx(le,{children:"Analyserar månadsdata för Facebook-sidor..."})]}):j?e.jsxs(ne,{variant:"destructive",children:[e.jsx(he,{className:"h-4 w-4"}),e.jsx(re,{children:"Fel"}),e.jsx(le,{children:j})]}):i.length===0?e.jsxs(ne,{children:[e.jsx(he,{className:"h-4 w-4"}),e.jsx(re,{children:"Ingen data"}),e.jsx(le,{children:"Ladda upp CSV-filer för att visa månadsvis jämförelse av Facebook-sidor."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(X,{children:[e.jsx(ie,{children:e.jsxs(oe,{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-5 w-5 text-facebook-500"}),"Månadsvis jämförelse"]})}),e.jsxs(ce,{children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Välj månad"}),e.jsxs(Me,{value:s?`${s.year}_${s.month}`:"",onValueChange:a=>{const[l,n]=a.split("_");t({year:parseInt(l),month:parseInt(n)})},children:[e.jsx(Pe,{children:e.jsx(Re,{placeholder:"Välj månad att analysera"})}),e.jsx(Ce,{children:i.map(a=>e.jsxs(Ee,{value:`${a.year}_${a.month}`,children:[U(a.month)," ",a.year]},`${a.year}_${a.month}`))})]}),s&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Visar data för ",U(s.month)," ",s.year]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Metrics att visa"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:ss.map(a=>{const l=A.includes(a.key);return e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:()=>y(a.key),className:"h-4 w-4 text-facebook-500 border-gray-300 rounded focus:ring-facebook-500"}),e.jsx("span",{className:"text-sm font-medium",children:a.label}),!a.canSum&&e.jsx("span",{className:"text-xs text-orange-600 font-medium",children:"*"})]},a.key)})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"* = Kan inte summeras över sidor (unika personer per månad)"})]})]}),m&&e.jsxs("div",{className:"grid md:grid-cols-4 gap-4 mb-6 p-4 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-facebook-600",children:m.totalPages}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Facebook-sidor"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-semibold",children:[U(m.period.month)," ",m.period.year]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Vald period"})]}),A.slice(0,2).map(a=>{const l=m.metrics[a],n=fe[a];return!l||!n?null:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold",children:n.canSumAcrossPages?v(l.total):v(l.average)}),e.jsx("div",{className:"text-sm text-muted-foreground",children:n.canSumAcrossPages?`Total ${n.displayName}`:`Snitt ${n.displayName}`})]},a)})]})]})]}),e.jsxs(X,{children:[e.jsxs(ie,{className:"flex flex-row items-center justify-between",children:[e.jsxs(oe,{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-5 w-5"}),s?`${U(s.month)} ${s.year} - Alla sidor`:"Månadsdata"]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(L,{onClick:w,variant:"outline",size:"sm",children:[e.jsx(ma,{className:"h-4 w-4 mr-2"}),"CSV"]})})]}),e.jsxs(ce,{children:[o.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Ingen data tillgänglig för vald månad"}):e.jsxs(e.Fragment,{children:[e.jsxs(ze,{children:[e.jsx(Ke,{children:e.jsxs(ke,{children:[e.jsx(we,{className:"cursor-pointer select-none",onClick:()=>_("pageName"),children:e.jsxs("div",{className:"flex items-center",children:["Sidnamn",z("pageName")]})}),A.map(a=>{const l=fe[a];return e.jsx(we,{className:"text-right cursor-pointer select-none",onClick:()=>_(a),children:e.jsxs("div",{className:"flex items-center justify-end",children:[(l==null?void 0:l.displayName)||a,z(a),!(l!=null&&l.canSumAcrossPages)&&e.jsx("span",{className:"ml-1 text-orange-600",children:"*"})]})},a)})]})}),e.jsx(Ye,{children:W.map((a,l)=>e.jsxs(ke,{children:[e.jsx(Ae,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(es,{pageName:a.page.pageName}),e.jsx("span",{children:a.page.pageName})]})}),A.map(n=>e.jsx(Ae,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[v(a.metrics[n]),(m==null?void 0:m.metrics[n])&&a.metrics[n]===m.metrics[n].max&&m.metrics[n].max!==m.metrics[n].min&&e.jsx("span",{className:"text-yellow-600",title:"Bästa värde för denna månad",children:"🏆"}),(m==null?void 0:m.metrics[n])&&a.metrics[n]===m.metrics[n].min&&m.metrics[n].max!==m.metrics[n].min&&e.jsx("span",{className:"text-gray-500",title:"Lägsta värde för denna månad",children:"📉"})]})},n))]},a.page.pageId))})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Visa:"}),e.jsxs(Me,{value:C.toString(),onValueChange:a=>{E(Number(a)),$(1)},children:[e.jsx(Pe,{className:"w-[120px]",children:e.jsx(Re,{})}),e.jsx(Ce,{children:as.map(a=>e.jsx(Ee,{value:a.value.toString(),children:a.label},a.value))})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Visar ",(F-1)*C+1," till ",Math.min(F*C,Y.length)," av ",Y.length]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{variant:"outline",size:"sm",onClick:()=>$(a=>Math.max(1,a-1)),disabled:F===1,children:e.jsx(ua,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-sm",children:["Sida ",F," av ",H]}),e.jsx(L,{variant:"outline",size:"sm",onClick:()=>$(a=>Math.min(H,a+1)),disabled:F>=H,children:e.jsx(ga,{className:"h-4 w-4"})})]})]})]})]}),A.some(a=>{var l;return((l=fe[a])==null?void 0:l.category)==="unique_persons"})&&e.jsxs(ne,{className:"mt-4 bg-amber-50 border-amber-200",children:[e.jsx(he,{className:"h-4 w-4 text-amber-600"}),e.jsx(re,{className:"text-amber-800",children:"Viktigt om Räckvidd"}),e.jsx(le,{className:"text-amber-700",children:"Räckvidd representerar unika personer per månad och kan ALDRIG summeras över månader eller sidor. Värdena i tabellen visar data för den valda månaden."})]})]})]})]})}const ns=["reach","engagedUsers"],rs=["engagements","reactions","publications","status","comment"],Se={reach:{category:"unique_persons",displayName:"Räckvidd",description:"Antal unika personer som såg innehållet under månaden",unit:"personer",canSumAcrossTime:!1,canSumAcrossPages:!1,preferredAggregation:"average",validAggregations:["average","min","max"],dataType:"integer",csvColumn:"Reach",icon:"👁️",color:"#3B82F6",warningNote:"Kan ALDRIG summeras över månader - representerar unika personer"},engagedUsers:{category:"unique_persons",displayName:"Engagerade användare",description:"Antal unika personer som interagerade med innehållet under månaden",unit:"personer",canSumAcrossTime:!1,canSumAcrossPages:!1,preferredAggregation:"average",validAggregations:["average","min","max"],dataType:"integer",csvColumn:"Engaged Users",icon:"🤝",color:"#10B981",warningNote:"Kan ALDRIG summeras över månader - representerar unika personer"},engagements:{category:"countable_events",displayName:"Engagemang",description:"Totalt antal engagemang (från Facebook API) - separat från beräknade interaktioner",unit:"engagemang",canSumAcrossTime:!0,canSumAcrossPages:!0,preferredAggregation:"sum",validAggregations:["sum","average","min","max"],dataType:"integer",csvColumn:"Engagements",icon:"💬",color:"#8B5CF6",warningNote:null},reactions:{category:"countable_events",displayName:"Reaktioner",description:"Antal likes, hearts, och andra reaktioner på innehåll",unit:"reaktioner",canSumAcrossTime:!0,canSumAcrossPages:!0,preferredAggregation:"sum",validAggregations:["sum","average","min","max"],dataType:"integer",csvColumn:"Reactions",icon:"❤️",color:"#EF4444",warningNote:null},publications:{category:"countable_events",displayName:"Publiceringar",description:"Antal publicerade inlägg under månaden",unit:"inlägg",canSumAcrossTime:!0,canSumAcrossPages:!0,preferredAggregation:"sum",validAggregations:["sum","average","min","max"],dataType:"integer",csvColumn:"Publications",icon:"📝",color:"#F59E0B",warningNote:null},status:{category:"countable_events",displayName:"Statusuppdateringar",description:"Antal statusuppdateringar under månaden",unit:"statusar",canSumAcrossTime:!0,canSumAcrossPages:!0,preferredAggregation:"sum",validAggregations:["sum","average","min","max"],dataType:"integer",csvColumn:"Status",icon:"📢",color:"#14B8A6",warningNote:null},comment:{category:"countable_events",displayName:"Kommentarer",description:"Antal kommentarer på innehåll",unit:"kommentarer",canSumAcrossTime:!0,canSumAcrossPages:!0,preferredAggregation:"sum",validAggregations:["sum","average","min","max"],dataType:"integer",csvColumn:"Comment",icon:"💭",color:"#6366F1",warningNote:null}};function Na(i){return Object.keys(Se).filter(s=>Se[s].category===i)}function ls(){return Na("countable_events")}function is(){return Na("unique_persons")}function os(){const i=[],s=[],t=ls(),o=rs,d=o.filter(k=>!t.includes(k)),m=t.filter(k=>!o.includes(k));d.length>0&&i.push(`Saknade summerbara metrics: ${d.join(", ")}`),m.length>0&&i.push(`Extra summerbara metrics: ${m.join(", ")}`);const N=is(),P=ns,S=P.filter(k=>!N.includes(k)),j=N.filter(k=>!P.includes(k));return S.length>0&&i.push(`Saknade icke-summerbara metrics: ${S.join(", ")}`),j.length>0&&i.push(`Extra icke-summerbara metrics: ${j.join(", ")}`),{isConsistent:i.length===0,errors:i,warnings:s}}const sa=os();sa.isConsistent||console.error("KRITISK: metric_categorizer.js är inte konsistent med reach_calculator.js:",sa.errors);class De{constructor(s,t){if(!s||!t)throw new Error("FacebookPage kräver både pageName och pageId");this.pageName=s.trim(),this.pageId=String(t).trim(),this.createdAt=new Date}static fromCSVRow(s){if(!s.Page||!s["Page ID"])throw new Error("CSV-rad saknar obligatoriska fält: Page eller Page ID");return new De(s.Page,s["Page ID"])}getKey(){return`page_${this.pageId}`}isValid(){return this.pageName.length>0&&this.pageId.length>0}}class $e{constructor(s,t,o,d){if(!(s instanceof De))throw new Error("MonthlyPageData kräver en FacebookPage instans");if(!t||!o||o<1||o>12)throw new Error("MonthlyPageData kräver giltigt år och månad (1-12)");this.page=s,this.year=parseInt(t),this.month=parseInt(o),this.metrics=this.validateMetrics(d||{}),this.createdAt=new Date}validateMetrics(s){return{reach:this.parseNumeric(s.reach||s.Reach),engagedUsers:this.parseNumeric(s.engagedUsers||s["Engaged Users"]),engagements:this.parseNumeric(s.engagements||s.Engagements),reactions:this.parseNumeric(s.reactions||s.Reactions),publications:this.parseNumeric(s.publications||s.Publications),status:this.parseNumeric(s.status||s.Status),comment:this.parseNumeric(s.comment||s.Comment)}}parseNumeric(s){if(s==null||s==="")return 0;const t=parseFloat(String(s).replace(/,/g,""));return isNaN(t)?0:t}static fromCSVRow(s,t,o){const d=De.fromCSVRow(s);return new $e(d,t,o,s)}getKey(){return`${this.page.getKey()}_${this.year}_${this.month}`}getPeriod(){return{year:this.year,month:this.month}}isSamePeriod(s,t){return this.year===s&&this.month===t}getSummerableMetrics(){return{engagements:this.metrics.engagements,reactions:this.metrics.reactions,publications:this.metrics.publications,status:this.metrics.status,comment:this.metrics.comment}}getNonSummerableMetrics(){return{reach:this.metrics.reach,engagedUsers:this.metrics.engagedUsers}}}class cs{constructor(s){if(!(s instanceof De))throw new Error("PageTimeseries kräver en FacebookPage instans");this.page=s,this.monthlyData=new Map,this.createdAt=new Date}addMonthlyData(s){if(!(s instanceof $e))throw new Error("addMonthlyData kräver MonthlyPageData instans");if(s.page.pageId!==this.page.pageId)throw new Error("MonthlyData måste tillhöra samma sida");const t=`${s.year}_${s.month}`;this.monthlyData.set(t,s)}getMonthlyData(s,t){const o=`${s}_${t}`;return this.monthlyData.get(o)||null}getAvailablePeriods(){return Array.from(this.monthlyData.values()).map(s=>s.getPeriod()).sort((s,t)=>s.year!==t.year?s.year-t.year:s.month-t.month)}getAllMonthlyData(){return Array.from(this.monthlyData.values()).sort((s,t)=>s.year!==t.year?s.year-t.year:s.month-t.month)}hasDataForPeriod(s,t){return this.getMonthlyData(s,t)!==null}getMonthCount(){return this.monthlyData.size}}class ds{constructor(){this.pageTimeseries=new Map,this.createdAt=new Date}addMonthlyData(s){if(!(s instanceof $e))throw new Error("addMonthlyData kräver MonthlyPageData instans");const t=s.page.getKey();this.pageTimeseries.has(t)||this.pageTimeseries.set(t,new cs(s.page)),this.pageTimeseries.get(t).addMonthlyData(s)}getPageTimeseries(s){const t=`page_${s}`;return this.pageTimeseries.get(t)||null}getAllPages(){return Array.from(this.pageTimeseries.values()).map(s=>s.page).sort((s,t)=>s.pageName.localeCompare(t.pageName))}getAllPeriods(){const s=new Set;for(const t of this.pageTimeseries.values())for(const o of t.getAvailablePeriods())s.add(`${o.year}_${o.month}`);return Array.from(s).map(t=>{const[o,d]=t.split("_");return{year:parseInt(o),month:parseInt(d)}}).sort((t,o)=>t.year!==o.year?t.year-o.year:t.month-o.month)}getDataForPeriod(s,t){const o=[];for(const d of this.pageTimeseries.values()){const m=d.getMonthlyData(s,t);m&&o.push(m)}return o.sort((d,m)=>d.page.pageName.localeCompare(m.page.pageName))}getStats(){return{totalPages:this.pageTimeseries.size,totalPeriods:this.getAllPeriods().length,totalDataPoints:Array.from(this.pageTimeseries.values()).reduce((s,t)=>s+t.getMonthCount(),0)}}clear(){this.pageTimeseries.clear()}}const ms=[{key:"reach",label:"Räckvidd",canSum:!1},{key:"engagements",label:"Engagemang",canSum:!0},{key:"reactions",label:"Reaktioner",canSum:!0},{key:"publications",label:"Publiceringar",canSum:!0}],Ve=["#2563EB","#16A34A","#EAB308","#DC2626","#7C3AED","#EA580C","#0891B2","#BE185D","#059669","#7C2D12","#4338CA","#C2410C"],us=({uploadedPeriods:i})=>{var v;const[s,t]=h.useState("reach"),[o,d]=h.useState([]),[m,N]=h.useState([]),[P,S]=h.useState(null),[j,k]=h.useState({x:0,y:0}),[b,B]=h.useState(!1);h.useMemo(()=>!i||i.length===0?null:new ds(i),[i]);const F=h.useMemo(()=>{if(!i||i.length===0)return[];const a=new Map;return i.forEach(l=>{l.data&&Array.isArray(l.data)&&l.data.forEach(n=>{const c=n.Page||n.page||"Okänd sida",g=n["Page ID"]||n.pageId||`page_${c.replace(/\s+/g,"_")}`;a.has(g)||a.set(g,{pageId:g,pageName:c})})}),Array.from(a.values()).sort((l,n)=>l.pageName.localeCompare(n.pageName))},[i]),$=h.useMemo(()=>i?i.map(a=>({...a,sortKey:a.year*100+a.month})).sort((a,l)=>a.sortKey-l.sortKey):[],[i]),C=a=>["Jan","Feb","Mar","Apr","Maj","Jun","Jul","Aug","Sep","Okt","Nov","Dec"][a-1]||a.toString(),E=a=>({reach:"Reach",engagements:"Engagements",reactions:"Reactions",publications:"Publications"})[a]||a,A=(a,l)=>{const n=l.indexOf(a);return n>=0?Ve[n%Ve.length]:Ve[0]},D=()=>{var Q;const a=document.querySelector("#trend-chart-svg");if(!a||_.length===0)return;const l=document.createElement("canvas"),n=l.getContext("2d"),c=1200,g=900;l.width=c,l.height=g,n.fillStyle="white",n.fillRect(0,0,c,g);const r=60,u=60;n.fillStyle="#dbeafe",n.fillRect(100,r,c-200,u),n.strokeStyle="#3b82f6",n.lineWidth=2,n.strokeRect(100,r,c-200,u),n.fillStyle="#1e40af",n.textAlign="center",n.font="bold 20px Arial, sans-serif",n.fillText(`Visar: ${(Q=Se[s])==null?void 0:Q.displayName}`,c/2,r+30),n.font="14px Arial, sans-serif",n.fillText("Aktuell datapunkt som visas i diagrammet",c/2,r+50);const f=140,x=200,p=_.length*x,R=(c-p)/2;_.forEach((ee,ge)=>{const ue=R+ge*x;n.fillStyle=ee.color,n.beginPath(),n.arc(ue+10,f+12,6,0,2*Math.PI),n.fill(),n.fillStyle="#374151",n.font="14px Arial, sans-serif",n.textAlign="left";let J=ee.pageName;J.length>20&&(J=J.substring(0,17)+"..."),n.fillText(J,ue+25,f+17)});const Z=new XMLSerializer().serializeToString(a),V=new Blob([Z],{type:"image/svg+xml;charset=utf-8"}),O=window.URL||window.webkitURL,q=O.createObjectURL(V),G=new Image;G.onload=()=>{const ee=f+50,ge=g-ee-100,ue=c-200;n.drawImage(G,100,ee,ue,ge);const J=g-60;n.fillStyle="#6b7280",n.font="16px Arial, sans-serif",n.textAlign="center";const ae=_.map(de=>de.pageName);let Te="";ae.length===1?Te=`Konto: ${ae[0]}`:ae.length<=3?Te=`Konton: ${ae.join(", ")}`:Te=`${ae.length} konton: ${ae.slice(0,2).join(", ")} med flera`;const ba=c-200,_e=Te.split(" ");let ye="",Oe=J;for(let de=0;de<_e.length;de++){const je=ye+_e[de]+" ";n.measureText(je).width>ba&&de>0?(n.fillText(ye,c/2,Oe),ye=_e[de]+" ",Oe+=25):ye=je}n.fillText(ye,c/2,Oe),l.toBlob(de=>{const je=O.createObjectURL(de),xe=document.createElement("a");xe.href=je;const Xe=ae.length===1?ae[0].replace(/[^a-zA-Z0-9]/g,"-"):`${ae.length}-konton`;xe.download=`trend-analys-${s}-${Xe}-${new Date().toISOString().slice(0,10)}.png`,document.body.appendChild(xe),xe.click(),document.body.removeChild(xe),O.revokeObjectURL(je)},"image/png",1),O.revokeObjectURL(q)},G.src=q},M=a=>{d(l=>l.includes(a)?l.filter(n=>n!==a):[...l,a])},U=a=>{t(a)},T=a=>{const l=`${a.year}-${a.month}`;N(n=>n.find(g=>`${g.year}-${g.month}`===l)?n.filter(g=>`${g.year}-${g.month}`!==l):[...n,a])},Y=h.useMemo(()=>m.length>0&&m.length===$.length,[m.length,$.length]),W=()=>{N(Y?[]:$)},H=h.useMemo(()=>{if(!i||o.length===0||m.length===0)return[];const a=[];return m.forEach(n=>{n.data&&Array.isArray(n.data)&&o.forEach(c=>{const g=n.data.find(r=>(r["Page ID"]||r.pageId||`page_${(r.Page||r.page||"").replace(/\s+/g,"_")}`)===c);if(g){const r=E(s),u=g[r];let f=0;if(u!=null&&u!==""){const x=String(u).replace(/[,\s]/g,"");f=parseFloat(x)||0}a.push({periodKey:`${n.year}-${n.month.toString().padStart(2,"0")}`,period:`${C(n.month)} ${n.year}`,month:C(n.month),year:n.year,pageId:c,pageName:g.Page||g.page||"Okänd sida",value:f,metric:s})}})}),a},[i,o,m,s]),_=h.useMemo(()=>{const a=new Map;return H.forEach(l=>{a.has(l.pageId)||a.set(l.pageId,{pageId:l.pageId,pageName:l.pageName,points:[],color:A(l.pageId,o)}),a.get(l.pageId).points.push(l)}),a.forEach(l=>{l.points.sort((n,c)=>n.periodKey.localeCompare(c.periodKey))}),Array.from(a.values())},[H,o]),z=h.useMemo(()=>{if(H.length===0)return{min:0,max:1e3,step:200,ticks:[0,200,400,600,800,1e3]};const a=H.map(r=>r.value),l=Math.max(...a);let n,c;l<=500?(n=100,c=Math.ceil(l/n)*n):l<=5e3?(n=1e3,c=Math.ceil(l/n)*n):l<=5e4?(n=1e4,c=Math.ceil(l/n)*n):l<=5e5?(n=1e5,c=Math.ceil(l/n)*n):(n=1e6,c=Math.ceil(l/n)*n);const g=[];for(let r=0;r<=c;r+=n)g.push(r);return{min:0,max:c,step:n,ticks:g}},[H]),y=a=>{if(a.length<2)return"";if(a.length===2){const[n,c]=a;return`M ${n.x} ${n.y} L ${c.x} ${c.y}`}let l=`M ${a[0].x} ${a[0].y}`;for(let n=1;n<a.length;n++){const c=a[n],g=a[n-1];if(n===1){const r=a[n+1]||c,u=g.x+(c.x-g.x)*.3,f=g.y+(c.y-g.y)*.3,x=c.x-(r.x-g.x)*.1,p=c.y-(r.y-g.y)*.1;l+=` C ${u} ${f}, ${x} ${p}, ${c.x} ${c.y}`}else if(n===a.length-1){const r=a[n-2]||g,u=g.x+(c.x-r.x)*.1,f=g.y+(c.y-r.y)*.1,x=c.x-(c.x-g.x)*.3,p=c.y-(c.y-g.y)*.3;l+=` C ${u} ${f}, ${x} ${p}, ${c.x} ${c.y}`}else{const r=a[n+1],u=a[n-2]||g,f=g.x+(c.x-u.x)*.1,x=g.y+(c.y-u.y)*.1,p=c.x-(r.x-g.x)*.1,R=c.y-(r.y-g.y)*.1;l+=` C ${f} ${x}, ${p} ${R}, ${c.x} ${c.y}`}}return l},w=(a,l)=>{const n=a.currentTarget.getBoundingClientRect();k({x:a.clientX-n.left,y:a.clientY-n.top}),S(l)};return!i||i.length===0?e.jsxs(X,{children:[e.jsx(ie,{children:e.jsxs(oe,{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-5 w-5"}),"Trendanalys"]})}),e.jsx(ce,{children:e.jsx("p",{className:"text-muted-foreground",children:"Ladda upp minst två månadsfiler för att se trendanalys."})})]}):e.jsx("div",{className:"space-y-6",children:e.jsxs(X,{children:[e.jsxs(ie,{className:"flex flex-row items-center justify-between",children:[e.jsxs(oe,{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"h-5 w-5"}),"Utveckling över tid"]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(L,{onClick:D,variant:"outline",size:"sm",disabled:_.length===0,children:"📊 Exportera PNG"})})]}),e.jsxs(ce,{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 block",children:["Välj Facebook-sidor (",o.length," valda)"]}),e.jsx("div",{className:"max-h-32 overflow-y-auto border rounded p-2 space-y-1",children:F.map(a=>{const l=o.includes(a.pageId);return e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:()=>M(a.pageId),className:"h-4 w-4 text-facebook-500 border-gray-300 rounded focus:ring-facebook-500"}),e.jsx("span",{className:"text-sm font-medium",children:a.pageName})]},a.pageId)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Välj datapunkt"}),e.jsx("div",{className:"space-y-2",children:ms.map(a=>{const l=s===a.key;return e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"metric",checked:l,onChange:()=>U(a.key),className:"h-4 w-4 text-facebook-500 border-gray-300 focus:ring-facebook-500"}),e.jsx("span",{className:"text-sm font-medium",children:a.label})]},a.key)})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 block",children:["Välj perioder (",m.length," valda)"]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer mb-2 p-2 bg-gray-50 rounded",children:[e.jsx("input",{type:"checkbox",checked:Y,onChange:W,className:"h-4 w-4 text-facebook-500 border-gray-300 rounded focus:ring-facebook-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Välj alla perioder"})]}),e.jsx("div",{className:"max-h-32 overflow-y-auto border rounded p-2 space-y-1",children:$.map(a=>{const l=m.some(n=>n.year===a.year&&n.month===a.month);return e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:()=>T(a),className:"h-4 w-4 text-facebook-500 border-gray-300 rounded focus:ring-facebook-500"}),e.jsxs("span",{className:"text-sm font-medium",children:[C(a.month)," ",a.year]})]},`${a.year}-${a.month}`)})})]})]}),s&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-center",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-900",children:["Visar: ",(v=Se[s])==null?void 0:v.displayName]}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Aktuell datapunkt som visas i diagrammet"})]}),_.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-wrap gap-3",children:_.map(a=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full border",style:{backgroundColor:a.color}}),e.jsx("span",{className:"text-sm font-medium",children:a.pageName})]},a.pageId))}),e.jsx("div",{className:"relative",children:e.jsxs("svg",{id:"trend-chart-svg",width:"100%",height:"500",viewBox:"0 0 1000 500",className:"border rounded bg-gray-50",onMouseLeave:()=>S(null),children:[e.jsx("defs",{children:e.jsx("pattern",{id:"grid",width:"50",height:"50",patternUnits:"userSpaceOnUse",children:e.jsx("path",{d:"M 50 0 L 0 0 0 50",fill:"none",stroke:"#e5e7eb",strokeWidth:"1"})})}),e.jsx("rect",{width:"100%",height:"100%",fill:"url(#grid)"}),z.ticks.map(a=>{const l=450-a/z.max*380;return e.jsxs("g",{children:[e.jsx("line",{x1:"100",y1:l,x2:"930",y2:l,stroke:"#d1d5db",strokeWidth:"1"}),e.jsx("text",{x:"95",y:l+4,textAnchor:"end",fontSize:"14",fill:"#6b7280",children:a.toLocaleString()})]},a)}),$.map((a,l)=>{const n=100+l/Math.max(1,$.length-1)*830;return e.jsxs("g",{children:[e.jsx("line",{x1:n,y1:"70",x2:n,y2:"450",stroke:"#d1d5db",strokeWidth:"1"}),e.jsx("text",{x:n,y:"475",textAnchor:"middle",fontSize:"14",fill:"#6b7280",children:C(a.month)}),e.jsx("text",{x:n,y:"490",textAnchor:"middle",fontSize:"12",fill:"#9ca3af",children:a.year})]},`${a.year}-${a.month}`)}),_.map(a=>{if(a.points.length<1)return null;const l=a.points.map((n,c)=>{const r=100+$.findIndex(f=>`${f.year}-${f.month.toString().padStart(2,"0")}`===n.periodKey)/Math.max(1,$.length-1)*830,u=450-n.value/z.max*380;return{x:r,y:u,point:n}});return e.jsxs("g",{children:[a.points.length>1&&e.jsx("path",{d:y(l),fill:"none",stroke:a.color,strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),l.map(({x:n,y:c,point:g},r)=>e.jsx("circle",{cx:n,cy:c,r:"6",fill:a.color,stroke:"white",strokeWidth:"3",className:"cursor-pointer",onMouseEnter:u=>w(u,g),onMouseLeave:()=>S(null)},r))]},a.pageId)}),P&&e.jsx("g",{children:(()=>{var g;let n=j.x+15,c=j.y-35;return n+200>980&&(n=j.x-200-15),c<15&&(c=j.y+15),c+70>480&&(c=j.y-70-15),e.jsxs(e.Fragment,{children:[e.jsx("rect",{x:n,y:c,width:200,height:70,fill:"rgba(0,0,0,0.85)",rx:"6"}),e.jsx("text",{x:n+12,y:c+20,fill:"white",fontSize:"13",fontWeight:"bold",children:P.pageName}),e.jsx("text",{x:n+12,y:c+38,fill:"white",fontSize:"12",children:P.period}),e.jsxs("text",{x:n+12,y:c+55,fill:"white",fontSize:"12",children:[(g=Se[P.metric])==null?void 0:g.displayName,": ",P.value.toLocaleString()]})]})})()})]})})]}):e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(Ge,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"Välj sidor och perioder för att visa diagram"}),e.jsx("p",{className:"text-sm",children:o.length===0&&m.length===0?"Markera minst en Facebook-sida och period":o.length===0?"Markera minst en Facebook-sida i listan ovan":"Markera minst en period i listan ovan"})]})]})]})})},K={LOCALSTORAGE_KEYS:{METADATA:"fb_analyzer_metadata",PERIODS:"fb_analyzer_periods",PAGES:"fb_analyzer_pages",SETTINGS:"fb_analyzer_settings"},INDEXEDDB:{NAME:"FacebookAnalyzerDB",VERSION:1,STORES:{MONTHLY_DATA:"monthlyData",TIMESERIES:"timeseries"}},LIMITS:{LOCALSTORAGE_MAX:5*1024*1024,INDEXEDDB_MAX:50*1024*1024,MAX_PERIODS:120,MAX_PAGES:1e3}};async function He(){return new Promise((i,s)=>{const t=indexedDB.open(K.INDEXEDDB.NAME,K.INDEXEDDB.VERSION);t.onerror=()=>{console.error("IndexedDB initialization failed:",t.error),s(t.error)},t.onupgradeneeded=o=>{const d=o.target.result;if(!d.objectStoreNames.contains(K.INDEXEDDB.STORES.MONTHLY_DATA)){const m=d.createObjectStore(K.INDEXEDDB.STORES.MONTHLY_DATA,{keyPath:"id"});m.createIndex("pageId","pageId",{unique:!1}),m.createIndex("period",["year","month"],{unique:!1}),m.createIndex("pagePeriod",["pageId","year","month"],{unique:!0}),console.log("Created monthlyData store with indexes")}d.objectStoreNames.contains(K.INDEXEDDB.STORES.TIMESERIES)||(d.createObjectStore(K.INDEXEDDB.STORES.TIMESERIES,{keyPath:"pageId"}).createIndex("pageName","pageName",{unique:!1}),console.log("Created timeseries store"))},t.onsuccess=()=>{i(t.result)}})}async function gs(i,s){if(!i||!s)throw new Error("year och month krävs");try{const t=await He();return new Promise((o,d)=>{const S=t.transaction([K.INDEXEDDB.STORES.MONTHLY_DATA],"readonly").objectStore(K.INDEXEDDB.STORES.MONTHLY_DATA).index("period").getAll([i,s]);S.onsuccess=()=>{const j=S.result.sort((k,b)=>k.pageName.localeCompare(b.pageName));o(j)},S.onerror=()=>{d(S.error)}})}catch(t){throw console.error("Error getting period data:",t),t}}async function hs(){try{const i=await He();return new Promise((s,t)=>{const m=i.transaction([K.INDEXEDDB.STORES.MONTHLY_DATA],"readonly").objectStore(K.INDEXEDDB.STORES.MONTHLY_DATA).getAll();m.onsuccess=()=>{const N=new Set;for(const S of m.result)N.add(`${S.year}_${S.month}`);const P=Array.from(N).map(S=>{const[j,k]=S.split("_");return{year:parseInt(j),month:parseInt(k)}}).sort((S,j)=>S.year!==j.year?S.year-j.year:S.month-j.month);s(P)},m.onerror=()=>{t(m.error)}})}catch(i){throw console.error("Error getting all periods:",i),i}}async function xs(){try{for(const s of Object.values(K.LOCALSTORAGE_KEYS))localStorage.removeItem(s);const i=await He();return new Promise((s,t)=>{const o=i.transaction([K.INDEXEDDB.STORES.MONTHLY_DATA,K.INDEXEDDB.STORES.TIMESERIES],"readwrite");let d=0;const m=2,P=o.objectStore(K.INDEXEDDB.STORES.MONTHLY_DATA).clear();P.onsuccess=()=>{d++,d===m&&(console.log("All data cleared successfully"),s(!0))};const j=o.objectStore(K.INDEXEDDB.STORES.TIMESERIES).clear();j.onsuccess=()=>{d++,d===m&&(console.log("All data cleared successfully"),s(!0))},o.onerror=()=>{t(o.error)}})}catch(i){throw console.error("Error clearing data:",i),i}}function fs(){const[i,s]=h.useState(!1),[t,o]=h.useState(!1),[d,m]=h.useState("upload"),[N,P]=h.useState([]),[S,j]=h.useState(!0),[k,b]=h.useState(!1);h.useEffect(()=>{B()},[]);const B=async()=>{try{j(!0),console.log("Laddar befintlig data från storage...");const E=await hs();if(console.log("Hittade perioder i storage:",E),E.length>0){const A=await Promise.all(E.map(async D=>{const U=(await gs(D.year,D.month)).map(T=>({Page:T.pageName,"Page ID":T.pageId,Reach:T.metrics.reach||0,"Engaged Users":T.metrics.engagedUsers||0,Engagements:T.metrics.engagements||0,Reactions:T.metrics.reactions||0,Publications:T.metrics.publications||0,Status:T.metrics.status||0,Comment:T.metrics.comment||0}));return{year:D.year,month:D.month,data:U,filename:`FB_${D.year}_${String(D.month).padStart(2,"0")}.csv`}}));console.log("Konverterade periodsWithData:",A),P(A),s(!0),m("monthly")}else console.log("Ingen befintlig data hittades")}catch(E){console.error("Kunde inte ladda befintlig data:",E)}finally{j(!1)}},F=async E=>{console.log("Data uploaded successfully:",E);const A=Array.isArray(E)?E:[],D=[...N];A.forEach(M=>{D.some(T=>T.year===M.year&&T.month===M.month)?console.log(`Period ${M.year}-${M.month} finns redan, hoppar över dubblett`):D.push(M)}),console.log("Merged periods:",D),P(D),s(!0),o(!1),m("monthly")},$=async()=>{if(window.confirm("Är du säker på att du vill rensa all data? Detta kan inte ångras."))try{b(!0),console.log("Rensar all data..."),await xs(),P([]),s(!1),m("upload"),console.log("✅ All data rensad framgångsrikt")}catch(E){console.error("❌ Fel vid rensning av data:",E),alert(`Fel vid rensning av data: ${E.message}`)}finally{b(!1)}},C=()=>{o(!1)};return S?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(me,{className:"h-12 w-12 mx-auto mb-4 text-primary animate-pulse"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Facebook API data analyser"}),e.jsx("p",{className:"text-muted-foreground",children:"Laddar befintlig data..."})]})}):t?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"border-b border-border",children:e.jsx("div",{className:"container py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"facebook-brand flex items-center gap-3",children:[e.jsx(me,{className:"h-8 w-8"}),e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Facebook API data analyser"})]}),e.jsxs(L,{variant:"outline",onClick:C,children:[e.jsx(Oa,{className:"mr-2 h-4 w-4"}),"Tillbaka"]})]})})}),e.jsx("main",{className:"container py-6",children:e.jsx(Wa,{onDataUploaded:F,onCancel:C})})]}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"border-b border-border",children:e.jsx("div",{className:"container py-4",children:e.jsxs("div",{className:"facebook-brand flex items-center gap-3",children:[e.jsx(me,{className:"h-8 w-8"}),e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Facebook API data analyser"})]})})}),e.jsx("main",{className:"container py-6",children:e.jsx("div",{className:"space-y-6",children:i?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Analysera Facebook-data"}),e.jsxs("p",{className:"text-muted-foreground",children:[N.length," period",N.length!==1?"er":""," tillgänglig",N.length!==1?"a":""]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(L,{variant:"outline",onClick:()=>o(!0),children:[e.jsx(Ie,{className:"mr-2 h-4 w-4"}),"Ladda upp mer data"]}),e.jsx(L,{variant:"destructive",onClick:$,disabled:k,children:k?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mr-2 h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"}),"Rensar..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Fa,{className:"mr-2 h-4 w-4"}),"Rensa data"]})})]})]}),e.jsxs(Ha,{value:d,onValueChange:m,className:"space-y-4",children:[e.jsxs(ja,{className:"grid w-full grid-cols-4",children:[e.jsxs(Ne,{value:"upload",className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"h-4 w-4"}),"Info"]}),e.jsxs(Ne,{value:"monthly",className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-4 w-4"}),"Månadsanalys"]}),e.jsxs(Ne,{value:"pages",className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-4 w-4"}),"Sidor över tid"]}),e.jsxs(Ne,{value:"trends",className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-4 w-4"}),"Trendanalys"]})]}),e.jsx(be,{value:"upload",className:"mt-6",children:e.jsxs(X,{children:[e.jsx(ie,{children:e.jsxs(oe,{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"h-5 w-5"}),"Dataöversikt"]})}),e.jsxs(ce,{className:"space-y-4",children:[e.jsxs(ne,{children:[e.jsx(Fe,{className:"h-4 w-4"}),e.jsx(re,{children:"Data laddad och redo"}),e.jsxs(le,{children:["Du har ",N.length," period",N.length!==1?"er":""," av Facebook-data tillgänglig för analys. Använd flikarna ovan för att utforska dina data eller ladda upp mer data."]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[e.jsx(pe,{className:"w-8 h-8 mx-auto mb-2 text-blue-600"}),e.jsx("div",{className:"font-bold text-2xl text-blue-900",children:N.length}),e.jsx("div",{className:"text-sm text-blue-700",children:"Månader data"})]}),e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[e.jsx(me,{className:"w-8 h-8 mx-auto mb-2 text-green-600"}),e.jsx("div",{className:"font-bold text-2xl text-green-900",children:N.reduce((E,A)=>{var D;return E+(((D=A.data)==null?void 0:D.length)||0)},0)}),e.jsx("div",{className:"text-sm text-green-700",children:"Totalt dataposter"})]}),e.jsxs("div",{className:"text-center p-4 bg-purple-50 rounded-lg",children:[e.jsx(ve,{className:"w-8 h-8 mx-auto mb-2 text-purple-600"}),e.jsx("div",{className:"font-bold text-2xl text-purple-900",children:[...new Set(N.flatMap(E=>{var A;return((A=E.data)==null?void 0:A.map(D=>D.Page||D.page))||[]}))].length}),e.jsx("div",{className:"text-sm text-purple-700",children:"Unika Facebook-sidor"})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Data sparas automatiskt i webbläsaren och kommer att finnas kvar när du laddar om sidan."}),e.jsxs(L,{onClick:()=>o(!0),children:[e.jsx(Ie,{className:"mr-2 h-4 w-4"}),"Ladda upp mer data"]})]})]})}),e.jsx(be,{value:"monthly",className:"mt-6",children:e.jsx(ts,{uploadedPeriods:N})}),e.jsx(be,{value:"pages",className:"mt-6",children:e.jsx(Qa,{uploadedPeriods:N})}),e.jsx(be,{value:"trends",className:"mt-6",children:e.jsx(us,{uploadedPeriods:N})})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ie,{className:"mx-auto h-24 w-24 text-muted-foreground mb-6"}),e.jsx("h2",{className:"text-3xl font-bold tracking-tight mb-4",children:"Välkommen till Facebook API data analyser"}),e.jsx("p",{className:"text-xl text-muted-foreground mb-8 max-w-2xl mx-auto",children:"Analysera och visualisera dina Facebook-sidor över tid. Ladda upp månadsdata för att komma igång med tidserie-analys."}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6 max-w-4xl mx-auto mb-12",children:[e.jsxs(X,{className:"text-center p-6",children:[e.jsx(pe,{className:"mx-auto h-12 w-12 text-primary mb-4"}),e.jsx("h3",{className:"font-semibold mb-2",children:"Månadsanalys"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Jämför prestanda mellan Facebook-sidor för specifika månader"})]}),e.jsxs(X,{className:"text-center p-6",children:[e.jsx(ve,{className:"mx-auto h-12 w-12 text-primary mb-4"}),e.jsx("h3",{className:"font-semibold mb-2",children:"Tidserie-analys"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Följ utvecklingen av enskilda sidor över tid"})]}),e.jsxs(X,{className:"text-center p-6",children:[e.jsx(me,{className:"mx-auto h-12 w-12 text-primary mb-4"}),e.jsx("h3",{className:"font-semibold mb-2",children:"Trend-upptäckt"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Upptäck mönster och trender i dina Facebook-data"})]})]}),e.jsxs(L,{onClick:()=>o(!0),size:"lg",children:[e.jsx(Ie,{className:"mr-2 h-5 w-5"}),"Ladda upp Facebook API data"]})]})})}),e.jsx("footer",{className:"border-t border-border mt-12",children:e.jsxs("div",{className:"container py-4 text-center text-sm text-muted-foreground",children:[e.jsxs("p",{children:["Facebook API data analyser © ",new Date().getFullYear()]}),e.jsxs("p",{className:"mt-1",children:["Tidserie-baserad analys av månadsstatistik |",e.jsx("span",{className:"text-facebook-500 font-medium",children:" Utvecklad för projektfas 1-8"})]})]})})]})}Ue.createRoot(document.getElementById("root")).render(e.jsx(Va.StrictMode,{children:e.jsx(fs,{})}));
//# sourceMappingURL=index-Ck92OpX_.js.map
