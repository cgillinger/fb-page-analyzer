import{j as e,S as Ns,L as ts,T as as,C as ns,R as bs,U as Xe,A as ue,F as vs,a as xe,b as We,c as Ss,X as ks,B as ce,d as rs,I as ws,e as As,P as Es,f as is,V as Ps,g as ls,h as os,i as Cs,k as Ds,l as Ts,m as cs,n as Is,o as Ms,p as Fe,q as ve,r as Rs,s as ds,t as ms,u as us,v as gs,w as hs,x as xs,y as qe,z as $s,D as Te,E as _s,G as _e}from"./ui-DvaxdRLu.js";import{b as Os,r as h,R as Ls}from"./vendor-DB9HQzDI.js";import{t as Fs,c as fs,P as Vs}from"./utils-GaJ1HoMq.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))c(d);new MutationObserver(d=>{for(const u of d)if(u.type==="childList")for(const b of u.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&c(b)}).observe(document,{childList:!0,subtree:!0});function a(d){const u={};return d.integrity&&(u.integrity=d.integrity),d.referrerPolicy&&(u.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?u.credentials="include":d.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function c(d){if(d.ep)return;d.ep=!0;const u=a(d);fetch(d.href,u)}})();var Ve={},Ge=Os;Ve.createRoot=Ge.createRoot,Ve.hydrateRoot=Ge.hydrateRoot;function M(...r){return Fs(fs(r))}const H=h.forwardRef(({className:r,...s},a)=>e.jsx("div",{ref:a,className:M("rounded-lg border bg-card text-card-foreground shadow-sm",r),...s}));H.displayName="Card";const ae=h.forwardRef(({className:r,...s},a)=>e.jsx("div",{ref:a,className:M("flex flex-col space-y-1.5 p-6",r),...s}));ae.displayName="CardHeader";const ne=h.forwardRef(({className:r,...s},a)=>e.jsx("h3",{ref:a,className:M("text-2xl font-semibold leading-none tracking-tight",r),...s}));ne.displayName="CardTitle";const Bs=h.forwardRef(({className:r,...s},a)=>e.jsx("p",{ref:a,className:M("text-sm text-muted-foreground",r),...s}));Bs.displayName="CardDescription";const re=h.forwardRef(({className:r,...s},a)=>e.jsx("div",{ref:a,className:M("p-6 pt-0",r),...s}));re.displayName="CardContent";const Us=h.forwardRef(({className:r,...s},a)=>e.jsx("div",{ref:a,className:M("flex items-center p-6 pt-0",r),...s}));Us.displayName="CardFooter";const Je=r=>typeof r=="boolean"?`${r}`:r===0?"0":r,Ze=fs,ps=(r,s)=>a=>{var c;if((s==null?void 0:s.variants)==null)return Ze(r,a==null?void 0:a.class,a==null?void 0:a.className);const{variants:d,defaultVariants:u}=s,b=Object.keys(d).map(N=>{const w=a==null?void 0:a[N],v=u==null?void 0:u[N];if(w===null)return null;const B=Je(w)||Je(v);return d[N][B]}),C=a&&Object.entries(a).reduce((N,w)=>{let[v,B]=w;return B===void 0||(N[v]=B),N},{}),k=s==null||(c=s.compoundVariants)===null||c===void 0?void 0:c.reduce((N,w)=>{let{class:v,className:B,...F}=w;return Object.entries(F).every(L=>{let[D,T]=L;return Array.isArray(T)?T.includes({...u,...C}[D]):{...u,...C}[D]===T})?[...N,v,B]:N},[]);return Ze(r,b,k,a==null?void 0:a.class,a==null?void 0:a.className)},zs=ps("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"underline-offset-4 hover:underline text-primary",facebook:"bg-facebook-500 text-white hover:bg-facebook-600"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),V=h.forwardRef(({className:r,variant:s,size:a,asChild:c=!1,...d},u)=>{const b=c?Ns:"button";return e.jsx(b,{className:M(zs({variant:s,size:a,className:r})),ref:u,...d})});V.displayName="Button";const Ks=bs,js=h.forwardRef(({className:r,...s},a)=>e.jsx(ts,{ref:a,className:M("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",r),...s}));js.displayName=ts.displayName;const Ne=h.forwardRef(({className:r,...s},a)=>e.jsx(as,{ref:a,className:M("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",r),...s}));Ne.displayName=as.displayName;const be=h.forwardRef(({className:r,...s},a)=>e.jsx(ns,{ref:a,className:M("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...s}));be.displayName=ns.displayName;const Ys=ps("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive",success:"border-green-500/50 text-green-600 dark:text-green-400 [&>svg]:text-green-600",info:"border-facebook-300/50 text-facebook-600 dark:text-facebook-400 [&>svg]:text-facebook-600"}},defaultVariants:{variant:"default"}}),ee=h.forwardRef(({className:r,variant:s,...a},c)=>e.jsx("div",{ref:c,role:"alert",className:M(Ys({variant:s}),r),...a}));ee.displayName="Alert";const se=h.forwardRef(({className:r,...s},a)=>e.jsx("h5",{ref:a,className:M("mb-1 font-medium leading-none tracking-tight",r),...s}));se.displayName="AlertTitle";const te=h.forwardRef(({className:r,...s},a)=>e.jsx("div",{ref:a,className:M("text-sm [&_p]:leading-relaxed",r),...s}));te.displayName="AlertDescription";const Qe=["Page","Page ID","Reach","Engaged Users","Engagements","Reactions","Publications","Status","Comment"];function Hs({onDataUploaded:r,onCancel:s}){const[a,c]=h.useState([]),[d,u]=h.useState(!1),[b,C]=h.useState(!1),[k,N]=h.useState([]),[w,v]=h.useState({}),B=h.useRef(null),F=j=>{const S=/^FB_(\d{4})_(\d{2})\.csv$/,y=j.match(S);if(!y)return{isValid:!1,error:"Felaktigt filnamnsformat. F√∂rv√§ntat: FB_YYYY_MM.csv (t.ex. FB_2025_08.csv)"};const o=parseInt(y[1]),x=parseInt(y[2]);return x<1||x>12?{isValid:!1,error:"Ogiltig m√•nad. M√•ste vara mellan 01-12."}:o<2020||o>2030?{isValid:!1,error:"Ogiltigt √•r. M√•ste vara mellan 2020-2030."}:{isValid:!0,year:o,month:x,displayName:`${L(x)} ${o}`}},L=j=>["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"][j-1],D=(j,S)=>new Promise(y=>{Vs.parse(j,{header:!0,skipEmptyLines:!0,complete:o=>{if(o.errors.length>0){y({isValid:!1,error:`CSV-parsningsfel: ${o.errors[0].message}`,data:null});return}const x=o.meta.fields||[],p=Qe.filter(n=>!x.includes(n));if(p.length>0){y({isValid:!1,error:`Saknade kolumner: ${p.join(", ")}`,data:null});return}if(o.data.length===0){y({isValid:!1,error:"CSV-filen inneh√•ller ingen data",data:null});return}y({isValid:!0,data:o.data,pageCount:o.data.length,error:null})}})}),T=j=>{j.preventDefault(),j.stopPropagation(),C(!1);const S=Array.from(j.dataTransfer.files),y=S.filter(o=>o.name.toLowerCase().endsWith(".csv"));y.length!==S.length&&N(o=>[...o,"Endast CSV-filer √§r till√•tna"]),y.length>0&&P(y)},E=j=>{const S=Array.from(j.target.files);P(S)},P=j=>{const S=j.map(p=>{const n=F(p.name);return{file:p,id:Math.random().toString(36),name:p.name,size:p.size,validation:n,status:n.isValid?"pending":"error"}}),y=a.map(p=>p.name),o=S.filter(p=>y.includes(p.name));o.length>0&&N(p=>[...p,`F√∂ljande filer √§r redan valda: ${o.map(n=>n.name).join(", ")}`]);const x=S.filter(p=>!y.includes(p.name));c(p=>[...p,...x])},$=j=>{c(S=>S.filter(y=>y.id!==j))},U=async()=>{u(!0),N([]),v({});const j=a.filter(y=>y.validation.isValid),S=[];for(const y of j){v(o=>({...o,[y.id]:"processing"}));try{const o=await I(y.file),x=await D(o,y.name);if(!x.isValid){v(n=>({...n,[y.id]:"error"})),N(n=>[...n,`${y.name}: ${x.error}`]);continue}const p={...y.validation,data:x.data,pageCount:x.pageCount,filename:y.name};S.push(p),v(n=>({...n,[y.id]:"success"})),await new Promise(n=>setTimeout(n,500))}catch(o){v(x=>({...x,[y.id]:"error"})),N(x=>[...x,`${y.name}: ${o.message}`])}}u(!1),S.length>0&&r(S)},I=j=>new Promise((S,y)=>{const o=new FileReader;o.onload=x=>S(x.target.result),o.onerror=()=>y(new Error("Kunde inte l√§sa fil")),o.readAsText(j)}),X=j=>{j.preventDefault(),j.stopPropagation(),C(!0)},W=j=>{j.preventDefault(),j.stopPropagation(),C(!1)},ie=()=>{N([])},K=a.filter(j=>j.validation.isValid).length,Y=K>0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(H,{children:[e.jsxs(ae,{children:[e.jsxs(ne,{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"h-5 w-5 text-facebook-500"}),"Ladda upp Facebook CSV-filer"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Sl√§pp dina FB_YYYY_MM.csv filer h√§r eller klicka f√∂r att v√§lja filer"})]}),e.jsx(re,{children:e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors cursor-pointer ${b?"border-facebook-400 bg-facebook-50":"border-gray-300 hover:border-facebook-400 hover:bg-facebook-50"}`,onDrop:T,onDragOver:X,onDragLeave:W,onClick:()=>{var j;return(j=B.current)==null?void 0:j.click()},children:[e.jsx("input",{type:"file",ref:B,onChange:E,multiple:!0,accept:".csv",className:"hidden"}),e.jsx(Xe,{className:"h-12 w-12 mx-auto mb-4 text-facebook-400"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:b?"Sl√§pp filerna h√§r":"Ladda upp CSV-filer"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Sl√§pp dina FB_YYYY_MM.csv filer h√§r eller klicka f√∂r att v√§lja"}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Format:"})," FB_YYYY_MM.csv (t.ex. FB_2025_08.csv)"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Kolumner:"})," ",Qe.join(", ")]})]})]})})]}),k.length>0&&e.jsxs(ee,{variant:"destructive",children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsx(se,{children:"Valideringsfel"}),e.jsxs(te,{children:[e.jsx("ul",{className:"list-disc list-inside space-y-1",children:k.map((j,S)=>e.jsx("li",{children:j},S))}),e.jsx(V,{variant:"outline",size:"sm",onClick:ie,className:"mt-2",children:"Rensa fel"})]})]}),a.length>0&&e.jsxs(H,{children:[e.jsx(ae,{children:e.jsxs(ne,{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["Valda filer (",a.length,")"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[K," giltiga filer"]})]})}),e.jsx(re,{children:e.jsx("div",{className:"space-y-2",children:a.map(j=>{const S=w[j.id]||j.status;return e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg border ${j.validation.isValid?"border-green-200 bg-green-50":"border-red-200 bg-red-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(vs,{className:"h-4 w-4"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:j.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:j.validation.isValid?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"h-3 w-3"}),j.validation.displayName]}):e.jsx("span",{className:"text-red-600",children:j.validation.error})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[S==="processing"&&e.jsx(We,{className:"h-4 w-4 animate-spin text-blue-500"}),S==="success"&&e.jsx(Ss,{className:"h-4 w-4 text-green-500"}),S==="error"&&e.jsx(ue,{className:"h-4 w-4 text-red-500"}),e.jsx(V,{variant:"ghost",size:"sm",onClick:()=>$(j.id),disabled:d,children:e.jsx(ks,{className:"h-4 w-4"})})]})]},j.id)})})})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(V,{variant:"outline",onClick:s,disabled:d,children:"Avbryt"}),e.jsxs("div",{className:"flex gap-2",children:[a.length>0&&e.jsx(V,{variant:"outline",onClick:()=>c([]),disabled:d,children:"Rensa alla"}),e.jsx(V,{onClick:U,disabled:!Y||d,className:"min-w-[120px]",children:d?e.jsxs(e.Fragment,{children:[e.jsx(We,{className:"mr-2 h-4 w-4 animate-spin"}),"Bearbetar..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"mr-2 h-4 w-4"}),"Analysera data (",K,")"]})})]})]})]})}const Be=h.forwardRef(({className:r,...s},a)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:a,className:M("w-full caption-bottom text-sm",r),...s})}));Be.displayName="Table";const Ue=h.forwardRef(({className:r,...s},a)=>e.jsx("thead",{ref:a,className:M("[&_tr]:border-b",r),...s}));Ue.displayName="TableHeader";const ze=h.forwardRef(({className:r,...s},a)=>e.jsx("tbody",{ref:a,className:M("[&_tr:last-child]:border-0",r),...s}));ze.displayName="TableBody";const ke=h.forwardRef(({className:r,...s},a)=>e.jsx("tr",{ref:a,className:M("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",r),...s}));ke.displayName="TableRow";const we=h.forwardRef(({className:r,...s},a)=>e.jsx("th",{ref:a,className:M("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",r),...s}));we.displayName="TableHead";const Ae=h.forwardRef(({className:r,...s},a)=>e.jsx("td",{ref:a,className:M("p-4 align-middle [&:has([role=checkbox])]:pr-0",r),...s}));Ae.displayName="TableCell";const Ie=Is,Me=Ms,Ee=h.forwardRef(({className:r,children:s,...a},c)=>e.jsxs(rs,{ref:c,className:M("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),...a,children:[s,e.jsx(ws,{asChild:!0,children:e.jsx(As,{className:"h-4 w-4 opacity-50"})})]}));Ee.displayName=rs.displayName;const Pe=h.forwardRef(({className:r,children:s,position:a="popper",...c},d)=>e.jsx(Es,{children:e.jsx(is,{ref:d,className:M("relative z-50 min-w-[8rem] overflow-hidden rounded-md border bg-white text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",r),position:a,...c,children:e.jsx(Ps,{className:M("p-1 max-h-[300px] overflow-y-auto",a==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s})})}));Pe.displayName=is.displayName;const Xs=h.forwardRef(({className:r,...s},a)=>e.jsx(ls,{ref:a,className:M("py-1.5 pl-8 pr-2 text-sm font-semibold",r),...s}));Xs.displayName=ls.displayName;const Ce=h.forwardRef(({className:r,children:s,...a},c)=>e.jsxs(os,{ref:c,className:M("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Cs,{children:e.jsx(Ds,{className:"h-4 w-4"})})}),e.jsx(Ts,{children:s})]}));Ce.displayName=os.displayName;const Ws=h.forwardRef(({className:r,...s},a)=>e.jsx(cs,{ref:a,className:M("-mx-1 my-1 h-px bg-muted",r),...s}));Ws.displayName=cs.displayName;const Z={P1:"#0066cc",P2:"#ff6600",P3:"#00cc66",P4:"#cc33cc",EKOT:"#005eb8",RADIOSPORTEN:"#1c5c35",SR:"#000000",default:"#000000"},es=({pageName:r})=>{const s=r||"Ok√§nd";let a=Z.default,c="";const d=s.toLowerCase();d.includes("ekot")||d.includes("radio sweden")?(a=Z.EKOT,c="E"):d.includes("radiosporten")||d.includes("radio sporten")?(a=Z.RADIOSPORTEN,c="RS"):d.includes("p1")?(a=Z.P1,c="P1"):d.includes("p2")?(a=Z.P2,c="P2"):d.includes("p3")?(a=Z.P3,c="P3"):d.includes("p4")?(a=Z.P4,c="P4"):d.includes("sveriges radio")&&!d.includes("p1")&&!d.includes("p2")&&!d.includes("p3")&&!d.includes("p4")?(a=Z.SR,c="SR"):c=s.charAt(0).toUpperCase();const b=a===Z.P2||a===Z.P3?"text-black":"text-white";return e.jsx("div",{className:`flex-shrink-0 w-6 h-6 rounded-sm flex items-center justify-center text-xs font-bold ${b}`,style:{backgroundColor:a},title:r,children:c})},qs=[{value:6,label:"6 per sida"},{value:12,label:"12 per sida"},{value:24,label:"24 per sida"}],Gs=[{key:"reach",label:"R√§ckvidd",canSum:!1},{key:"engagements",label:"Engagemang",canSum:!0},{key:"reactions",label:"Reaktioner",canSum:!0},{key:"publications",label:"Publiceringar",canSum:!0},{key:"status",label:"Status",canSum:!0},{key:"comment",label:"Kommentarer",canSum:!0}],Oe={reach:{displayName:"R√§ckvidd",canSumAcrossPages:!1,category:"unique_persons"},engagements:{displayName:"Engagemang",canSumAcrossPages:!0,category:"countable"},reactions:{displayName:"Reaktioner",canSumAcrossPages:!0,category:"countable"},publications:{displayName:"Publiceringar",canSumAcrossPages:!0,category:"countable"},status:{displayName:"Status",canSumAcrossPages:!0,category:"countable"},comment:{displayName:"Kommentarer",canSumAcrossPages:!0,category:"countable"}};function Js({uploadedPeriods:r=[]}){const[s,a]=h.useState([]),[c,d]=h.useState(""),[u,b]=h.useState([]),[C,k]=h.useState(!0),[N,w]=h.useState(null),[v,B]=h.useState(null),[F,L]=h.useState({}),[D,T]=h.useState({key:"year_month",direction:"desc"}),[E,P]=h.useState(1),[$,U]=h.useState(12),[I,X]=h.useState(["reach","engagements","publications"]);h.useEffect(()=>{(()=>{try{if(k(!0),r.length===0){a([]),k(!1);return}const l=new Map;r.forEach(g=>{g.data&&Array.isArray(g.data)&&g.data.forEach(f=>{const A=f.Page||f.page||"Ok√§nd sida",_=f["Page ID"]||f.pageId||`page_${A.replace(/\s+/g,"_")}`;l.has(_)||l.set(_,{pageId:_,pageName:A})})});const m=Array.from(l.values()).sort((g,f)=>g.pageName.localeCompare(f.pageName));a(m),m.length>0&&d(m[0].pageId)}catch(l){console.error("Error loading pages:",l),w("Kunde inte ladda tillg√§ngliga Facebook-sidor")}finally{k(!1)}})()},[r]),h.useEffect(()=>{if(!c||r.length===0)return;(()=>{try{k(!0),w(null);const l=[];if(r.forEach(g=>{if(g.data&&Array.isArray(g.data)){const f=g.data.find(A=>(A["Page ID"]||A.pageId||`page_${(A.Page||A.page||"").replace(/\s+/g,"_")}`)===c);f&&l.push({year:g.year,month:g.month,pageName:f.Page||f.page||"Ok√§nd sida",pageId:c,metrics:{reach:W(f.Reach||f.reach),engagements:W(f.Engagements||f.engagements),reactions:W(f.Reactions||f.reactions),publications:W(f.Publications||f.publications),status:W(f.Status||f.status),comment:W(f.Comment||f.comment)}})}}),l.length===0){const g=s.find(f=>f.pageId===c);w(`Ingen tidserie-data hittades f√∂r ${(g==null?void 0:g.pageName)||"vald sida"}`);return}const m=l.sort((g,f)=>g.year!==f.year?f.year-g.year:f.month-g.month);b(m),ie(m)}catch(l){console.error("Error loading page timeseries:",l);const m=s.find(g=>g.pageId===c);w(`Kunde inte ladda data f√∂r ${(m==null?void 0:m.pageName)||"vald sida"}`)}finally{k(!1)}})()},[c,r,s]);const W=t=>{if(t==null||t==="")return 0;const l=parseFloat(String(t).replace(/[,\s]/g,""));return isNaN(l)?0:l},ie=t=>{var A,_,R;if(t.length===0)return;const l=s.find(O=>O.pageId===c),m={pageName:(l==null?void 0:l.pageName)||((A=t[0])==null?void 0:A.pageName)||"Ok√§nd sida",totalPeriods:t.length,firstPeriod:t[t.length-1],lastPeriod:t[0],metrics:{}},g=["reach","engagements","reactions","publications"];for(const O of g){const q=t.map(le=>le.metrics[O]).filter(le=>le!=null&&!isNaN(le));if(q.length>0){const le=q.reduce((me,pe)=>me+pe,0)/q.length,G=Math.min(...q),de=Math.max(...q),J=t.find(me=>me.metrics[O]===de),fe=t.find(me=>me.metrics[O]===G);m.metrics[O]={average:Math.round(le),min:G,max:de,bestMonth:J?{year:J.year,month:J.month,value:de}:null,worstMonth:fe?{year:fe.year,month:fe.month,value:G}:null}}}B(m);const f={};for(const O of I)if(t.length>=2){const q=((_=t[t.length-1])==null?void 0:_.metrics[O])||0,G=(((R=t[0])==null?void 0:R.metrics[O])||0)-q,de=q>0?G/q*100:0;f[O]={change:G,percentChange:Math.round(de*10)/10,trend:G>0?"up":G<0?"down":"stable"}}L(f)},K=t=>["Jan","Feb","Mar","Apr","Maj","Jun","Jul","Aug","Sep","Okt","Nov","Dec"][t-1],Y=h.useMemo(()=>u.length?[...u].sort((t,l)=>{let m,g;D.key==="year_month"?(m=t.year*100+t.month,g=l.year*100+l.month):(m=t.metrics[D.key]||0,g=l.metrics[D.key]||0);const f=m-g;return D.direction==="asc"?f:-f}):[],[u,D]),j=h.useMemo(()=>{const t=(E-1)*$;return Y.slice(t,t+$)},[Y,E,$]),S=Math.ceil(Y.length/$),y=t=>{T(l=>({key:t,direction:l.key===t&&l.direction==="asc"?"desc":"asc"}))},o=t=>D.key!==t?e.jsx(gs,{className:"h-4 w-4 ml-1 opacity-50"}):D.direction==="asc"?e.jsx(hs,{className:"h-4 w-4 ml-1"}):e.jsx(xs,{className:"h-4 w-4 ml-1"}),x=t=>{X(l=>l.includes(t)?l.filter(m=>m!==t):[...l,t])},p=()=>{const t=s.find(R=>R.pageId===c),l=["√Ör","M√•nad","Period",...I.map(R=>{const O=Oe[R];return O?O.displayName:R})],m=Y.map(R=>[R.year,R.month,`${K(R.month)} ${R.year}`,...I.map(O=>R.metrics[O]||0)]),g=[l.join(","),...m.map(R=>R.join(","))].join(`
`),f=new Blob([g],{type:"text/csv;charset=utf-8;"}),A=document.createElement("a"),_=URL.createObjectURL(f);A.setAttribute("href",_),A.setAttribute("download",`${t==null?void 0:t.pageName.replace(/[^a-zA-Z0-9]/g,"_")}_tidsserie.csv`),A.style.visibility="hidden",document.body.appendChild(A),A.click(),document.body.removeChild(A)},n=t=>t==null||isNaN(t)?"-":new Intl.NumberFormat("sv-SE").format(t);if(C)return e.jsxs(ee,{children:[e.jsx(Fe,{className:"h-4 w-4"}),e.jsx(se,{children:"Laddar data"}),e.jsx(te,{children:"Analyserar tidserie-data f√∂r Facebook-sidor..."})]});if(N)return e.jsxs(ee,{variant:"destructive",children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsx(se,{children:"Fel"}),e.jsx(te,{children:N})]});if(s.length===0)return e.jsxs(ee,{children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsx(se,{children:"Inga sidor hittades"}),e.jsx(te,{children:"Kunde inte hitta n√•gra Facebook-sidor i den uppladdade datan."})]});const i=s.find(t=>t.pageId===c);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(H,{children:[e.jsx(ae,{children:e.jsxs(ne,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-5 w-5 text-facebook-500"}),"Sidanalys √∂ver tid"]})}),e.jsxs(re,{children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"V√§lj Facebook-sida"}),e.jsxs(Ie,{value:c,onValueChange:d,children:[e.jsx(Ee,{children:e.jsx(Me,{placeholder:"V√§lj sida att analysera"})}),e.jsx(Pe,{children:s.map(t=>e.jsx(Ce,{value:t.pageId,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(es,{pageName:t.pageName}),e.jsx("span",{children:t.pageName})]})},t.pageId))})]}),i&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["ID: ",i.pageId]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Metrics att visa"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:Gs.map(t=>{const l=I.includes(t.key);return e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:()=>x(t.key),className:"h-4 w-4 text-facebook-500 border-gray-300 rounded focus:ring-facebook-500"}),e.jsx("span",{className:"text-sm font-medium",children:t.label}),!t.canSum&&e.jsx("span",{className:"text-xs text-orange-600 font-medium",children:"*"})]},t.key)})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"* = Kan inte summeras √∂ver m√•nader (unika personer)"})]})]}),v&&e.jsxs("div",{className:"grid md:grid-cols-4 gap-4 mb-6 p-4 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-facebook-600 flex items-center justify-center gap-2",children:[e.jsx(es,{pageName:v.pageName}),v.totalPeriods]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"M√•nader data"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-semibold",children:[K(v.firstPeriod.month)," ",v.firstPeriod.year]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"F√∂rsta m√•nad"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-semibold",children:[K(v.lastPeriod.month)," ",v.lastPeriod.year]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Senaste m√•nad"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-facebook-600",children:(i==null?void 0:i.pageName)||"Ok√§nd sida"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Vald sida"})]})]}),Object.keys(F).length>0&&e.jsx("div",{className:"grid md:grid-cols-3 gap-4 mb-6",children:I.slice(0,3).map(t=>{const l=F[t],m=Oe[t];return!l||!m?null:e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white border rounded-lg",children:[l.trend==="up"&&e.jsx(ve,{className:"h-5 w-5 text-green-600"}),l.trend==="down"&&e.jsx(Rs,{className:"h-5 w-5 text-red-600"}),l.trend==="stable"&&e.jsx(Fe,{className:"h-5 w-5 text-gray-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm",children:m.displayName}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[l.percentChange>0?"+":"",l.percentChange,"% sedan f√∂rsta m√•nad"]})]})]},t)})})]})]}),e.jsxs(H,{children:[e.jsxs(ae,{className:"flex flex-row items-center justify-between",children:[e.jsxs(ne,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-5 w-5"}),"M√•nadsvis utveckling - ",(i==null?void 0:i.pageName)||"Ok√§nd sida"]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(V,{onClick:p,variant:"outline",size:"sm",children:[e.jsx(ds,{className:"h-4 w-4 mr-2"}),"CSV"]})})]}),e.jsxs(re,{children:[u.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Ingen tidserie-data tillg√§nglig f√∂r vald sida"}):e.jsxs(e.Fragment,{children:[e.jsxs(Be,{children:[e.jsx(Ue,{children:e.jsxs(ke,{children:[e.jsx(we,{className:"cursor-pointer select-none",onClick:()=>y("year_month"),children:e.jsxs("div",{className:"flex items-center",children:["Period",o("year_month")]})}),I.map(t=>{const l=Oe[t];return e.jsx(we,{className:"text-right cursor-pointer select-none",onClick:()=>y(t),children:e.jsxs("div",{className:"flex items-center justify-end",children:[(l==null?void 0:l.displayName)||t,o(t),!(l!=null&&l.canSumAcrossPages)&&e.jsx("span",{className:"ml-1 text-orange-600",children:"*"})]})},t)})]})}),e.jsx(ze,{children:j.map((t,l)=>e.jsxs(ke,{children:[e.jsxs(Ae,{className:"font-medium",children:[K(t.month)," ",t.year]}),I.map(m=>{var g,f;return e.jsx(Ae,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[n(t.metrics[m]),((g=v==null?void 0:v.metrics[m])==null?void 0:g.bestMonth)&&v.metrics[m].bestMonth.year===t.year&&v.metrics[m].bestMonth.month===t.month&&e.jsx("span",{className:"text-yellow-600",title:"B√§sta v√§rde f√∂r denna sida",children:"üèÜ"}),((f=v==null?void 0:v.metrics[m])==null?void 0:f.worstMonth)&&v.metrics[m].worstMonth.year===t.year&&v.metrics[m].worstMonth.month===t.month&&e.jsx("span",{className:"text-gray-500",title:"S√§msta v√§rde f√∂r denna sida",children:"üìâ"})]})},m)})]},`${t.year}_${t.month}`))})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Visa:"}),e.jsxs(Ie,{value:$.toString(),onValueChange:t=>{U(Number(t)),P(1)},children:[e.jsx(Ee,{className:"w-[120px]",children:e.jsx(Me,{})}),e.jsx(Pe,{children:qs.map(t=>e.jsx(Ce,{value:t.value.toString(),children:t.label},t.value))})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Visar ",(E-1)*$+1," till ",Math.min(E*$,Y.length)," av ",Y.length]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{variant:"outline",size:"sm",onClick:()=>P(t=>Math.max(1,t-1)),disabled:E===1,children:e.jsx(ms,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-sm",children:["Sida ",E," av ",S]}),e.jsx(V,{variant:"outline",size:"sm",onClick:()=>P(t=>Math.min(S,t+1)),disabled:E>=S,children:e.jsx(us,{className:"h-4 w-4"})})]})]})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-muted/30 rounded-lg",children:e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"üèÜ = B√§sta v√§rde f√∂r denna sida"}),e.jsx("span",{className:"mx-4",children:"üìâ = S√§msta v√§rde f√∂r denna sida"})]}),e.jsx("div",{className:"text-muted-foreground text-xs",children:"Gr√∂na v√§rden = b√§sta prestanda, r√∂da v√§rden = s√§msta prestanda f√∂r vald tidsperiod"})]})})]})]})]})}const Q={P1:"#0066cc",P2:"#ff6600",P3:"#00cc66",P4:"#cc33cc",EKOT:"#005eb8",RADIOSPORTEN:"#1c5c35",SR:"#000000",default:"#000000"},Zs=({pageName:r})=>{const s=r||"Ok√§nd";let a=Q.default,c="";const d=s.toLowerCase();d.includes("ekot")||d.includes("radio sweden")?(a=Q.EKOT,c="E"):d.includes("radiosporten")||d.includes("radio sporten")?(a=Q.RADIOSPORTEN,c="RS"):d.includes("p1")?(a=Q.P1,c="P1"):d.includes("p2")?(a=Q.P2,c="P2"):d.includes("p3")?(a=Q.P3,c="P3"):d.includes("p4")?(a=Q.P4,c="P4"):d.includes("sveriges radio")&&!d.includes("p1")&&!d.includes("p2")&&!d.includes("p3")&&!d.includes("p4")?(a=Q.SR,c="SR"):c=s.charAt(0).toUpperCase();const b=a===Q.P2||a===Q.P3?"text-black":"text-white";return e.jsx("div",{className:`flex-shrink-0 w-6 h-6 rounded-sm flex items-center justify-center text-xs font-bold ${b}`,style:{backgroundColor:a},title:r,children:c})},Qs=[{value:10,label:"10 per sida"},{value:25,label:"25 per sida"},{value:50,label:"50 per sida"}],et=[{key:"reach",label:"R√§ckvidd",canSum:!1},{key:"engagements",label:"Engagemang",canSum:!0},{key:"reactions",label:"Reaktioner",canSum:!0},{key:"publications",label:"Publiceringar",canSum:!0}],he={reach:{displayName:"R√§ckvidd",canSumAcrossPages:!1,category:"unique_persons"},engagements:{displayName:"Engagemang",canSumAcrossPages:!0,category:"countable"},reactions:{displayName:"Reaktioner",canSumAcrossPages:!0,category:"countable"},publications:{displayName:"Publiceringar",canSumAcrossPages:!0,category:"countable"}};function st({uploadedPeriods:r=[]}){const[s,a]=h.useState(null),[c,d]=h.useState([]),[u,b]=h.useState(null),[C,k]=h.useState(!1),[N,w]=h.useState(null),[v,B]=h.useState({key:"pageName",direction:"asc"}),[F,L]=h.useState(1),[D,T]=h.useState(25),[E,P]=h.useState(["reach","engagements","publications"]);h.useEffect(()=>{if(r.length>0&&!s){const o=r[0];a({year:o.year,month:o.month})}},[r,s]),h.useEffect(()=>{if(!s)return;(()=>{try{k(!0),w(null);const x=r.find(i=>i.year===s.year&&i.month===s.month);if(!x){w(`Ingen data hittades f√∂r ${U(s.month)} ${s.year}`),d([]),b(null);return}const p=x.data.map(i=>({page:{pageName:i.Page||i.page||"Ok√§nd sida",pageId:i["Page ID"]||i.pageId||"unknown"},period:{year:s.year,month:s.month},metrics:{reach:$(i.Reach||i.reach),engagements:$(i.Engagements||i.engagements),reactions:$(i.Reactions||i.reactions),publications:$(i.Publications||i.publications)}}));d(p);const n=I(p,s.year,s.month);b(n)}catch(x){console.error("Error loading period data:",x),w(`Kunde inte ladda data f√∂r ${U(s.month)} ${s.year}`)}finally{k(!1)}})()},[s,r]);const $=o=>{if(o==null||o==="")return 0;const x=parseFloat(String(o).replace(/[,\s]/g,""));return isNaN(x)?0:x},U=o=>["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"][o-1],I=(o,x,p)=>{if(!o.length)return null;const n={period:{year:x,month:p},totalPages:o.length,metrics:{}},i=["reach","engagements","reactions","publications"];for(const t of i){const l=o.map(g=>g.metrics[t]).filter(g=>g!=null&&!isNaN(g)&&g>=0);if(l.length===0){n.metrics[t]={total:0,average:0,min:0,max:0,validPages:0,type:he[t].category};continue}if(!he[t].canSumAcrossPages)n.metrics[t]={average:Math.round(l.reduce((g,f)=>g+f,0)/l.length),min:Math.min(...l),max:Math.max(...l),validPages:l.length,type:"unique_persons",note:"Genomsnitt √∂ver sidor - total reach kan inte ber√§knas"};else{const g=l.reduce((f,A)=>f+A,0);n.metrics[t]={total:g,average:Math.round(g/l.length),min:Math.min(...l),max:Math.max(...l),validPages:l.length,type:"countable"}}}return n},X=h.useMemo(()=>c.length?[...c].sort((o,x)=>{let p,n;if(v.key==="pageName"?(p=o.page.pageName,n=x.page.pageName):(p=o.metrics[v.key]||0,n=x.metrics[v.key]||0),typeof p=="string"){const t=p.localeCompare(n);return v.direction==="asc"?t:-t}const i=p-n;return v.direction==="asc"?i:-i}):[],[c,v]),W=h.useMemo(()=>{const o=(F-1)*D;return X.slice(o,o+D)},[X,F,D]),ie=Math.ceil(X.length/D),K=o=>{B(x=>({key:o,direction:x.key===o&&x.direction==="asc"?"desc":"asc"}))},Y=o=>v.key!==o?e.jsx(gs,{className:"h-4 w-4 ml-1 opacity-50"}):v.direction==="asc"?e.jsx(hs,{className:"h-4 w-4 ml-1"}):e.jsx(xs,{className:"h-4 w-4 ml-1"}),j=o=>{P(x=>x.includes(o)?x.filter(p=>p!==o):[...x,o])},S=()=>{const o=["Sidnamn","Sido-ID",...E.map(m=>{const g=he[m];return g?g.displayName:m})],x=X.map(m=>[m.page.pageName,m.page.pageId,...E.map(g=>m.metrics[g]||0)]),p=[o.join(","),...x.map(m=>m.join(","))].join(`
`),n=new Blob([p],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a"),t=URL.createObjectURL(n);i.setAttribute("href",t);const l=s?`${U(s.month)}_${s.year}`:"m√•nadsj√§mf√∂relse";i.setAttribute("download",`Facebook_${l}.csv`),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)},y=o=>o==null||isNaN(o)?"-":new Intl.NumberFormat("sv-SE").format(o);return C?e.jsxs(ee,{children:[e.jsx(Fe,{className:"h-4 w-4"}),e.jsx(se,{children:"Laddar data"}),e.jsx(te,{children:"Analyserar m√•nadsdata f√∂r Facebook-sidor..."})]}):N?e.jsxs(ee,{variant:"destructive",children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsx(se,{children:"Fel"}),e.jsx(te,{children:N})]}):r.length===0?e.jsxs(ee,{children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsx(se,{children:"Ingen data"}),e.jsx(te,{children:"Ladda upp CSV-filer f√∂r att visa m√•nadsvis j√§mf√∂relse av Facebook-sidor."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(H,{children:[e.jsx(ae,{children:e.jsxs(ne,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-5 w-5 text-facebook-500"}),"M√•nadsvis j√§mf√∂relse"]})}),e.jsxs(re,{children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"V√§lj m√•nad"}),e.jsxs(Ie,{value:s?`${s.year}_${s.month}`:"",onValueChange:o=>{const[x,p]=o.split("_");a({year:parseInt(x),month:parseInt(p)})},children:[e.jsx(Ee,{children:e.jsx(Me,{placeholder:"V√§lj m√•nad att analysera"})}),e.jsx(Pe,{children:r.map(o=>e.jsxs(Ce,{value:`${o.year}_${o.month}`,children:[U(o.month)," ",o.year]},`${o.year}_${o.month}`))})]}),s&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Visar data f√∂r ",U(s.month)," ",s.year]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Metrics att visa"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:et.map(o=>{const x=E.includes(o.key);return e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:x,onChange:()=>j(o.key),className:"h-4 w-4 text-facebook-500 border-gray-300 rounded focus:ring-facebook-500"}),e.jsx("span",{className:"text-sm font-medium",children:o.label}),!o.canSum&&e.jsx("span",{className:"text-xs text-orange-600 font-medium",children:"*"})]},o.key)})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"* = Kan inte summeras √∂ver sidor (unika personer per m√•nad)"})]})]}),u&&e.jsxs("div",{className:"grid md:grid-cols-4 gap-4 mb-6 p-4 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-facebook-600",children:u.totalPages}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Facebook-sidor"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-semibold",children:[U(u.period.month)," ",u.period.year]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Vald period"})]}),E.slice(0,2).map(o=>{const x=u.metrics[o],p=he[o];return!x||!p?null:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold",children:p.canSumAcrossPages?y(x.total):y(x.average)}),e.jsx("div",{className:"text-sm text-muted-foreground",children:p.canSumAcrossPages?`Total ${p.displayName}`:`Snitt ${p.displayName}`})]},o)})]})]})]}),e.jsxs(H,{children:[e.jsxs(ae,{className:"flex flex-row items-center justify-between",children:[e.jsxs(ne,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-5 w-5"}),s?`${U(s.month)} ${s.year} - Alla sidor`:"M√•nadsdata"]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(V,{onClick:S,variant:"outline",size:"sm",children:[e.jsx(ds,{className:"h-4 w-4 mr-2"}),"CSV"]})})]}),e.jsxs(re,{children:[c.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Ingen data tillg√§nglig f√∂r vald m√•nad"}):e.jsxs(e.Fragment,{children:[e.jsxs(Be,{children:[e.jsx(Ue,{children:e.jsxs(ke,{children:[e.jsx(we,{className:"cursor-pointer select-none",onClick:()=>K("pageName"),children:e.jsxs("div",{className:"flex items-center",children:["Sidnamn",Y("pageName")]})}),E.map(o=>{const x=he[o];return e.jsx(we,{className:"text-right cursor-pointer select-none",onClick:()=>K(o),children:e.jsxs("div",{className:"flex items-center justify-end",children:[(x==null?void 0:x.displayName)||o,Y(o),!(x!=null&&x.canSumAcrossPages)&&e.jsx("span",{className:"ml-1 text-orange-600",children:"*"})]})},o)})]})}),e.jsx(ze,{children:W.map((o,x)=>e.jsxs(ke,{children:[e.jsx(Ae,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Zs,{pageName:o.page.pageName}),e.jsx("span",{children:o.page.pageName})]})}),E.map(p=>e.jsx(Ae,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[y(o.metrics[p]),(u==null?void 0:u.metrics[p])&&o.metrics[p]===u.metrics[p].max&&u.metrics[p].max!==u.metrics[p].min&&e.jsx("span",{className:"text-yellow-600",title:"B√§sta v√§rde f√∂r denna m√•nad",children:"üèÜ"}),(u==null?void 0:u.metrics[p])&&o.metrics[p]===u.metrics[p].min&&u.metrics[p].max!==u.metrics[p].min&&e.jsx("span",{className:"text-gray-500",title:"L√§gsta v√§rde f√∂r denna m√•nad",children:"üìâ"})]})},p))]},o.page.pageId))})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Visa:"}),e.jsxs(Ie,{value:D.toString(),onValueChange:o=>{T(Number(o)),L(1)},children:[e.jsx(Ee,{className:"w-[120px]",children:e.jsx(Me,{})}),e.jsx(Pe,{children:Qs.map(o=>e.jsx(Ce,{value:o.value.toString(),children:o.label},o.value))})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Visar ",(F-1)*D+1," till ",Math.min(F*D,X.length)," av ",X.length]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{variant:"outline",size:"sm",onClick:()=>L(o=>Math.max(1,o-1)),disabled:F===1,children:e.jsx(ms,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-sm",children:["Sida ",F," av ",ie]}),e.jsx(V,{variant:"outline",size:"sm",onClick:()=>L(o=>Math.min(ie,o+1)),disabled:F>=ie,children:e.jsx(us,{className:"h-4 w-4"})})]})]})]})]}),E.some(o=>{var x;return((x=he[o])==null?void 0:x.category)==="unique_persons"})&&e.jsxs(ee,{className:"mt-4 bg-amber-50 border-amber-200",children:[e.jsx(ue,{className:"h-4 w-4 text-amber-600"}),e.jsx(se,{className:"text-amber-800",children:"Viktigt om R√§ckvidd"}),e.jsx(te,{className:"text-amber-700",children:"R√§ckvidd representerar unika personer per m√•nad och kan ALDRIG summeras √∂ver m√•nader eller sidor. V√§rdena i tabellen visar data f√∂r den valda m√•naden."})]})]})]})]})}const tt=["reach","engagedUsers"],at=["engagements","reactions","publications","status","comment"],Se={reach:{category:"unique_persons",displayName:"R√§ckvidd",description:"Antal unika personer som s√•g inneh√•llet under m√•naden",unit:"personer",canSumAcrossTime:!1,canSumAcrossPages:!1,preferredAggregation:"average",validAggregations:["average","min","max"],dataType:"integer",csvColumn:"Reach",icon:"üëÅÔ∏è",color:"#3B82F6",warningNote:"Kan ALDRIG summeras √∂ver m√•nader - representerar unika personer"},engagedUsers:{category:"unique_persons",displayName:"Engagerade anv√§ndare",description:"Antal unika personer som interagerade med inneh√•llet under m√•naden",unit:"personer",canSumAcrossTime:!1,canSumAcrossPages:!1,preferredAggregation:"average",validAggregations:["average","min","max"],dataType:"integer",csvColumn:"Engaged Users",icon:"ü§ù",color:"#10B981",warningNote:"Kan ALDRIG summeras √∂ver m√•nader - representerar unika personer"},engagements:{category:"countable_events",displayName:"Engagemang",description:"Totalt antal engagemang (fr√•n Facebook API) - separat fr√•n ber√§knade interaktioner",unit:"engagemang",canSumAcrossTime:!0,canSumAcrossPages:!0,preferredAggregation:"sum",validAggregations:["sum","average","min","max"],dataType:"integer",csvColumn:"Engagements",icon:"üí¨",color:"#8B5CF6",warningNote:null},reactions:{category:"countable_events",displayName:"Reaktioner",description:"Antal likes, hearts, och andra reaktioner p√• inneh√•ll",unit:"reaktioner",canSumAcrossTime:!0,canSumAcrossPages:!0,preferredAggregation:"sum",validAggregations:["sum","average","min","max"],dataType:"integer",csvColumn:"Reactions",icon:"‚ù§Ô∏è",color:"#EF4444",warningNote:null},publications:{category:"countable_events",displayName:"Publiceringar",description:"Antal publicerade inl√§gg under m√•naden",unit:"inl√§gg",canSumAcrossTime:!0,canSumAcrossPages:!0,preferredAggregation:"sum",validAggregations:["sum","average","min","max"],dataType:"integer",csvColumn:"Publications",icon:"üìù",color:"#F59E0B",warningNote:null},status:{category:"countable_events",displayName:"Statusuppdateringar",description:"Antal statusuppdateringar under m√•naden",unit:"statusar",canSumAcrossTime:!0,canSumAcrossPages:!0,preferredAggregation:"sum",validAggregations:["sum","average","min","max"],dataType:"integer",csvColumn:"Status",icon:"üì¢",color:"#14B8A6",warningNote:null},comment:{category:"countable_events",displayName:"Kommentarer",description:"Antal kommentarer p√• inneh√•ll",unit:"kommentarer",canSumAcrossTime:!0,canSumAcrossPages:!0,preferredAggregation:"sum",validAggregations:["sum","average","min","max"],dataType:"integer",csvColumn:"Comment",icon:"üí≠",color:"#6366F1",warningNote:null}};function ys(r){return Object.keys(Se).filter(s=>Se[s].category===r)}function nt(){return ys("countable_events")}function rt(){return ys("unique_persons")}function it(){const r=[],s=[],a=nt(),c=at,d=c.filter(w=>!a.includes(w)),u=a.filter(w=>!c.includes(w));d.length>0&&r.push(`Saknade summerbara metrics: ${d.join(", ")}`),u.length>0&&r.push(`Extra summerbara metrics: ${u.join(", ")}`);const b=rt(),C=tt,k=C.filter(w=>!b.includes(w)),N=b.filter(w=>!C.includes(w));return k.length>0&&r.push(`Saknade icke-summerbara metrics: ${k.join(", ")}`),N.length>0&&r.push(`Extra icke-summerbara metrics: ${N.join(", ")}`),{isConsistent:r.length===0,errors:r,warnings:s}}const ss=it();ss.isConsistent||console.error("KRITISK: metric_categorizer.js √§r inte konsistent med reach_calculator.js:",ss.errors);class De{constructor(s,a){if(!s||!a)throw new Error("FacebookPage kr√§ver b√•de pageName och pageId");this.pageName=s.trim(),this.pageId=String(a).trim(),this.createdAt=new Date}static fromCSVRow(s){if(!s.Page||!s["Page ID"])throw new Error("CSV-rad saknar obligatoriska f√§lt: Page eller Page ID");return new De(s.Page,s["Page ID"])}getKey(){return`page_${this.pageId}`}isValid(){return this.pageName.length>0&&this.pageId.length>0}}class Re{constructor(s,a,c,d){if(!(s instanceof De))throw new Error("MonthlyPageData kr√§ver en FacebookPage instans");if(!a||!c||c<1||c>12)throw new Error("MonthlyPageData kr√§ver giltigt √•r och m√•nad (1-12)");this.page=s,this.year=parseInt(a),this.month=parseInt(c),this.metrics=this.validateMetrics(d||{}),this.createdAt=new Date}validateMetrics(s){return{reach:this.parseNumeric(s.reach||s.Reach),engagedUsers:this.parseNumeric(s.engagedUsers||s["Engaged Users"]),engagements:this.parseNumeric(s.engagements||s.Engagements),reactions:this.parseNumeric(s.reactions||s.Reactions),publications:this.parseNumeric(s.publications||s.Publications),status:this.parseNumeric(s.status||s.Status),comment:this.parseNumeric(s.comment||s.Comment)}}parseNumeric(s){if(s==null||s==="")return 0;const a=parseFloat(String(s).replace(/,/g,""));return isNaN(a)?0:a}static fromCSVRow(s,a,c){const d=De.fromCSVRow(s);return new Re(d,a,c,s)}getKey(){return`${this.page.getKey()}_${this.year}_${this.month}`}getPeriod(){return{year:this.year,month:this.month}}isSamePeriod(s,a){return this.year===s&&this.month===a}getSummerableMetrics(){return{engagements:this.metrics.engagements,reactions:this.metrics.reactions,publications:this.metrics.publications,status:this.metrics.status,comment:this.metrics.comment}}getNonSummerableMetrics(){return{reach:this.metrics.reach,engagedUsers:this.metrics.engagedUsers}}}class lt{constructor(s){if(!(s instanceof De))throw new Error("PageTimeseries kr√§ver en FacebookPage instans");this.page=s,this.monthlyData=new Map,this.createdAt=new Date}addMonthlyData(s){if(!(s instanceof Re))throw new Error("addMonthlyData kr√§ver MonthlyPageData instans");if(s.page.pageId!==this.page.pageId)throw new Error("MonthlyData m√•ste tillh√∂ra samma sida");const a=`${s.year}_${s.month}`;this.monthlyData.set(a,s)}getMonthlyData(s,a){const c=`${s}_${a}`;return this.monthlyData.get(c)||null}getAvailablePeriods(){return Array.from(this.monthlyData.values()).map(s=>s.getPeriod()).sort((s,a)=>s.year!==a.year?s.year-a.year:s.month-a.month)}getAllMonthlyData(){return Array.from(this.monthlyData.values()).sort((s,a)=>s.year!==a.year?s.year-a.year:s.month-a.month)}hasDataForPeriod(s,a){return this.getMonthlyData(s,a)!==null}getMonthCount(){return this.monthlyData.size}}class ot{constructor(){this.pageTimeseries=new Map,this.createdAt=new Date}addMonthlyData(s){if(!(s instanceof Re))throw new Error("addMonthlyData kr√§ver MonthlyPageData instans");const a=s.page.getKey();this.pageTimeseries.has(a)||this.pageTimeseries.set(a,new lt(s.page)),this.pageTimeseries.get(a).addMonthlyData(s)}getPageTimeseries(s){const a=`page_${s}`;return this.pageTimeseries.get(a)||null}getAllPages(){return Array.from(this.pageTimeseries.values()).map(s=>s.page).sort((s,a)=>s.pageName.localeCompare(a.pageName))}getAllPeriods(){const s=new Set;for(const a of this.pageTimeseries.values())for(const c of a.getAvailablePeriods())s.add(`${c.year}_${c.month}`);return Array.from(s).map(a=>{const[c,d]=a.split("_");return{year:parseInt(c),month:parseInt(d)}}).sort((a,c)=>a.year!==c.year?a.year-c.year:a.month-c.month)}getDataForPeriod(s,a){const c=[];for(const d of this.pageTimeseries.values()){const u=d.getMonthlyData(s,a);u&&c.push(u)}return c.sort((d,u)=>d.page.pageName.localeCompare(u.page.pageName))}getStats(){return{totalPages:this.pageTimeseries.size,totalPeriods:this.getAllPeriods().length,totalDataPoints:Array.from(this.pageTimeseries.values()).reduce((s,a)=>s+a.getMonthCount(),0)}}clear(){this.pageTimeseries.clear()}}const ct=[{key:"reach",label:"R√§ckvidd",canSum:!1},{key:"engagements",label:"Engagemang",canSum:!0},{key:"reactions",label:"Reaktioner",canSum:!0},{key:"publications",label:"Publiceringar",canSum:!0}],Le=["#2563EB","#16A34A","#EAB308","#DC2626","#7C3AED","#EA580C","#0891B2","#BE185D","#059669","#7C2D12","#4338CA","#C2410C"],dt=({uploadedPeriods:r})=>{var p;const[s,a]=h.useState("reach"),[c,d]=h.useState([]),[u,b]=h.useState([]),[C,k]=h.useState(null),[N,w]=h.useState({x:0,y:0}),[v,B]=h.useState(!1);h.useMemo(()=>!r||r.length===0?null:new ot(r),[r]);const F=h.useMemo(()=>{if(!r||r.length===0)return[];const n=new Map;return r.forEach(i=>{i.data&&Array.isArray(i.data)&&i.data.forEach(t=>{const l=t.Page||t.page||"Ok√§nd sida",m=t["Page ID"]||t.pageId||`page_${l.replace(/\s+/g,"_")}`;n.has(m)||n.set(m,{pageId:m,pageName:l})})}),Array.from(n.values()).sort((i,t)=>i.pageName.localeCompare(t.pageName))},[r]),L=h.useMemo(()=>r?r.map(n=>({...n,sortKey:n.year*100+n.month})).sort((n,i)=>n.sortKey-i.sortKey):[],[r]),D=n=>["Jan","Feb","Mar","Apr","Maj","Jun","Jul","Aug","Sep","Okt","Nov","Dec"][n-1]||n.toString(),T=n=>({reach:"Reach",engagements:"Engagements",reactions:"Reactions",publications:"Publications"})[n]||n,E=(n,i)=>{const t=i.indexOf(n);return t>=0?Le[t%Le.length]:Le[0]},P=n=>{if(n===0)return{min:0,max:100,step:20,format:"number"};let i,t,l;return n<=1e3?(n<=500?i=100:i=200,t=Math.ceil(n/i)*i,l="number"):n<=1e4?(n<=5e3?i=1e3:i=2e3,t=Math.ceil(n/i)*i,l="thousands"):n<=1e5?(n<=5e4?i=1e4:i=2e4,t=Math.ceil(n/i)*i,l="thousands"):n<=1e6?(n<=5e5?i=1e5:i=2e5,t=Math.ceil(n/i)*i,l="thousands"):(n<=5e6?i=1e6:n<=1e7?i=2e6:i=5e6,t=Math.ceil(n/i)*i,l="millions"),{min:0,max:t,step:i,format:l}},$=(n,i)=>{if(n===0)return"0";switch(i){case"number":return n.toLocaleString("sv-SE");case"thousands":return n>=1e3?`${(n/1e3).toLocaleString("sv-SE")}k`:n.toLocaleString("sv-SE");case"millions":return n>=1e6?`${(n/1e6).toLocaleString("sv-SE")}M`:n>=1e3?`${(n/1e3).toLocaleString("sv-SE")}k`:n.toLocaleString("sv-SE");default:return n.toLocaleString("sv-SE")}},U=n=>{const i=[],{min:t,max:l,step:m}=n;for(let g=t;g<=l;g+=m)i.push(g);return i},I=()=>{const n=document.querySelector("#trend-chart-svg");if(!n||S.length===0)return;const i=document.createElement("canvas"),t=i.getContext("2d"),l=2,m=1600,g=m/l;i.width=m,i.height=g,t.fillStyle="white",t.fillRect(0,0,m,g);const f=new XMLSerializer().serializeToString(n),A=new Blob([f],{type:"image/svg+xml;charset=utf-8"}),_=window.URL||window.webkitURL,R=_.createObjectURL(A),O=new Image;O.onload=()=>{var Ye;const G=g-80-120;t.drawImage(O,0,80,m,G),t.fillStyle="#1f2937",t.font="bold 32px Arial, sans-serif",t.textAlign="center";const de=`Utveckling √∂ver tid - ${(Ye=Se[s])==null?void 0:Ye.displayName}`;t.fillText(de,m/2,50),t.fillStyle="#4b5563",t.font="24px Arial, sans-serif";const J=S.map(oe=>oe.pageName),fe=J.length===1?`Konto: ${J[0]}`:`Konton: ${J.join(", ")}`,me=m-200,pe=fe.split(" ");let je="",$e=g-60;for(let oe=0;oe<pe.length;oe++){const ye=je+pe[oe]+" ";t.measureText(ye).width>me&&oe>0?(t.fillText(je,m/2,$e),je=pe[oe]+" ",$e+=30):je=ye}t.fillText(je,m/2,$e),i.toBlob(oe=>{const ye=_.createObjectURL(oe),ge=document.createElement("a");ge.href=ye;const He=J.length===1?J[0].replace(/[^a-zA-Z0-9]/g,"-"):`${J.length}-konton`;ge.download=`trend-analys-${s}-${He}-${new Date().toISOString().slice(0,10)}.png`,document.body.appendChild(ge),ge.click(),document.body.removeChild(ge),_.revokeObjectURL(ye)},"image/png",1),_.revokeObjectURL(R)},O.src=R},X=n=>{d(i=>i.includes(n)?i.filter(t=>t!==n):[...i,n])},W=n=>{a(n)},ie=n=>{const i=`${n.year}-${n.month}`;b(t=>t.find(m=>`${m.year}-${m.month}`===i)?t.filter(m=>`${m.year}-${m.month}`!==i):[...t,n])},K=h.useMemo(()=>u.length>0&&u.length===L.length,[u.length,L.length]),Y=()=>{b(K?[]:L)},j=h.useMemo(()=>{if(!r||c.length===0||u.length===0)return[];const n=[];return u.forEach(t=>{t.data&&Array.isArray(t.data)&&c.forEach(l=>{const m=t.data.find(g=>(g["Page ID"]||g.pageId||`page_${(g.Page||g.page||"").replace(/\s+/g,"_")}`)===l);if(m){const g=T(s),f=m[g];let A=0;if(f!=null&&f!==""){const _=String(f).replace(/[,\s]/g,"");A=parseFloat(_)||0}n.push({periodKey:`${t.year}-${t.month.toString().padStart(2,"0")}`,period:`${D(t.month)} ${t.year}`,month:D(t.month),year:t.year,pageId:l,pageName:m.Page||m.page||"Ok√§nd sida",value:A,metric:s})}})}),n},[r,c,u,s]),S=h.useMemo(()=>{const n=new Map;return j.forEach(i=>{n.has(i.pageId)||n.set(i.pageId,{pageId:i.pageId,pageName:i.pageName,points:[],color:E(i.pageId,c)}),n.get(i.pageId).points.push(i)}),n.forEach(i=>{i.points.sort((t,l)=>t.periodKey.localeCompare(l.periodKey))}),Array.from(n.values())},[j,c]),y=h.useMemo(()=>{if(j.length===0)return P(100);const n=j.map(t=>t.value),i=Math.max(...n);return P(i)},[j]),o=n=>{if(n.length<2)return"";if(n.length===2){const[t,l]=n;return`M ${t.x} ${t.y} L ${l.x} ${l.y}`}let i=`M ${n[0].x} ${n[0].y}`;for(let t=1;t<n.length;t++){const l=n[t],m=n[t-1];if(t===1){const g=n[t+1]||l,f=m.x+(l.x-m.x)*.3,A=m.y+(l.y-m.y)*.3,_=l.x-(g.x-m.x)*.1,R=l.y-(g.y-m.y)*.1;i+=` C ${f} ${A}, ${_} ${R}, ${l.x} ${l.y}`}else if(t===n.length-1){const g=n[t-2]||m,f=m.x+(l.x-g.x)*.1,A=m.y+(l.y-g.y)*.1,_=l.x-(l.x-m.x)*.3,R=l.y-(l.y-m.y)*.3;i+=` C ${f} ${A}, ${_} ${R}, ${l.x} ${l.y}`}else{const g=n[t+1],f=n[t-2]||m,A=m.x+(l.x-f.x)*.1,_=m.y+(l.y-f.y)*.1,R=l.x-(g.x-m.x)*.1,O=l.y-(g.y-m.y)*.1;i+=` C ${A} ${_}, ${R} ${O}, ${l.x} ${l.y}`}}return i},x=(n,i)=>{const t=n.currentTarget.getBoundingClientRect();w({x:n.clientX-t.left,y:n.clientY-t.top}),k(i)};return!r||r.length===0?e.jsxs(H,{children:[e.jsx(ae,{children:e.jsxs(ne,{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-5 w-5"}),"Trendanalys"]})}),e.jsx(re,{children:e.jsx("p",{className:"text-muted-foreground",children:"Ladda upp minst tv√• m√•nadsfiler f√∂r att se trendanalys."})})]}):e.jsx("div",{className:"space-y-6",children:e.jsxs(H,{children:[e.jsxs(ae,{className:"flex flex-row items-center justify-between",children:[e.jsxs(ne,{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"h-5 w-5"}),"Utveckling √∂ver tid"]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(V,{onClick:I,variant:"outline",size:"sm",disabled:S.length===0,children:"üìä Exportera PNG"})})]}),e.jsxs(re,{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 block",children:["V√§lj Facebook-sidor (",c.length," valda)"]}),e.jsx("div",{className:"max-h-32 overflow-y-auto border rounded p-2 space-y-1",children:F.map(n=>{const i=c.includes(n.pageId);return e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i,onChange:()=>X(n.pageId),className:"h-4 w-4 text-facebook-500 border-gray-300 rounded focus:ring-facebook-500"}),e.jsx("span",{className:"text-sm font-medium",children:n.pageName})]},n.pageId)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"V√§lj datapunkt"}),e.jsx("div",{className:"space-y-2",children:ct.map(n=>{const i=s===n.key;return e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"metric",checked:i,onChange:()=>W(n.key),className:"h-4 w-4 text-facebook-500 border-gray-300 focus:ring-facebook-500"}),e.jsx("span",{className:"text-sm font-medium",children:n.label})]},n.key)})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 block",children:["V√§lj perioder (",u.length," valda)"]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer mb-2 p-2 bg-gray-50 rounded",children:[e.jsx("input",{type:"checkbox",checked:K,onChange:Y,className:"h-4 w-4 text-facebook-500 border-gray-300 rounded focus:ring-facebook-500"}),e.jsx("span",{className:"text-sm font-medium",children:"V√§lj alla perioder"})]}),e.jsx("div",{className:"max-h-32 overflow-y-auto border rounded p-2 space-y-1",children:L.map(n=>{const i=u.some(t=>t.year===n.year&&t.month===n.month);return e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i,onChange:()=>ie(n),className:"h-4 w-4 text-facebook-500 border-gray-300 rounded focus:ring-facebook-500"}),e.jsxs("span",{className:"text-sm font-medium",children:[D(n.month)," ",n.year]})]},`${n.year}-${n.month}`)})})]})]}),s&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-center",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-900",children:["Visar: ",(p=Se[s])==null?void 0:p.displayName]}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Aktuell datapunkt som visas i diagrammet"})]}),S.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-wrap gap-3",children:S.map(n=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full border",style:{backgroundColor:n.color}}),e.jsx("span",{className:"text-sm font-medium",children:n.pageName})]},n.pageId))}),e.jsx("div",{className:"relative",children:e.jsxs("svg",{id:"trend-chart-svg",width:"100%",height:"500",viewBox:"0 0 1000 500",className:"border rounded bg-gray-50",onMouseLeave:()=>k(null),children:[e.jsx("defs",{children:e.jsx("pattern",{id:"grid",width:"50",height:"50",patternUnits:"userSpaceOnUse",children:e.jsx("path",{d:"M 50 0 L 0 0 0 50",fill:"none",stroke:"#e5e7eb",strokeWidth:"1"})})}),e.jsx("rect",{width:"100%",height:"100%",fill:"url(#grid)"}),U(y).map(n=>{const i=450-(n-y.min)/(y.max-y.min)*380;return e.jsxs("g",{children:[e.jsx("line",{x1:"70",y1:i,x2:"930",y2:i,stroke:"#d1d5db",strokeWidth:"1"}),e.jsx("text",{x:"55",y:i+4,textAnchor:"end",fontSize:"14",fill:"#6b7280",children:$(n,y.format)})]},n)}),L.map((n,i)=>{const t=70+i/Math.max(1,L.length-1)*860;return e.jsxs("g",{children:[e.jsx("line",{x1:t,y1:"70",x2:t,y2:"450",stroke:"#d1d5db",strokeWidth:"1"}),e.jsx("text",{x:t,y:"475",textAnchor:"middle",fontSize:"14",fill:"#6b7280",children:D(n.month)}),e.jsx("text",{x:t,y:"490",textAnchor:"middle",fontSize:"12",fill:"#9ca3af",children:n.year})]},`${n.year}-${n.month}`)}),S.map(n=>{if(n.points.length<1)return null;const i=n.points.map((t,l)=>{const g=70+L.findIndex(A=>`${A.year}-${A.month.toString().padStart(2,"0")}`===t.periodKey)/Math.max(1,L.length-1)*860,f=450-(t.value-y.min)/(y.max-y.min)*380;return{x:g,y:f,point:t}});return e.jsxs("g",{children:[n.points.length>1&&e.jsx("path",{d:o(i),fill:"none",stroke:n.color,strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"}),i.map(({x:t,y:l,point:m},g)=>e.jsx("circle",{cx:t,cy:l,r:"6",fill:n.color,stroke:"white",strokeWidth:"3",className:"cursor-pointer",onMouseEnter:f=>x(f,m),onMouseLeave:()=>k(null)},g))]},n.pageId)}),C&&e.jsx("g",{children:(()=>{var m;let t=N.x+15,l=N.y-35;return t+200>980&&(t=N.x-200-15),l<15&&(l=N.y+15),l+70>480&&(l=N.y-70-15),e.jsxs(e.Fragment,{children:[e.jsx("rect",{x:t,y:l,width:200,height:70,fill:"rgba(0,0,0,0.85)",rx:"6"}),e.jsx("text",{x:t+12,y:l+20,fill:"white",fontSize:"13",fontWeight:"bold",children:C.pageName}),e.jsx("text",{x:t+12,y:l+38,fill:"white",fontSize:"12",children:C.period}),e.jsxs("text",{x:t+12,y:l+55,fill:"white",fontSize:"12",children:[(m=Se[C.metric])==null?void 0:m.displayName,": ",C.value.toLocaleString()]})]})})()})]})})]}):e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(qe,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"V√§lj sidor och perioder f√∂r att visa diagram"}),e.jsx("p",{className:"text-sm",children:c.length===0&&u.length===0?"Markera minst en Facebook-sida och period":c.length===0?"Markera minst en Facebook-sida i listan ovan":"Markera minst en period i listan ovan"})]})]})]})})},z={LOCALSTORAGE_KEYS:{METADATA:"fb_analyzer_metadata",PERIODS:"fb_analyzer_periods",PAGES:"fb_analyzer_pages",SETTINGS:"fb_analyzer_settings"},INDEXEDDB:{NAME:"FacebookAnalyzerDB",VERSION:1,STORES:{MONTHLY_DATA:"monthlyData",TIMESERIES:"timeseries"}},LIMITS:{LOCALSTORAGE_MAX:5*1024*1024,INDEXEDDB_MAX:50*1024*1024,MAX_PERIODS:120,MAX_PAGES:1e3}};async function Ke(){return new Promise((r,s)=>{const a=indexedDB.open(z.INDEXEDDB.NAME,z.INDEXEDDB.VERSION);a.onerror=()=>{console.error("IndexedDB initialization failed:",a.error),s(a.error)},a.onupgradeneeded=c=>{const d=c.target.result;if(!d.objectStoreNames.contains(z.INDEXEDDB.STORES.MONTHLY_DATA)){const u=d.createObjectStore(z.INDEXEDDB.STORES.MONTHLY_DATA,{keyPath:"id"});u.createIndex("pageId","pageId",{unique:!1}),u.createIndex("period",["year","month"],{unique:!1}),u.createIndex("pagePeriod",["pageId","year","month"],{unique:!0}),console.log("Created monthlyData store with indexes")}d.objectStoreNames.contains(z.INDEXEDDB.STORES.TIMESERIES)||(d.createObjectStore(z.INDEXEDDB.STORES.TIMESERIES,{keyPath:"pageId"}).createIndex("pageName","pageName",{unique:!1}),console.log("Created timeseries store"))},a.onsuccess=()=>{r(a.result)}})}async function mt(r,s){if(!r||!s)throw new Error("year och month kr√§vs");try{const a=await Ke();return new Promise((c,d)=>{const k=a.transaction([z.INDEXEDDB.STORES.MONTHLY_DATA],"readonly").objectStore(z.INDEXEDDB.STORES.MONTHLY_DATA).index("period").getAll([r,s]);k.onsuccess=()=>{const N=k.result.sort((w,v)=>w.pageName.localeCompare(v.pageName));c(N)},k.onerror=()=>{d(k.error)}})}catch(a){throw console.error("Error getting period data:",a),a}}async function ut(){try{const r=await Ke();return new Promise((s,a)=>{const u=r.transaction([z.INDEXEDDB.STORES.MONTHLY_DATA],"readonly").objectStore(z.INDEXEDDB.STORES.MONTHLY_DATA).getAll();u.onsuccess=()=>{const b=new Set;for(const k of u.result)b.add(`${k.year}_${k.month}`);const C=Array.from(b).map(k=>{const[N,w]=k.split("_");return{year:parseInt(N),month:parseInt(w)}}).sort((k,N)=>k.year!==N.year?k.year-N.year:k.month-N.month);s(C)},u.onerror=()=>{a(u.error)}})}catch(r){throw console.error("Error getting all periods:",r),r}}async function gt(){try{for(const s of Object.values(z.LOCALSTORAGE_KEYS))localStorage.removeItem(s);const r=await Ke();return new Promise((s,a)=>{const c=r.transaction([z.INDEXEDDB.STORES.MONTHLY_DATA,z.INDEXEDDB.STORES.TIMESERIES],"readwrite");let d=0;const u=2,C=c.objectStore(z.INDEXEDDB.STORES.MONTHLY_DATA).clear();C.onsuccess=()=>{d++,d===u&&(console.log("All data cleared successfully"),s(!0))};const N=c.objectStore(z.INDEXEDDB.STORES.TIMESERIES).clear();N.onsuccess=()=>{d++,d===u&&(console.log("All data cleared successfully"),s(!0))},c.onerror=()=>{a(c.error)}})}catch(r){throw console.error("Error clearing data:",r),r}}function ht(){const[r,s]=h.useState(!1),[a,c]=h.useState(!1),[d,u]=h.useState("upload"),[b,C]=h.useState([]),[k,N]=h.useState(!0),[w,v]=h.useState(!1);h.useEffect(()=>{B()},[]);const B=async()=>{try{N(!0),console.log("Laddar befintlig data fr√•n storage...");const T=await ut();if(console.log("Hittade perioder i storage:",T),T.length>0){const E=await Promise.all(T.map(async P=>{const U=(await mt(P.year,P.month)).map(I=>({Page:I.pageName,"Page ID":I.pageId,Reach:I.metrics.reach||0,"Engaged Users":I.metrics.engagedUsers||0,Engagements:I.metrics.engagements||0,Reactions:I.metrics.reactions||0,Publications:I.metrics.publications||0,Status:I.metrics.status||0,Comment:I.metrics.comment||0}));return{year:P.year,month:P.month,data:U,filename:`FB_${P.year}_${String(P.month).padStart(2,"0")}.csv`}}));console.log("Konverterade periodsWithData:",E),C(E),s(!0),u("monthly")}else console.log("Ingen befintlig data hittades")}catch(T){console.error("Kunde inte ladda befintlig data:",T)}finally{N(!1)}},F=async T=>{console.log("Data uploaded successfully:",T);const E=Array.isArray(T)?T:[],P=[...b];E.forEach($=>{P.some(I=>I.year===$.year&&I.month===$.month)?console.log(`Period ${$.year}-${$.month} finns redan, hoppar √∂ver dubblett`):P.push($)}),console.log("Merged periods:",P),C(P),s(!0),c(!1),u("monthly")},L=async()=>{if(window.confirm("√Ñr du s√§ker p√• att du vill rensa all data? Detta kan inte √•ngras."))try{v(!0),console.log("Rensar all data..."),await gt(),C([]),s(!1),u("upload"),console.log("‚úÖ All data rensad framg√•ngsrikt")}catch(T){console.error("‚ùå Fel vid rensning av data:",T),alert(`Fel vid rensning av data: ${T.message}`)}finally{v(!1)}},D=()=>{c(!1)};return k?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ce,{className:"h-12 w-12 mx-auto mb-4 text-primary animate-pulse"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Facebook API data analyser"}),e.jsx("p",{className:"text-muted-foreground",children:"Laddar befintlig data..."})]})}):a?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"border-b border-border",children:e.jsx("div",{className:"container py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"facebook-brand flex items-center gap-3",children:[e.jsx(ce,{className:"h-8 w-8"}),e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Facebook API data analyser"})]}),e.jsxs(V,{variant:"outline",onClick:D,children:[e.jsx($s,{className:"mr-2 h-4 w-4"}),"Tillbaka"]})]})})}),e.jsx("main",{className:"container py-6",children:e.jsx(Hs,{onDataUploaded:F,onCancel:D})})]}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"border-b border-border",children:e.jsx("div",{className:"container py-4",children:e.jsxs("div",{className:"facebook-brand flex items-center gap-3",children:[e.jsx(ce,{className:"h-8 w-8"}),e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Facebook API data analyser"})]})})}),e.jsx("main",{className:"container py-6",children:e.jsx("div",{className:"space-y-6",children:r?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Analysera Facebook-data"}),e.jsxs("p",{className:"text-muted-foreground",children:[b.length," period",b.length!==1?"er":""," tillg√§nglig",b.length!==1?"a":""]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(V,{variant:"outline",onClick:()=>c(!0),children:[e.jsx(Te,{className:"mr-2 h-4 w-4"}),"Ladda upp mer data"]}),e.jsx(V,{variant:"destructive",onClick:L,disabled:w,children:w?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mr-2 h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"}),"Rensar..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_s,{className:"mr-2 h-4 w-4"}),"Rensa data"]})})]})]}),e.jsxs(Ks,{value:d,onValueChange:u,className:"space-y-4",children:[e.jsxs(js,{className:"grid w-full grid-cols-4",children:[e.jsxs(Ne,{value:"upload",className:"flex items-center gap-2",children:[e.jsx(_e,{className:"h-4 w-4"}),"Info"]}),e.jsxs(Ne,{value:"monthly",className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-4 w-4"}),"M√•nadsanalys"]}),e.jsxs(Ne,{value:"pages",className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-4 w-4"}),"Sidor √∂ver tid"]}),e.jsxs(Ne,{value:"trends",className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-4 w-4"}),"Trendanalys"]})]}),e.jsx(be,{value:"upload",className:"mt-6",children:e.jsxs(H,{children:[e.jsx(ae,{children:e.jsxs(ne,{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"h-5 w-5"}),"Data√∂versikt"]})}),e.jsxs(re,{className:"space-y-4",children:[e.jsxs(ee,{children:[e.jsx(_e,{className:"h-4 w-4"}),e.jsx(se,{children:"Data laddad och redo"}),e.jsxs(te,{children:["Du har ",b.length," period",b.length!==1?"er":""," av Facebook-data tillg√§nglig f√∂r analys. Anv√§nd flikarna ovan f√∂r att utforska dina data eller ladda upp mer data."]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[e.jsx(xe,{className:"w-8 h-8 mx-auto mb-2 text-blue-600"}),e.jsx("div",{className:"font-bold text-2xl text-blue-900",children:b.length}),e.jsx("div",{className:"text-sm text-blue-700",children:"M√•nader data"})]}),e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[e.jsx(ce,{className:"w-8 h-8 mx-auto mb-2 text-green-600"}),e.jsx("div",{className:"font-bold text-2xl text-green-900",children:b.reduce((T,E)=>{var P;return T+(((P=E.data)==null?void 0:P.length)||0)},0)}),e.jsx("div",{className:"text-sm text-green-700",children:"Totalt dataposter"})]}),e.jsxs("div",{className:"text-center p-4 bg-purple-50 rounded-lg",children:[e.jsx(ve,{className:"w-8 h-8 mx-auto mb-2 text-purple-600"}),e.jsx("div",{className:"font-bold text-2xl text-purple-900",children:[...new Set(b.flatMap(T=>{var E;return((E=T.data)==null?void 0:E.map(P=>P.Page||P.page))||[]}))].length}),e.jsx("div",{className:"text-sm text-purple-700",children:"Unika Facebook-sidor"})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Data sparas automatiskt i webbl√§saren och kommer att finnas kvar n√§r du laddar om sidan."}),e.jsxs(V,{onClick:()=>c(!0),children:[e.jsx(Te,{className:"mr-2 h-4 w-4"}),"Ladda upp mer data"]})]})]})}),e.jsx(be,{value:"monthly",className:"mt-6",children:e.jsx(st,{uploadedPeriods:b})}),e.jsx(be,{value:"pages",className:"mt-6",children:e.jsx(Js,{uploadedPeriods:b})}),e.jsx(be,{value:"trends",className:"mt-6",children:e.jsx(dt,{uploadedPeriods:b})})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Te,{className:"mx-auto h-24 w-24 text-muted-foreground mb-6"}),e.jsx("h2",{className:"text-3xl font-bold tracking-tight mb-4",children:"V√§lkommen till Facebook API data analyser"}),e.jsx("p",{className:"text-xl text-muted-foreground mb-8 max-w-2xl mx-auto",children:"Analysera och visualisera dina Facebook-sidor √∂ver tid. Ladda upp m√•nadsdata f√∂r att komma ig√•ng med tidserie-analys."}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6 max-w-4xl mx-auto mb-12",children:[e.jsxs(H,{className:"text-center p-6",children:[e.jsx(xe,{className:"mx-auto h-12 w-12 text-primary mb-4"}),e.jsx("h3",{className:"font-semibold mb-2",children:"M√•nadsanalys"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"J√§mf√∂r prestanda mellan Facebook-sidor f√∂r specifika m√•nader"})]}),e.jsxs(H,{className:"text-center p-6",children:[e.jsx(ve,{className:"mx-auto h-12 w-12 text-primary mb-4"}),e.jsx("h3",{className:"font-semibold mb-2",children:"Tidserie-analys"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"F√∂lj utvecklingen av enskilda sidor √∂ver tid"})]}),e.jsxs(H,{className:"text-center p-6",children:[e.jsx(ce,{className:"mx-auto h-12 w-12 text-primary mb-4"}),e.jsx("h3",{className:"font-semibold mb-2",children:"Trend-uppt√§ckt"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Uppt√§ck m√∂nster och trender i dina Facebook-data"})]})]}),e.jsxs(V,{onClick:()=>c(!0),size:"lg",children:[e.jsx(Te,{className:"mr-2 h-5 w-5"}),"Ladda upp Facebook API data"]})]})})}),e.jsx("footer",{className:"border-t border-border mt-12",children:e.jsxs("div",{className:"container py-4 text-center text-sm text-muted-foreground",children:[e.jsxs("p",{children:["Facebook API data analyser ¬© ",new Date().getFullYear()]}),e.jsxs("p",{className:"mt-1",children:["Tidserie-baserad analys av m√•nadsstatistik |",e.jsx("span",{className:"text-facebook-500 font-medium",children:" Utvecklad f√∂r projektfas 1-8"})]})]})})]})}Ve.createRoot(document.getElementById("root")).render(e.jsx(Ls.StrictMode,{children:e.jsx(ht,{})}));
//# sourceMappingURL=index-DqjOdhN8.js.map
